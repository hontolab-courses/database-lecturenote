
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>16. pandasによるデータ処理 &#8212; データベースの講義ノート</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=87e54e7c" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css?v=aeeb188a" />
  
  <!-- So that users can add custom icons -->
  <script src="../../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js?v=36754332"></script>
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-1GGP5ZEVQL"></script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-1GGP5ZEVQL');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-1GGP5ZEVQL');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-svg.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'content/pandas/01';</script>
    <link rel="canonical" href="https://dbnote.hontolab.org/content/pandas/01.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="集合と写像" href="../misc/math.html" />
    <link rel="prev" title="15. NoSQL" href="../nosql/01.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
  
  
    <p class="title logo__title">データベースの講義ノート</p>
  
</a></div>
        <div class="sidebar-primary-item">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">はじめに</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../introduction/01.html">1. “データベース”を使わない世界</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">データベースとは</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../concept-of-database/01.html">2. データベースの概念</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">データモデル</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../relational-data-model/01.html">3. 関係データモデル</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">SQL</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../sql/01.html">4. 単純質問</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sql/02.html">5. 結合質問（集合演算を含む）</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sql/03.html">6. 副問い合わせ &amp; テーブルの定義と更新</a></li>
<li class="toctree-l1"><a class="reference internal" href="../exercise/sql.html">7. SQL演習</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">データベース設計</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../er-model/01.html">8. 実体関連モデルとは</a></li>
<li class="toctree-l1"><a class="reference internal" href="../er-model/02.html">9. 実体関連モデル上の一貫性制約</a></li>
<li class="toctree-l1"><a class="reference internal" href="../er-model/03.html">10. 拡張実体関連モデル &amp; n項関連</a></li>
<li class="toctree-l1"><a class="reference internal" href="../db-design/01.html">11. 望ましくない関係スキーマ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../db-design/02.html">12. データ従属性にもとづく正規化</a></li>
<li class="toctree-l1"><a class="reference internal" href="../exercise/db-design.html">13. データベース設計演習</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">索引づけ</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../indexing/01.html">14. B+木 &amp; ハッシュ索引</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">ビッグデータ時代のデータベース</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../nosql/01.html">15. NoSQL</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Pandas</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 current active"><a class="current reference internal" href="#">16. pandasによるデータ処理</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">付録</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../misc/math.html">集合と写像</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/how-to-execute-sql.html">Google Colab上でのSQLiteの使い方</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/drawio.html">draw.io の使い方</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference.html">参考文献</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://colab.research.google.com/github/hontolab-courses/database-lecturenote/blob/main/content/pandas/01.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Colab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Colab logo" src="../../_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/content/pandas/01.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button>


<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>pandasによるデータ処理</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">16.1. はじめに - 表データとデータフレーム</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">16.2. ライブラリの準備</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">16.3. データの読み込み</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#csv-tsv">16.3.1. CSV/TSVファイルを読み込む</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">16.3.2. 関係データベースへの問い合わせ結果を読み込む</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">16.4. データの確認</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id7">16.4.1. 表の行数，列数の確認</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id8">16.4.2. 表の行数</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id9">16.4.3. 表の項目情報</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id10">16.4.4. 基本統計量</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id11">16.5. データフレームへのアクセス</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id12">16.5.1. 先頭・末尾のレコード（行）の取得</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id13">16.5.2. 射影</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id14">16.5.3. データフレームに対する四則演算</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id15">16.5.4. 任意の行にあるレコードの取得</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id16">16.5.5. 絞り込み</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id17">16.5.6. 比較演算子を用いない絞り込み</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id18">16.5.6.1. いずれかの値にマッチするレコードの取得</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id19">16.5.6.2. 文字列の部分一致</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id20">16.6. データフレームの保存</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id21">16.7. 前処理</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id23">16.7.1. 列名の変更</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id24">16.7.2. データフレームの結合</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id25">16.7.2.1. 縦方向の結合</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id26">16.7.2.2. 横方向の結合</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id27">16.7.3. データの整然化：横持ちデータから縦持ちデータへ</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id28">16.7.4. 新しい列の追加</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id29">16.7.5. 関数の適用によるデータ加工</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id30">16.7.6. ダミー変数化</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id31">16.7.7. 集約演算</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id32">16.7.8. 欠損値の発見</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id33">16.7.8.1. 欠損値が存在する項目（列）を知りたい場合</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id34">16.7.8.2. 欠損値が存在するレコード（行）を知りたい場合</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id35">16.7.9. 欠損値を持つレコードの除去</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id36">16.7.9.1. いずれかの列項目に1つでも欠損値を含む場合</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id37">16.7.9.2. 指定した列項目に欠損値を含む場合</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#by-iqr">16.7.10. 外れ値の除去 by IQR</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id38">16.7.11. ソート</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id39">16.7.12. 順位付け</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id40">16.7.13. ビン分割</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#numpy">16.7.14. NumPy行列の取得</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id41">16.7.15. 正規化・標準化</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id42">16.7.16. データの分割</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="pandas">
<h1><span class="section-number">16. </span>pandasによるデータ処理<a class="headerlink" href="#pandas" title="Link to this heading">#</a></h1>
<p><a class="reference external" href="https://pandas.pydata.org">pandas</a>は表形式のデータを扱うために便利なPythonライブラリです．
pandasは行列データを効率的に扱う<a class="reference external" href="https://numpy.org/ja/">NumPy</a>をベースに実装されていることもあり，機械学習ライブラリとの相性も良いです．
そのため，Pythonを用いたデータ分析を行う際に非常に良く用いられています．</p>
<p>この文書では，データ分析の際に実用的に用いるpandasの機能についてピックアップします．</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p class="rubric" id="id1">なぜpandasでデータ処理をするのか？</p>
<p>集約演算などを使いこなせばSQLでもデータ処理はできるのに，なぜpandasを用いるのか？
それは，pandasはPythonの機械学習，統計モデリング，データ可視化のためのツールと相性が良い．
また，テキスト処理や日付処理，欠損値処理などの細かな前処理は，Pythonを使った方が圧倒的に効率がよい．</p>
<p>しかし，pandasにも弱点がある．
pandasは超大規模なデータの処理には向かない（分散・並列処理のためのPythonコードを自前で書かなければならない）．
一方，SQLはその背後に関係データベースシステムがデータ処理を最適化してくれるため，大規模データも効率よく処理できる．</p>
<p>pandasにもSQLにもそれぞれメリットとデメリットがあるため，両者をうまく使い分ける必要がある．</p>
<ul class="simple">
<li><p>データ分析や機械学習に必要となるデータを，SQLを使ってデータベースから抽出し</p></li>
<li><p>抽出したデータをPandasで読み込んでデータ処理する</p></li>
</ul>
<p>というのが典型的な使い分けになる．</p>
</div>
<section id="id2">
<h2><span class="section-number">16.1. </span>はじめに - 表データとデータフレーム<a class="headerlink" href="#id2" title="Link to this heading">#</a></h2>
<p>pandasで扱うデータは，以下のように行と列からなる表データです．</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>都道府県ID</p></th>
<th class="head"><p>都道府県名</p></th>
<th class="head"><p>2020年法定人口</p></th>
<th class="head"><p>県庁所在地</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
<td><p>北海道</p></td>
<td><p>5224614</p></td>
<td><p>札幌市</p></td>
</tr>
<tr class="row-odd"><td><p>2</p></td>
<td><p>青森県</p></td>
<td><p>1237984</p></td>
<td><p>青森市</p></td>
</tr>
<tr class="row-even"><td><p>3</p></td>
<td><p>岩手県</p></td>
<td><p>1210534</p></td>
<td><p>盛岡市</p></td>
</tr>
<tr class="row-odd"><td><p>…</p></td>
<td><p></p></td>
<td><p></p></td>
<td><p></p></td>
</tr>
</tbody>
</table>
</div>
<p>一般に表データはMicrosoftのExcelファイルで取り扱われることが多いです．
しかし，データ分析の世界では，比較的小さな表データは，特定のソフトウェアに依存しない（互換性の高い）<strong>CSV（comma-sepprated values）ファイル</strong>，もしくは<strong>TSV（tab-separated values）ファイル</strong>で保存/配布されることが多いです．
CSVファイルは表の各項目の値をカンマ（,）で区切ったテキストデータです．
CSVファイルの行が表の行に相当します．
CSVファイルの1行目には，表の項目名を並べることが多いです．
CSVファイルの拡張子には<code class="docutils literal notranslate"><span class="pre">.csv</span></code>が用いられます．</p>
<p>以下は，上記都道府県に関する表データをCSVファイルとして保存したその中身の例です．</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="n">都道府県ID</span><span class="p">,</span><span class="n">都道府県名</span><span class="p">,</span><span class="mi">2020</span><span class="n">年法定人口</span><span class="p">,</span><span class="n">県庁所在地</span>
 <span class="mi">1</span><span class="p">,</span><span class="n">北海道</span><span class="p">,</span><span class="mi">5224614</span><span class="p">,</span><span class="n">札幌市</span>
 <span class="mi">2</span><span class="p">,</span><span class="n">青森県</span><span class="p">,</span><span class="mi">1237984</span><span class="p">,</span><span class="n">青森市</span>
 <span class="mi">3</span><span class="p">,</span><span class="n">岩手県</span><span class="p">,</span><span class="mi">1210534</span><span class="p">,</span><span class="n">盛岡市</span>
<span class="o">...</span>
</pre></div>
</div>
<p>1行には表の項目（見出し）が，2行目以降には各都道府県に関するデータがカンマで区切られて定義されています．
上記ファイルはCSVファイルなので，各データがカンマで区切られています．
この表データをTSVファイルで保存する場合は，カンマではなくタブ記号（\t）でデータを区切ります．
TSVファイルの拡張子は<code class="docutils literal notranslate"><span class="pre">.tsv</span></code>です．</p>
<p>pandasライブラリでは，表形式のデータを<strong>データフレーム（DataFrame）</strong> という形式に変換してデータの前処理や分析を行います．
データフレームとはPythonで<strong>計算処理を効率的に行うための表データ</strong>だと思ってもらえばOKです．
以下，pandasの扱い方について説明します．</p>
</section>
<section id="id3">
<h2><span class="section-number">16.2. </span>ライブラリの準備<a class="headerlink" href="#id3" title="Link to this heading">#</a></h2>
<p>pandasはPythonの標準ライブラリではありません．
お手元の計算環境にpandasライブラリがない場合は，以下のコマンドでpandasをインストールしてください．</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>pip<span class="w"> </span>install<span class="w"> </span>pandas
</pre></div>
</div>
<p>Jupyterを用いている場合は，セルに以下を書いて実行してください．</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="k">except</span><span class="p">:</span>
    <span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>pandas
    <span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
</pre></div>
</div>
</div>
</div>
<p>pandasをインストール後，以下のコードを実行してpandasライブラリを読み込みます．</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 警告文を非表示に</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="id4">
<h2><span class="section-number">16.3. </span>データの読み込み<a class="headerlink" href="#id4" title="Link to this heading">#</a></h2>
<section id="csv-tsv">
<h3><span class="section-number">16.3.1. </span>CSV/TSVファイルを読み込む<a class="headerlink" href="#csv-tsv" title="Link to this heading">#</a></h3>
<p>Pythonで表データを分析する場合，誰かが作成したCSV/TSVファイルをpandasライブラリで読み込むのが典型的なシナリオです．
<a class="reference external" href="https://raw.githubusercontent.com/hontolab-courses/dmml-2022/main/dataset/titanic_train.csv">このURL</a>に<a class="reference external" href="https://ja.wikipedia.org/wiki/%E3%82%BF%E3%82%A4%E3%82%BF%E3%83%8B%E3%83%83%E3%82%AF_(%E5%AE%A2%E8%88%B9)">タイタニック号</a>の乗船客に関するCSVファイルがあります．
こちらをダウンロードしてpandasで読み込んでみましょう．
ダウンロードしたファイルは<code class="docutils literal notranslate"><span class="pre">dataset</span></code>ディレクトリに<code class="docutils literal notranslate"><span class="pre">titanic_train.csv</span></code>という名前で保存したとします．</p>
<p>pandasで表データを読み込むには<code class="docutils literal notranslate"><span class="pre">read_table</span></code>関数を用います．
以下は<code class="docutils literal notranslate"><span class="pre">dataset</span></code>ディレクトリにある<code class="docutils literal notranslate"><span class="pre">titanic_train.csv</span></code>を読み込み，ファイルの中身をデータフレームに変換したものを変数<code class="docutils literal notranslate"><span class="pre">df</span></code>に格納するコードです．
関数の1つ目の引数にファイルの保存先を指定します．
<code class="docutils literal notranslate"><span class="pre">sep</span></code>という引数では，読み込んだファイルに用いられている区切り文字を指定しています．
今回読み込むファイルはCSVファイルなのでカンマ（,）を指定しています．
TSVファイルを読み込む場合はタブ文字（\t）を指定します．</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="s1">&#39;dataset/titanic_train.csv&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>変数<code class="docutils literal notranslate"><span class="pre">df</span></code>を表示してみましょう．
Jupyterを用いている場合，下記コードを実行すると<code class="docutils literal notranslate"><span class="pre">df</span></code>の中身（の一部）が表示されます．
データフレーム形式のデータが得られていることが分かります．</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>PassengerId</th>
      <th>Survived</th>
      <th>Pclass</th>
      <th>Name</th>
      <th>Sex</th>
      <th>Age</th>
      <th>SibSp</th>
      <th>Parch</th>
      <th>Ticket</th>
      <th>Fare</th>
      <th>Cabin</th>
      <th>Embarked</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>0</td>
      <td>3</td>
      <td>Braund, Mr. Owen Harris</td>
      <td>male</td>
      <td>22.0</td>
      <td>1</td>
      <td>0</td>
      <td>A/5 21171</td>
      <td>7.2500</td>
      <td>NaN</td>
      <td>S</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>1</td>
      <td>1</td>
      <td>Cumings, Mrs. John Bradley (Florence Briggs Th...</td>
      <td>female</td>
      <td>38.0</td>
      <td>1</td>
      <td>0</td>
      <td>PC 17599</td>
      <td>71.2833</td>
      <td>C85</td>
      <td>C</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>1</td>
      <td>3</td>
      <td>Heikkinen, Miss. Laina</td>
      <td>female</td>
      <td>26.0</td>
      <td>0</td>
      <td>0</td>
      <td>STON/O2. 3101282</td>
      <td>7.9250</td>
      <td>NaN</td>
      <td>S</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>1</td>
      <td>1</td>
      <td>Futrelle, Mrs. Jacques Heath (Lily May Peel)</td>
      <td>female</td>
      <td>35.0</td>
      <td>1</td>
      <td>0</td>
      <td>113803</td>
      <td>53.1000</td>
      <td>C123</td>
      <td>S</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>0</td>
      <td>3</td>
      <td>Allen, Mr. William Henry</td>
      <td>male</td>
      <td>35.0</td>
      <td>0</td>
      <td>0</td>
      <td>373450</td>
      <td>8.0500</td>
      <td>NaN</td>
      <td>S</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>886</th>
      <td>887</td>
      <td>0</td>
      <td>2</td>
      <td>Montvila, Rev. Juozas</td>
      <td>male</td>
      <td>27.0</td>
      <td>0</td>
      <td>0</td>
      <td>211536</td>
      <td>13.0000</td>
      <td>NaN</td>
      <td>S</td>
    </tr>
    <tr>
      <th>887</th>
      <td>888</td>
      <td>1</td>
      <td>1</td>
      <td>Graham, Miss. Margaret Edith</td>
      <td>female</td>
      <td>19.0</td>
      <td>0</td>
      <td>0</td>
      <td>112053</td>
      <td>30.0000</td>
      <td>B42</td>
      <td>S</td>
    </tr>
    <tr>
      <th>888</th>
      <td>889</td>
      <td>0</td>
      <td>3</td>
      <td>Johnston, Miss. Catherine Helen "Carrie"</td>
      <td>female</td>
      <td>NaN</td>
      <td>1</td>
      <td>2</td>
      <td>W./C. 6607</td>
      <td>23.4500</td>
      <td>NaN</td>
      <td>S</td>
    </tr>
    <tr>
      <th>889</th>
      <td>890</td>
      <td>1</td>
      <td>1</td>
      <td>Behr, Mr. Karl Howell</td>
      <td>male</td>
      <td>26.0</td>
      <td>0</td>
      <td>0</td>
      <td>111369</td>
      <td>30.0000</td>
      <td>C148</td>
      <td>C</td>
    </tr>
    <tr>
      <th>890</th>
      <td>891</td>
      <td>0</td>
      <td>3</td>
      <td>Dooley, Mr. Patrick</td>
      <td>male</td>
      <td>32.0</td>
      <td>0</td>
      <td>0</td>
      <td>370376</td>
      <td>7.7500</td>
      <td>NaN</td>
      <td>Q</td>
    </tr>
  </tbody>
</table>
<p>891 rows × 12 columns</p>
</div></div></div>
</div>
<p>先ほどはダウンロードしたファイルを読み込みましたが，<code class="docutils literal notranslate"><span class="pre">read_table</span></code>関数はURLを指定することでファイルのダウンロードと読み込みを一括して行ってくれます．
先ほどのコードを以下に書き換えると，指定したURL上のファイルを読み込み，データフレームを作成します．</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="s1">&#39;https://raw.githubusercontent.com/hontolab-courses/dmml-2022/main/dataset/titanic_train.csv&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">read_table</span></code>関数は引数に様々なオプションを指定できます（詳しくは<a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.read_table.html">ドキュメント</a>を参考）．
代表的な引数は以下の通りです：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">sep</span></code>: 区切り文字</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">header</span></code>: 指定ファイルの中で見出し項目が格納された行番号（デフォルトは0）</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">encoding</span></code>: ファイルの文字コード</p></li>
</ul>
<p>例えば，<a class="reference external" href="https://www.nstac.go.jp/sys/files/SSDSE-E-2024.csv">こちらのURL</a>で公開されている独立行政法人統計センター作成の<a class="reference external" href="https://www.nstac.go.jp/use/literacy/ssdse/#SSDSE-E">教育用標準データセットSSDSE-基本素材（SSDSE-E）</a>の表データを読み込んでみましょう．</p>
<p>このデータはCSVファイルに格納されていますが，文字コードとしてSHIFT-JISが用いられています．
また，表の見出しは3行目で定義されており，4行目以降に実データが記述されています．
このことを踏まえて，SSDSE-Eのデータをデータフレームとして読み込むコードは以下となります．</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># CSVファイルの1行目をpandasではゼロ行目と読むので，3行目のデータを見出しとして指定する場合はheader=2となる</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="s1">&#39;https://www.nstac.go.jp/sys/files/SSDSE-E-2024.csv&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;shift-jis&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="id5">
<h3><span class="section-number">16.3.2. </span>関係データベースへの問い合わせ結果を読み込む<a class="headerlink" href="#id5" title="Link to this heading">#</a></h3>
<p>pandasには，MySQLやSQLiteなどの関係データベースに対する問い合わせ結果をDataFrameオブジェクトとして読み込む<code class="docutils literal notranslate"><span class="pre">read_sql</span></code>関数がある．
<code class="docutils literal notranslate"><span class="pre">read_sql</span></code>関数は第1引数にSQL文，第2引数にデータベースにアクセスするための「データベースエンジン」を指定する．</p>
<p>データベースエンジンの生成には<a class="reference external" href="https://docs.sqlalchemy.org/en/20/core/connections.html">SQLAlchemy</a>ライブラリが便利．
エンジンの生成は以下のように行う．</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">sqlalchemy</span>

<span class="c1"># SQLiteを用いる場合</span>
<span class="c1"># データベースファイルがdataset/SSDSE.dbにあると仮定</span>
<span class="n">db_path</span> <span class="o">=</span> <span class="s1">&#39;dataset/SSDSE.db&#39;</span>
<span class="n">engine</span> <span class="o">=</span> <span class="n">sqlalchemy</span><span class="o">.</span><span class="n">create_engine</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;sqlite:///</span><span class="si">{</span><span class="n">db_path</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="c1"># MySQLを用いる場合</span>
<span class="c1"># mysql_user = &#39;sample_user&#39;</span>
<span class="c1"># mysql_passwd = &#39;password&#39;</span>
<span class="c1"># mysql_host = &#39;localhost&#39;</span>
<span class="c1"># mysql_port = 3306</span>
<span class="c1"># db_name = &#39;SSDSE&#39;</span>
<span class="c1"># db_url = f&#39;mysql+pymysql://{mysql_user}:{mysql_password}@{mysql_host}:{mysql_port}/{db_name}?charset=utf8&#39;</span>
<span class="c1"># engine = sqlalchemy.create_engine(db_url)</span>
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">read_sql</span></code>関数にSQL文とエンジンを指定すれば，DataFrameオブジェクトに変換されたデータベースへの問い合わせ結果が得られる．
今仮に，独立行政法人統計センターが公開している<a class="reference external" href="https://www.nstac.go.jp/use/literacy/ssdse/#SSDSE-E">教育用標準データセット（SSDSE）</a>の基本素材SSDSE-E（データの解説はこちら）から抜粋・加工したデータが，<code class="docutils literal notranslate"><span class="pre">SSDSE</span></code>データベースの中に<code class="docutils literal notranslate"><span class="pre">population</span></code>というテーブルで格納されていたとする．
以下は，そのテーブルにある全レコードを取得するSQLの結果をDataFrameオブジェクトとして得るコード例である．</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sql</span> <span class="o">=</span> <span class="s1">&#39;SELECT * FROM population;&#39;</span>
<span class="n">pd</span><span class="o">.</span><span class="n">read_sql</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="n">engine</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>地域コード</th>
      <th>都道府県</th>
      <th>調査年度</th>
      <th>総人口</th>
      <th>小学校児童数</th>
      <th>中学校生徒数</th>
      <th>高等学校生徒数</th>
      <th>大学学生数</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>R01000</td>
      <td>北海道</td>
      <td>2021</td>
      <td>5183000</td>
      <td>231714</td>
      <td>122742</td>
      <td>115335</td>
      <td>79729</td>
    </tr>
    <tr>
      <th>1</th>
      <td>R02000</td>
      <td>青森県</td>
      <td>2021</td>
      <td>1221000</td>
      <td>54460</td>
      <td>29940</td>
      <td>30543</td>
      <td>15419</td>
    </tr>
    <tr>
      <th>2</th>
      <td>R03000</td>
      <td>岩手県</td>
      <td>2021</td>
      <td>1196000</td>
      <td>55597</td>
      <td>30269</td>
      <td>29980</td>
      <td>11340</td>
    </tr>
    <tr>
      <th>3</th>
      <td>R04000</td>
      <td>宮城県</td>
      <td>2021</td>
      <td>2290000</td>
      <td>112246</td>
      <td>58748</td>
      <td>55329</td>
      <td>49580</td>
    </tr>
    <tr>
      <th>4</th>
      <td>R05000</td>
      <td>秋田県</td>
      <td>2021</td>
      <td>945000</td>
      <td>38992</td>
      <td>21924</td>
      <td>21448</td>
      <td>8904</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>89</th>
      <td>R43000</td>
      <td>熊本県</td>
      <td>2020</td>
      <td>1738301</td>
      <td>96934</td>
      <td>48218</td>
      <td>45401</td>
      <td>24771</td>
    </tr>
    <tr>
      <th>90</th>
      <td>R44000</td>
      <td>大分県</td>
      <td>2020</td>
      <td>1123852</td>
      <td>57705</td>
      <td>29212</td>
      <td>29937</td>
      <td>15278</td>
    </tr>
    <tr>
      <th>91</th>
      <td>R45000</td>
      <td>宮崎県</td>
      <td>2020</td>
      <td>1069576</td>
      <td>60450</td>
      <td>30211</td>
      <td>29590</td>
      <td>9924</td>
    </tr>
    <tr>
      <th>92</th>
      <td>R46000</td>
      <td>鹿児島県</td>
      <td>2020</td>
      <td>1588256</td>
      <td>89738</td>
      <td>44912</td>
      <td>43928</td>
      <td>15432</td>
    </tr>
    <tr>
      <th>93</th>
      <td>R47000</td>
      <td>沖縄県</td>
      <td>2020</td>
      <td>1467480</td>
      <td>101918</td>
      <td>48763</td>
      <td>44037</td>
      <td>17932</td>
    </tr>
  </tbody>
</table>
<p>94 rows × 8 columns</p>
</div></div></div>
</div>
</section>
</section>
<section id="id6">
<h2><span class="section-number">16.4. </span>データの確認<a class="headerlink" href="#id6" title="Link to this heading">#</a></h2>
<p>以下，上で読み込んだ独立行政法人統計センター作成の<a class="reference external" href="https://www.nstac.go.jp/use/literacy/ssdse/#SSDSE-E">教育用標準データセットSSDSE-基本素材（SSDSE-E）</a>の表データがデータフレームに変換の上，変数<code class="docutils literal notranslate"><span class="pre">df</span></code>に格納されているとの前提で説明します．</p>
<section id="id7">
<h3><span class="section-number">16.4.1. </span>表の行数，列数の確認<a class="headerlink" href="#id7" title="Link to this heading">#</a></h3>
<p>DataFrameオブジェクトのプロパティ<code class="docutils literal notranslate"><span class="pre">shape</span></code>にアクセスすると行数と列数のタプルが得られます．</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(48, 92)
</pre></div>
</div>
</div>
</div>
</section>
<section id="id8">
<h3><span class="section-number">16.4.2. </span>表の行数<a class="headerlink" href="#id8" title="Link to this heading">#</a></h3>
<p>表データの行数だけを得たいときは，<code class="docutils literal notranslate"><span class="pre">len</span></code>関数を用います．</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>48
</pre></div>
</div>
</div>
</div>
</section>
<section id="id9">
<h3><span class="section-number">16.4.3. </span>表の項目情報<a class="headerlink" href="#id9" title="Link to this heading">#</a></h3>
<p>表データの項目名を取得したい場合は，DataFrameオブジェクトのプロパティ<code class="docutils literal notranslate"><span class="pre">columns</span></code>にアクセスします．
<code class="docutils literal notranslate"><span class="pre">columns</span></code>にアクセスすると，項目名のリストを得られます．</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">columns</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Index([&#39;地域コード&#39;, &#39;都道府県&#39;, &#39;総人口&#39;, &#39;日本人人口&#39;, &#39;15歳未満人口&#39;, &#39;15〜64歳人口&#39;, &#39;65歳以上人口&#39;,
       &#39;外国人人口&#39;, &#39;出生数&#39;, &#39;合計特殊出生率&#39;, &#39;死亡数&#39;, &#39;転入者数（日本人移動者）&#39;, &#39;転出者数（日本人移動者）&#39;,
       &#39;一般世帯数&#39;, &#39;一般世帯人員数&#39;, &#39;単独世帯数&#39;, &#39;婚姻件数&#39;, &#39;離婚件数&#39;, &#39;総面積（北方地域及び竹島を除く）&#39;,
       &#39;可住地面積&#39;, &#39;自然公園面積&#39;, &#39;県内総生産額（平成27年基準）&#39;, &#39;県民所得（平成27年基準）&#39;,
       &#39;1人当たり県民所得（平成27年基準）&#39;, &#39;事業所数（民営）&#39;, &#39;事業所数（民営）（建設業）&#39;, &#39;事業所数（民営）（製造業）&#39;,
       &#39;事業所数（民営）（情報通信業）&#39;, &#39;事業所数（民営）（卸売業、小売業）&#39;, &#39;事業所数（民営）（宿泊業、飲食サービス業）&#39;,
       &#39;事業所数（民営）（生活関連サービス業、娯楽業）&#39;, &#39;事業所数（民営）（医療、福祉）&#39;, &#39;従業者数（民営）&#39;,
       &#39;従業者数（民営）（建設業）&#39;, &#39;従業者数（民営）（製造業）&#39;, &#39;従業者数（民営）（情報通信業）&#39;,
       &#39;従業者数（民営）（卸売業、小売業）&#39;, &#39;従業者数（民営）（宿泊業、飲食サービス業）&#39;, &#39;従業者数（民営）（生活関連サービス業、娯楽業）&#39;,
       &#39;従業者数（民営）（医療、福祉）&#39;, &#39;農家数（販売農家）&#39;, &#39;農家数（自給的農家）&#39;, &#39;耕地面積&#39;, &#39;旅館営業施設数（ホテルを含む）&#39;,
       &#39;旅館営業施設客室数（ホテルを含む）&#39;, &#39;幼稚園数&#39;, &#39;幼稚園在園者数&#39;, &#39;小学校数&#39;, &#39;小学校児童数&#39;, &#39;中学校数&#39;,
       &#39;中学校生徒数&#39;, &#39;高等学校数&#39;, &#39;高等学校生徒数&#39;, &#39;短期大学数&#39;, &#39;大学数&#39;, &#39;短期大学学生数&#39;, &#39;大学学生数&#39;,
       &#39;公民館数&#39;, &#39;図書館数&#39;, &#39;博物館数&#39;, &#39;劇場、音楽堂等数&#39;, &#39;社会体育施設数&#39;, &#39;民間体育施設数&#39;, &#39;映画館数&#39;,
       &#39;一般旅券発行件数&#39;, &#39;延べ宿泊者数&#39;, &#39;外国人延べ宿泊者数&#39;, &#39;総住宅数&#39;, &#39;空き家数&#39;, &#39;持ち家数&#39;, &#39;一戸建住宅数&#39;,
       &#39;1住宅当たり延べ面積&#39;, &#39;総人口（非水洗化人口＋水洗化人口）&#39;, &#39;非水洗化人口&#39;, &#39;ごみ総排出量（総量）&#39;,
       &#39;1人1日当たりの排出量&#39;, &#39;ごみのリサイクル率&#39;, &#39;小売店数&#39;, &#39;飲食店数&#39;, &#39;大型小売店数&#39;, &#39;一般病院数&#39;, &#39;一般診療所数&#39;,
       &#39;歯科診療所数&#39;, &#39;医師数&#39;, &#39;歯科医師数&#39;, &#39;薬剤師数&#39;, &#39;保育所等数&#39;, &#39;保育所等在所児数&#39;, &#39;消費支出（二人以上の世帯）&#39;,
       &#39;食料費（二人以上の世帯）&#39;, &#39;住居費（二人以上の世帯）&#39;, &#39;教養娯楽費（二人以上の世帯）&#39;],
      dtype=&#39;object&#39;)
</pre></div>
</div>
</div>
</div>
<p>DataFrameオブジェクトのメソッド<code class="docutils literal notranslate"><span class="pre">info</span></code>を用いると，表の各項目の名前に加えて型情報や欠損していないデータの数などの情報が得られます．</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 48 entries, 0 to 47
Data columns (total 92 columns):
 #   Column                   Non-Null Count  Dtype  
---  ------                   --------------  -----  
 0   地域コード                    48 non-null     object 
 1   都道府県                     48 non-null     object 
 2   総人口                      48 non-null     int64  
 3   日本人人口                    48 non-null     int64  
 4   15歳未満人口                  48 non-null     int64  
 5   15〜64歳人口                 48 non-null     int64  
 6   65歳以上人口                  48 non-null     int64  
 7   外国人人口                    48 non-null     int64  
 8   出生数                      48 non-null     int64  
 9   合計特殊出生率                  48 non-null     float64
 10  死亡数                      48 non-null     int64  
 11  転入者数（日本人移動者）             48 non-null     int64  
 12  転出者数（日本人移動者）             48 non-null     int64  
 13  一般世帯数                    48 non-null     int64  
 14  一般世帯人員数                  48 non-null     int64  
 15  単独世帯数                    48 non-null     int64  
 16  婚姻件数                     48 non-null     int64  
 17  離婚件数                     48 non-null     int64  
 18  総面積（北方地域及び竹島を除く）         48 non-null     int64  
 19  可住地面積                    48 non-null     int64  
 20  自然公園面積                   48 non-null     int64  
 21  県内総生産額（平成27年基準）          48 non-null     int64  
 22  県民所得（平成27年基準）            48 non-null     int64  
 23  1人当たり県民所得（平成27年基準）       48 non-null     int64  
 24  事業所数（民営）                 48 non-null     int64  
 25  事業所数（民営）（建設業）            48 non-null     int64  
 26  事業所数（民営）（製造業）            48 non-null     int64  
 27  事業所数（民営）（情報通信業）          48 non-null     int64  
 28  事業所数（民営）（卸売業、小売業）        48 non-null     int64  
 29  事業所数（民営）（宿泊業、飲食サービス業）    48 non-null     int64  
 30  事業所数（民営）（生活関連サービス業、娯楽業）  48 non-null     int64  
 31  事業所数（民営）（医療、福祉）          48 non-null     int64  
 32  従業者数（民営）                 48 non-null     int64  
 33  従業者数（民営）（建設業）            48 non-null     int64  
 34  従業者数（民営）（製造業）            48 non-null     int64  
 35  従業者数（民営）（情報通信業）          48 non-null     int64  
 36  従業者数（民営）（卸売業、小売業）        48 non-null     int64  
 37  従業者数（民営）（宿泊業、飲食サービス業）    48 non-null     int64  
 38  従業者数（民営）（生活関連サービス業、娯楽業）  48 non-null     int64  
 39  従業者数（民営）（医療、福祉）          48 non-null     int64  
 40  農家数（販売農家）                48 non-null     int64  
 41  農家数（自給的農家）               48 non-null     int64  
 42  耕地面積                     48 non-null     int64  
 43  旅館営業施設数（ホテルを含む）          48 non-null     int64  
 44  旅館営業施設客室数（ホテルを含む）        48 non-null     int64  
 45  幼稚園数                     48 non-null     int64  
 46  幼稚園在園者数                  48 non-null     int64  
 47  小学校数                     48 non-null     int64  
 48  小学校児童数                   48 non-null     int64  
 49  中学校数                     48 non-null     int64  
 50  中学校生徒数                   48 non-null     int64  
 51  高等学校数                    48 non-null     int64  
 52  高等学校生徒数                  48 non-null     int64  
 53  短期大学数                    48 non-null     int64  
 54  大学数                      48 non-null     int64  
 55  短期大学学生数                  48 non-null     int64  
 56  大学学生数                    48 non-null     int64  
 57  公民館数                     48 non-null     int64  
 58  図書館数                     48 non-null     int64  
 59  博物館数                     48 non-null     int64  
 60  劇場、音楽堂等数                 48 non-null     int64  
 61  社会体育施設数                  48 non-null     int64  
 62  民間体育施設数                  48 non-null     int64  
 63  映画館数                     48 non-null     int64  
 64  一般旅券発行件数                 48 non-null     int64  
 65  延べ宿泊者数                   48 non-null     int64  
 66  外国人延べ宿泊者数                48 non-null     int64  
 67  総住宅数                     48 non-null     int64  
 68  空き家数                     48 non-null     int64  
 69  持ち家数                     48 non-null     int64  
 70  一戸建住宅数                   48 non-null     int64  
 71  1住宅当たり延べ面積               48 non-null     float64
 72  総人口（非水洗化人口＋水洗化人口）        48 non-null     int64  
 73  非水洗化人口                   48 non-null     int64  
 74  ごみ総排出量（総量）               48 non-null     int64  
 75  1人1日当たりの排出量              48 non-null     int64  
 76  ごみのリサイクル率                48 non-null     float64
 77  小売店数                     48 non-null     int64  
 78  飲食店数                     48 non-null     int64  
 79  大型小売店数                   48 non-null     int64  
 80  一般病院数                    48 non-null     int64  
 81  一般診療所数                   48 non-null     int64  
 82  歯科診療所数                   48 non-null     int64  
 83  医師数                      48 non-null     int64  
 84  歯科医師数                    48 non-null     int64  
 85  薬剤師数                     48 non-null     int64  
 86  保育所等数                    48 non-null     int64  
 87  保育所等在所児数                 48 non-null     int64  
 88  消費支出（二人以上の世帯）            48 non-null     int64  
 89  食料費（二人以上の世帯）             48 non-null     int64  
 90  住居費（二人以上の世帯）             48 non-null     int64  
 91  教養娯楽費（二人以上の世帯）           48 non-null     int64  
dtypes: float64(3), int64(87), object(2)
memory usage: 34.6+ KB
</pre></div>
</div>
</div>
</div>
</section>
<section id="id10">
<h3><span class="section-number">16.4.4. </span>基本統計量<a class="headerlink" href="#id10" title="Link to this heading">#</a></h3>
<p>DataFrameオブジェクトのメソッド<code class="docutils literal notranslate"><span class="pre">describe</span></code>を用いると，表の各項目の基本統計量が得られます．
得られる基本統計量は以下の通りです：</p>
<ul class="simple">
<li><p>データ数</p></li>
<li><p>平均</p></li>
<li><p>標準偏差</p></li>
<li><p>最小値，最大値</p></li>
<li><p>中央値</p></li>
<li><p>第1四分位数，第3四分位数</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>総人口</th>
      <th>日本人人口</th>
      <th>15歳未満人口</th>
      <th>15〜64歳人口</th>
      <th>65歳以上人口</th>
      <th>外国人人口</th>
      <th>出生数</th>
      <th>合計特殊出生率</th>
      <th>死亡数</th>
      <th>転入者数（日本人移動者）</th>
      <th>...</th>
      <th>歯科診療所数</th>
      <th>医師数</th>
      <th>歯科医師数</th>
      <th>薬剤師数</th>
      <th>保育所等数</th>
      <th>保育所等在所児数</th>
      <th>消費支出（二人以上の世帯）</th>
      <th>食料費（二人以上の世帯）</th>
      <th>住居費（二人以上の世帯）</th>
      <th>教養娯楽費（二人以上の世帯）</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>4.800000e+01</td>
      <td>4.800000e+01</td>
      <td>4.800000e+01</td>
      <td>4.800000e+01</td>
      <td>4.800000e+01</td>
      <td>4.800000e+01</td>
      <td>48.000000</td>
      <td>48.000000</td>
      <td>4.800000e+01</td>
      <td>4.800000e+01</td>
      <td>...</td>
      <td>48.000000</td>
      <td>48.000000</td>
      <td>48.000000</td>
      <td>48.000000</td>
      <td>48.000000</td>
      <td>4.800000e+01</td>
      <td>48.000000</td>
      <td>48.000000</td>
      <td>48.00000</td>
      <td>48.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>5.206104e+06</td>
      <td>5.084646e+06</td>
      <td>6.043125e+05</td>
      <td>3.092000e+06</td>
      <td>1.509812e+06</td>
      <td>1.001025e+05</td>
      <td>33817.354167</td>
      <td>1.397708</td>
      <td>5.997579e+04</td>
      <td>9.397342e+04</td>
      <td>...</td>
      <td>2829.125000</td>
      <td>14150.958333</td>
      <td>4476.791667</td>
      <td>13415.916667</td>
      <td>1249.750000</td>
      <td>1.101331e+05</td>
      <td>289656.083333</td>
      <td>76615.958333</td>
      <td>19231.12500</td>
      <td>25987.687500</td>
    </tr>
    <tr>
      <th>std</th>
      <td>1.786588e+07</td>
      <td>1.744375e+07</td>
      <td>2.072707e+06</td>
      <td>1.063209e+07</td>
      <td>5.164664e+06</td>
      <td>3.497592e+05</td>
      <td>116144.047847</td>
      <td>0.145225</td>
      <td>2.051223e+05</td>
      <td>3.259851e+05</td>
      <td>...</td>
      <td>9765.277128</td>
      <td>48665.779507</td>
      <td>15458.270437</td>
      <td>46353.143907</td>
      <td>4278.561169</td>
      <td>3.769878e+05</td>
      <td>18982.531256</td>
      <td>5518.803196</td>
      <td>4783.81712</td>
      <td>3771.185339</td>
    </tr>
    <tr>
      <th>min</th>
      <td>5.440000e+05</td>
      <td>5.390000e+05</td>
      <td>6.600000e+04</td>
      <td>2.980000e+05</td>
      <td>1.800000e+05</td>
      <td>3.651000e+03</td>
      <td>3708.000000</td>
      <td>1.080000</td>
      <td>7.605000e+03</td>
      <td>7.967000e+03</td>
      <td>...</td>
      <td>254.000000</td>
      <td>1871.000000</td>
      <td>369.000000</td>
      <td>1229.000000</td>
      <td>185.000000</td>
      <td>1.640300e+04</td>
      <td>245054.000000</td>
      <td>67889.000000</td>
      <td>6220.00000</td>
      <td>17601.000000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>1.049250e+06</td>
      <td>1.041250e+06</td>
      <td>1.205000e+05</td>
      <td>5.690000e+05</td>
      <td>3.500000e+05</td>
      <td>9.606750e+03</td>
      <td>6409.750000</td>
      <td>1.300000</td>
      <td>1.366800e+04</td>
      <td>1.544575e+04</td>
      <td>...</td>
      <td>489.500000</td>
      <td>2867.250000</td>
      <td>738.000000</td>
      <td>2424.000000</td>
      <td>298.750000</td>
      <td>2.488425e+04</td>
      <td>276968.250000</td>
      <td>72335.500000</td>
      <td>16401.00000</td>
      <td>22929.250000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>1.640500e+06</td>
      <td>1.619500e+06</td>
      <td>2.025000e+05</td>
      <td>9.135000e+05</td>
      <td>5.270000e+05</td>
      <td>1.567700e+04</td>
      <td>11108.000000</td>
      <td>1.400000</td>
      <td>2.180900e+04</td>
      <td>2.477100e+04</td>
      <td>...</td>
      <td>804.000000</td>
      <td>4348.500000</td>
      <td>1277.500000</td>
      <td>3524.000000</td>
      <td>447.500000</td>
      <td>3.953300e+04</td>
      <td>289323.000000</td>
      <td>75822.500000</td>
      <td>19698.50000</td>
      <td>25953.500000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>2.780000e+06</td>
      <td>2.722750e+06</td>
      <td>3.257500e+05</td>
      <td>1.609250e+06</td>
      <td>8.355000e+05</td>
      <td>5.268950e+04</td>
      <td>17035.500000</td>
      <td>1.467500</td>
      <td>3.228400e+04</td>
      <td>4.818850e+04</td>
      <td>...</td>
      <td>1413.000000</td>
      <td>7921.500000</td>
      <td>2151.000000</td>
      <td>6954.000000</td>
      <td>684.500000</td>
      <td>5.955550e+04</td>
      <td>301817.000000</td>
      <td>80910.250000</td>
      <td>22282.00000</td>
      <td>28304.500000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>1.249470e+08</td>
      <td>1.220310e+08</td>
      <td>1.450300e+07</td>
      <td>7.420800e+07</td>
      <td>3.623600e+07</td>
      <td>2.402460e+06</td>
      <td>811622.000000</td>
      <td>1.800000</td>
      <td>1.439856e+06</td>
      <td>2.255362e+06</td>
      <td>...</td>
      <td>67899.000000</td>
      <td>339623.000000</td>
      <td>107443.000000</td>
      <td>321982.000000</td>
      <td>29994.000000</td>
      <td>2.643196e+06</td>
      <td>324793.000000</td>
      <td>87973.000000</td>
      <td>30323.00000</td>
      <td>35050.000000</td>
    </tr>
  </tbody>
</table>
<p>8 rows × 90 columns</p>
</div></div></div>
</div>
</section>
</section>
<section id="id11">
<h2><span class="section-number">16.5. </span>データフレームへのアクセス<a class="headerlink" href="#id11" title="Link to this heading">#</a></h2>
<section id="id12">
<h3><span class="section-number">16.5.1. </span>先頭・末尾のレコード（行）の取得<a class="headerlink" href="#id12" title="Link to this heading">#</a></h3>
<p>DataFrameオブジェクトのメソッド<code class="docutils literal notranslate"><span class="pre">head</span></code>は，データフレームの先頭<span class="math notranslate nohighlight">\(N\)</span>件のレコードを返す．
引数に何も指定しないと5件返す．</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>地域コード</th>
      <th>都道府県</th>
      <th>総人口</th>
      <th>日本人人口</th>
      <th>15歳未満人口</th>
      <th>15〜64歳人口</th>
      <th>65歳以上人口</th>
      <th>外国人人口</th>
      <th>出生数</th>
      <th>合計特殊出生率</th>
      <th>...</th>
      <th>歯科診療所数</th>
      <th>医師数</th>
      <th>歯科医師数</th>
      <th>薬剤師数</th>
      <th>保育所等数</th>
      <th>保育所等在所児数</th>
      <th>消費支出（二人以上の世帯）</th>
      <th>食料費（二人以上の世帯）</th>
      <th>住居費（二人以上の世帯）</th>
      <th>教養娯楽費（二人以上の世帯）</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>R00000</td>
      <td>全国</td>
      <td>124947000</td>
      <td>122031000</td>
      <td>14503000</td>
      <td>74208000</td>
      <td>36236000</td>
      <td>2402460</td>
      <td>811622</td>
      <td>1.30</td>
      <td>...</td>
      <td>67899</td>
      <td>339623</td>
      <td>107443</td>
      <td>321982</td>
      <td>29994</td>
      <td>2643196</td>
      <td>290865</td>
      <td>77474</td>
      <td>18645</td>
      <td>26642</td>
    </tr>
    <tr>
      <th>1</th>
      <td>R01000</td>
      <td>北海道</td>
      <td>5140000</td>
      <td>5098000</td>
      <td>530000</td>
      <td>2924000</td>
      <td>1686000</td>
      <td>34321</td>
      <td>28762</td>
      <td>1.20</td>
      <td>...</td>
      <td>2818</td>
      <td>13731</td>
      <td>4418</td>
      <td>11802</td>
      <td>1075</td>
      <td>76885</td>
      <td>277737</td>
      <td>73037</td>
      <td>24873</td>
      <td>27234</td>
    </tr>
    <tr>
      <th>2</th>
      <td>R02000</td>
      <td>青森県</td>
      <td>1204000</td>
      <td>1198000</td>
      <td>123000</td>
      <td>663000</td>
      <td>419000</td>
      <td>5409</td>
      <td>6513</td>
      <td>1.31</td>
      <td>...</td>
      <td>505</td>
      <td>2773</td>
      <td>735</td>
      <td>2345</td>
      <td>472</td>
      <td>30738</td>
      <td>249660</td>
      <td>73725</td>
      <td>10541</td>
      <td>20068</td>
    </tr>
    <tr>
      <th>3</th>
      <td>R03000</td>
      <td>岩手県</td>
      <td>1181000</td>
      <td>1173000</td>
      <td>125000</td>
      <td>648000</td>
      <td>408000</td>
      <td>6937</td>
      <td>6472</td>
      <td>1.30</td>
      <td>...</td>
      <td>557</td>
      <td>2700</td>
      <td>1016</td>
      <td>2536</td>
      <td>393</td>
      <td>28580</td>
      <td>285815</td>
      <td>77251</td>
      <td>18814</td>
      <td>25733</td>
    </tr>
    <tr>
      <th>4</th>
      <td>R04000</td>
      <td>宮城県</td>
      <td>2280000</td>
      <td>2256000</td>
      <td>258000</td>
      <td>1363000</td>
      <td>659000</td>
      <td>19453</td>
      <td>13761</td>
      <td>1.15</td>
      <td>...</td>
      <td>1051</td>
      <td>5950</td>
      <td>1896</td>
      <td>5502</td>
      <td>506</td>
      <td>40519</td>
      <td>287781</td>
      <td>78589</td>
      <td>22951</td>
      <td>26516</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 92 columns</p>
</div></div></div>
</div>
<p>DataFrameオブジェクトのメソッド<code class="docutils literal notranslate"><span class="pre">tail</span></code>は，データフレームの末尾<span class="math notranslate nohighlight">\(N\)</span>件のレコードを返す．
引数に何も指定しないと5件返す．</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">tail</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>地域コード</th>
      <th>都道府県</th>
      <th>総人口</th>
      <th>日本人人口</th>
      <th>15歳未満人口</th>
      <th>15〜64歳人口</th>
      <th>65歳以上人口</th>
      <th>外国人人口</th>
      <th>出生数</th>
      <th>合計特殊出生率</th>
      <th>...</th>
      <th>歯科診療所数</th>
      <th>医師数</th>
      <th>歯科医師数</th>
      <th>薬剤師数</th>
      <th>保育所等数</th>
      <th>保育所等在所児数</th>
      <th>消費支出（二人以上の世帯）</th>
      <th>食料費（二人以上の世帯）</th>
      <th>住居費（二人以上の世帯）</th>
      <th>教養娯楽費（二人以上の世帯）</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>43</th>
      <td>R43000</td>
      <td>熊本県</td>
      <td>1718000</td>
      <td>1699000</td>
      <td>223000</td>
      <td>943000</td>
      <td>552000</td>
      <td>14591</td>
      <td>12670</td>
      <td>1.59</td>
      <td>...</td>
      <td>835</td>
      <td>5415</td>
      <td>1377</td>
      <td>4036</td>
      <td>623</td>
      <td>52158</td>
      <td>281836</td>
      <td>70132</td>
      <td>30323</td>
      <td>24428</td>
    </tr>
    <tr>
      <th>44</th>
      <td>R44000</td>
      <td>大分県</td>
      <td>1107000</td>
      <td>1092000</td>
      <td>131000</td>
      <td>600000</td>
      <td>376000</td>
      <td>10168</td>
      <td>7327</td>
      <td>1.54</td>
      <td>...</td>
      <td>530</td>
      <td>3370</td>
      <td>740</td>
      <td>2317</td>
      <td>335</td>
      <td>26578</td>
      <td>298060</td>
      <td>75218</td>
      <td>18820</td>
      <td>28260</td>
    </tr>
    <tr>
      <th>45</th>
      <td>R45000</td>
      <td>宮崎県</td>
      <td>1052000</td>
      <td>1044000</td>
      <td>136000</td>
      <td>565000</td>
      <td>352000</td>
      <td>6474</td>
      <td>7590</td>
      <td>1.64</td>
      <td>...</td>
      <td>493</td>
      <td>2879</td>
      <td>731</td>
      <td>2272</td>
      <td>420</td>
      <td>30732</td>
      <td>271613</td>
      <td>70162</td>
      <td>15433</td>
      <td>21950</td>
    </tr>
    <tr>
      <th>46</th>
      <td>R46000</td>
      <td>鹿児島県</td>
      <td>1563000</td>
      <td>1550000</td>
      <td>201000</td>
      <td>838000</td>
      <td>523000</td>
      <td>10037</td>
      <td>11618</td>
      <td>1.65</td>
      <td>...</td>
      <td>795</td>
      <td>4653</td>
      <td>1352</td>
      <td>3266</td>
      <td>582</td>
      <td>40357</td>
      <td>279101</td>
      <td>70070</td>
      <td>20822</td>
      <td>22440</td>
    </tr>
    <tr>
      <th>47</th>
      <td>R47000</td>
      <td>沖縄県</td>
      <td>1468000</td>
      <td>1446000</td>
      <td>240000</td>
      <td>884000</td>
      <td>344000</td>
      <td>18157</td>
      <td>14535</td>
      <td>1.80</td>
      <td>...</td>
      <td>607</td>
      <td>3887</td>
      <td>885</td>
      <td>2432</td>
      <td>614</td>
      <td>57108</td>
      <td>251735</td>
      <td>68318</td>
      <td>25189</td>
      <td>18429</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 92 columns</p>
</div></div></div>
</div>
</section>
<section id="id13">
<h3><span class="section-number">16.5.2. </span>射影<a class="headerlink" href="#id13" title="Link to this heading">#</a></h3>
<p>表データから指定した列のみに注目してデータを抽出する操作，関係データベースの分野では<strong>射影</strong>と呼ぶ．</p>
<p>pandasのDataFrameで射影を行う方法は2種類ある．
1つ目は注目したい列項目名をドット（.）で指定する方法である．
以下は，データフレーム<code class="docutils literal notranslate"><span class="pre">df</span></code>から列「総人口」にあるデータを抽出するコードである．</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">総人口</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0     124947000
1       5140000
2       1204000
3       1181000
4       2280000
        ...    
43      1718000
44      1107000
45      1052000
46      1563000
47      1468000
Name: 総人口, Length: 48, dtype: int64
</pre></div>
</div>
</div>
</div>
<p>もう1つの射影方法は中括弧の中で列項目名を指定する方法である．
この方法では，注目したい列名を<strong>文字列もしくは文字列のリスト</strong>で指定する．
以下は，データフレーム<code class="docutils literal notranslate"><span class="pre">df</span></code>から列「総人口」にあるデータを抽出するコードである．</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;総人口&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0     124947000
1       5140000
2       1204000
3       1181000
4       2280000
        ...    
43      1718000
44      1107000
45      1052000
46      1563000
47      1468000
Name: 総人口, Length: 48, dtype: int64
</pre></div>
</div>
</div>
</div>
<p>ドットを用いる方法は簡便であるが，列項目を複数指定して射影できない．
中括弧を用いる射影方法では，中括弧の中に文字列のリストを与えることで，複数の列項目に注目してデータを抽出できる．
以下は，データフレーム<code class="docutils literal notranslate"><span class="pre">df</span></code>から「地域コード」「都道府県」「総人口」の列のデータを抽出するコードである．</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">target_columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;地域コード&#39;</span><span class="p">,</span> <span class="s1">&#39;都道府県&#39;</span><span class="p">,</span> <span class="s1">&#39;総人口&#39;</span><span class="p">]</span>
<span class="n">df</span><span class="p">[</span><span class="n">target_columns</span><span class="p">]</span>

<span class="c1"># 以下のように書いても問題ない</span>
<span class="c1"># df[&#39;地域コード&#39;, &#39;都道府県&#39;, &#39;総人口&#39;]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>地域コード</th>
      <th>都道府県</th>
      <th>総人口</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>R00000</td>
      <td>全国</td>
      <td>124947000</td>
    </tr>
    <tr>
      <th>1</th>
      <td>R01000</td>
      <td>北海道</td>
      <td>5140000</td>
    </tr>
    <tr>
      <th>2</th>
      <td>R02000</td>
      <td>青森県</td>
      <td>1204000</td>
    </tr>
    <tr>
      <th>3</th>
      <td>R03000</td>
      <td>岩手県</td>
      <td>1181000</td>
    </tr>
    <tr>
      <th>4</th>
      <td>R04000</td>
      <td>宮城県</td>
      <td>2280000</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>43</th>
      <td>R43000</td>
      <td>熊本県</td>
      <td>1718000</td>
    </tr>
    <tr>
      <th>44</th>
      <td>R44000</td>
      <td>大分県</td>
      <td>1107000</td>
    </tr>
    <tr>
      <th>45</th>
      <td>R45000</td>
      <td>宮崎県</td>
      <td>1052000</td>
    </tr>
    <tr>
      <th>46</th>
      <td>R46000</td>
      <td>鹿児島県</td>
      <td>1563000</td>
    </tr>
    <tr>
      <th>47</th>
      <td>R47000</td>
      <td>沖縄県</td>
      <td>1468000</td>
    </tr>
  </tbody>
</table>
<p>48 rows × 3 columns</p>
</div></div></div>
</div>
</section>
<section id="id14">
<h3><span class="section-number">16.5.3. </span>データフレームに対する四則演算<a class="headerlink" href="#id14" title="Link to this heading">#</a></h3>
<p>pandasのDataFrameオブジェクトから任意の列を射影しスカラーの四則演算を適用すると，射影した列データ全体に演算が適用される．
例えば，以下はデータフレーム<code class="docutils literal notranslate"><span class="pre">df</span></code>の<code class="docutils literal notranslate"><span class="pre">総人口</span></code>列の各値に100を加算するコード例である．</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 総人口列の各値に100が加算された列が返る</span>
<span class="n">df</span><span class="o">.</span><span class="n">総人口</span> <span class="o">+</span> <span class="mi">100</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0     124947100
1       5140100
2       1204100
3       1181100
4       2280100
        ...    
43      1718100
44      1107100
45      1052100
46      1563100
47      1468100
Name: 総人口, Length: 48, dtype: int64
</pre></div>
</div>
</div>
</div>
<p>列と列の長さ（要素数）が同じなら，列同士の四則演算を行うことができる．
2つの列同士の四則演算を行うと，双方の列の各行の値を四則演算した結果の列が返る．</p>
<p>以下は，データフレーム<code class="docutils literal notranslate"><span class="pre">df</span></code>の<code class="docutils literal notranslate"><span class="pre">日本人人口</span></code>列の値を<code class="docutils literal notranslate"><span class="pre">総人口</span></code>列の値で割る（つまり，日本人の割合を求める）コード例である．</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;日本人人口&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;総人口&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0     0.976662
1     0.991829
2     0.995017
3     0.993226
4     0.989474
        ...   
43    0.988941
44    0.986450
45    0.992395
46    0.991683
47    0.985014
Length: 48, dtype: float64
</pre></div>
</div>
</div>
</div>
</section>
<section id="id15">
<h3><span class="section-number">16.5.4. </span>任意の行にあるレコードの取得<a class="headerlink" href="#id15" title="Link to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">df[i:j]</span></code>と書くと，データフレーム<code class="docutils literal notranslate"><span class="pre">df</span></code>の<code class="docutils literal notranslate"><span class="pre">i</span></code>件目（ゼロを起点）から<code class="docutils literal notranslate"><span class="pre">j-1</span></code>件目のレコードを取得できる．
以下はデータフレーム<code class="docutils literal notranslate"><span class="pre">df</span></code>の2件目から3件目まで（4件目は含まれない）のレコードを取得するコードである．</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>地域コード</th>
      <th>都道府県</th>
      <th>総人口</th>
      <th>日本人人口</th>
      <th>15歳未満人口</th>
      <th>15〜64歳人口</th>
      <th>65歳以上人口</th>
      <th>外国人人口</th>
      <th>出生数</th>
      <th>合計特殊出生率</th>
      <th>...</th>
      <th>歯科診療所数</th>
      <th>医師数</th>
      <th>歯科医師数</th>
      <th>薬剤師数</th>
      <th>保育所等数</th>
      <th>保育所等在所児数</th>
      <th>消費支出（二人以上の世帯）</th>
      <th>食料費（二人以上の世帯）</th>
      <th>住居費（二人以上の世帯）</th>
      <th>教養娯楽費（二人以上の世帯）</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2</th>
      <td>R02000</td>
      <td>青森県</td>
      <td>1204000</td>
      <td>1198000</td>
      <td>123000</td>
      <td>663000</td>
      <td>419000</td>
      <td>5409</td>
      <td>6513</td>
      <td>1.31</td>
      <td>...</td>
      <td>505</td>
      <td>2773</td>
      <td>735</td>
      <td>2345</td>
      <td>472</td>
      <td>30738</td>
      <td>249660</td>
      <td>73725</td>
      <td>10541</td>
      <td>20068</td>
    </tr>
    <tr>
      <th>3</th>
      <td>R03000</td>
      <td>岩手県</td>
      <td>1181000</td>
      <td>1173000</td>
      <td>125000</td>
      <td>648000</td>
      <td>408000</td>
      <td>6937</td>
      <td>6472</td>
      <td>1.30</td>
      <td>...</td>
      <td>557</td>
      <td>2700</td>
      <td>1016</td>
      <td>2536</td>
      <td>393</td>
      <td>28580</td>
      <td>285815</td>
      <td>77251</td>
      <td>18814</td>
      <td>25733</td>
    </tr>
  </tbody>
</table>
<p>2 rows × 92 columns</p>
</div></div></div>
</div>
<p>DataFrameオブジェクトの<code class="docutils literal notranslate"><span class="pre">loc</span></code>メソッドを用いると，任意の行にある任意の列の値を取得することができる．
以下はデータフレーム<code class="docutils literal notranslate"><span class="pre">df</span></code>の2件目から3件目のレコードについて，「地域コード」「都道府県」「総人口」の列の値だけ抽出（射影）するコードである．</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">target_columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;地域コード&#39;</span><span class="p">,</span> <span class="s1">&#39;都道府県&#39;</span><span class="p">,</span> <span class="s1">&#39;総人口&#39;</span><span class="p">]</span>
<span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span> <span class="n">target_columns</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>地域コード</th>
      <th>都道府県</th>
      <th>総人口</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2</th>
      <td>R02000</td>
      <td>青森県</td>
      <td>1204000</td>
    </tr>
    <tr>
      <th>3</th>
      <td>R03000</td>
      <td>岩手県</td>
      <td>1181000</td>
    </tr>
    <tr>
      <th>4</th>
      <td>R04000</td>
      <td>宮城県</td>
      <td>2280000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>上記コードは，以下と同じ（射影後に取得行を絞る）．</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">target_columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;地域コード&#39;</span><span class="p">,</span> <span class="s1">&#39;都道府県&#39;</span><span class="p">,</span> <span class="s1">&#39;総人口&#39;</span><span class="p">]</span>
<span class="n">df</span><span class="p">[</span><span class="n">target_columns</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>地域コード</th>
      <th>都道府県</th>
      <th>総人口</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2</th>
      <td>R02000</td>
      <td>青森県</td>
      <td>1204000</td>
    </tr>
    <tr>
      <th>3</th>
      <td>R03000</td>
      <td>岩手県</td>
      <td>1181000</td>
    </tr>
    <tr>
      <th>4</th>
      <td>R04000</td>
      <td>宮城県</td>
      <td>2280000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>以下のように<code class="docutils literal notranslate"><span class="pre">loc</span></code>を書くと，すべての列の値を取得することができる．</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># データフレーム`df`の2件目から3件目のレコードについて，すべての列の値を抽出（射影）する</span>
<span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span> <span class="p">:]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>地域コード</th>
      <th>都道府県</th>
      <th>総人口</th>
      <th>日本人人口</th>
      <th>15歳未満人口</th>
      <th>15〜64歳人口</th>
      <th>65歳以上人口</th>
      <th>外国人人口</th>
      <th>出生数</th>
      <th>合計特殊出生率</th>
      <th>...</th>
      <th>歯科診療所数</th>
      <th>医師数</th>
      <th>歯科医師数</th>
      <th>薬剤師数</th>
      <th>保育所等数</th>
      <th>保育所等在所児数</th>
      <th>消費支出（二人以上の世帯）</th>
      <th>食料費（二人以上の世帯）</th>
      <th>住居費（二人以上の世帯）</th>
      <th>教養娯楽費（二人以上の世帯）</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2</th>
      <td>R02000</td>
      <td>青森県</td>
      <td>1204000</td>
      <td>1198000</td>
      <td>123000</td>
      <td>663000</td>
      <td>419000</td>
      <td>5409</td>
      <td>6513</td>
      <td>1.31</td>
      <td>...</td>
      <td>505</td>
      <td>2773</td>
      <td>735</td>
      <td>2345</td>
      <td>472</td>
      <td>30738</td>
      <td>249660</td>
      <td>73725</td>
      <td>10541</td>
      <td>20068</td>
    </tr>
    <tr>
      <th>3</th>
      <td>R03000</td>
      <td>岩手県</td>
      <td>1181000</td>
      <td>1173000</td>
      <td>125000</td>
      <td>648000</td>
      <td>408000</td>
      <td>6937</td>
      <td>6472</td>
      <td>1.30</td>
      <td>...</td>
      <td>557</td>
      <td>2700</td>
      <td>1016</td>
      <td>2536</td>
      <td>393</td>
      <td>28580</td>
      <td>285815</td>
      <td>77251</td>
      <td>18814</td>
      <td>25733</td>
    </tr>
    <tr>
      <th>4</th>
      <td>R04000</td>
      <td>宮城県</td>
      <td>2280000</td>
      <td>2256000</td>
      <td>258000</td>
      <td>1363000</td>
      <td>659000</td>
      <td>19453</td>
      <td>13761</td>
      <td>1.15</td>
      <td>...</td>
      <td>1051</td>
      <td>5950</td>
      <td>1896</td>
      <td>5502</td>
      <td>506</td>
      <td>40519</td>
      <td>287781</td>
      <td>78589</td>
      <td>22951</td>
      <td>26516</td>
    </tr>
  </tbody>
</table>
<p>3 rows × 92 columns</p>
</div></div></div>
</div>
<p>上の例では<code class="docutils literal notranslate"><span class="pre">i</span></code>件目から<code class="docutils literal notranslate"><span class="pre">j</span></code>件目までのように連続するレコードを取得していたが，<code class="docutils literal notranslate"><span class="pre">loc</span></code>メソッドでは具体的なレコードの行番号を指定してレコードを取得することもできる．
以下は，データフレーム<code class="docutils literal notranslate"><span class="pre">df</span></code>の1件目と11件目と21件目のレコードを抽出（射影）するコードである．</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">target_rows</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">21</span><span class="p">]</span>
<span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">target_rows</span><span class="p">,</span> <span class="p">:]</span>

<span class="c1"># 以下のように書いても問題ない</span>
<span class="c1"># df.loc[[1, 11, 21], :]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>地域コード</th>
      <th>都道府県</th>
      <th>総人口</th>
      <th>日本人人口</th>
      <th>15歳未満人口</th>
      <th>15〜64歳人口</th>
      <th>65歳以上人口</th>
      <th>外国人人口</th>
      <th>出生数</th>
      <th>合計特殊出生率</th>
      <th>...</th>
      <th>歯科診療所数</th>
      <th>医師数</th>
      <th>歯科医師数</th>
      <th>薬剤師数</th>
      <th>保育所等数</th>
      <th>保育所等在所児数</th>
      <th>消費支出（二人以上の世帯）</th>
      <th>食料費（二人以上の世帯）</th>
      <th>住居費（二人以上の世帯）</th>
      <th>教養娯楽費（二人以上の世帯）</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>R01000</td>
      <td>北海道</td>
      <td>5140000</td>
      <td>5098000</td>
      <td>530000</td>
      <td>2924000</td>
      <td>1686000</td>
      <td>34321</td>
      <td>28762</td>
      <td>1.20</td>
      <td>...</td>
      <td>2818</td>
      <td>13731</td>
      <td>4418</td>
      <td>11802</td>
      <td>1075</td>
      <td>76885</td>
      <td>277737</td>
      <td>73037</td>
      <td>24873</td>
      <td>27234</td>
    </tr>
    <tr>
      <th>11</th>
      <td>R11000</td>
      <td>埼玉県</td>
      <td>7337000</td>
      <td>7136000</td>
      <td>847000</td>
      <td>4483000</td>
      <td>2007000</td>
      <td>161439</td>
      <td>45424</td>
      <td>1.22</td>
      <td>...</td>
      <td>3550</td>
      <td>13604</td>
      <td>5575</td>
      <td>16370</td>
      <td>1474</td>
      <td>123008</td>
      <td>324793</td>
      <td>87922</td>
      <td>21820</td>
      <td>35050</td>
    </tr>
    <tr>
      <th>21</th>
      <td>R21000</td>
      <td>岐阜県</td>
      <td>1946000</td>
      <td>1888000</td>
      <td>231000</td>
      <td>1111000</td>
      <td>604000</td>
      <td>48979</td>
      <td>11730</td>
      <td>1.40</td>
      <td>...</td>
      <td>959</td>
      <td>4580</td>
      <td>1735</td>
      <td>4060</td>
      <td>415</td>
      <td>38709</td>
      <td>313314</td>
      <td>77357</td>
      <td>13720</td>
      <td>27226</td>
    </tr>
  </tbody>
</table>
<p>3 rows × 92 columns</p>
</div></div></div>
</div>
</section>
<section id="id16">
<h3><span class="section-number">16.5.5. </span>絞り込み<a class="headerlink" href="#id16" title="Link to this heading">#</a></h3>
<p>データフレームから特定の条件を満たすレコードのみを取得するには2種類の方法がある：</p>
<ul class="simple">
<li><p>中括弧の中で条件を指定する方法</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">query</span></code>メソッドを使用する方法</p></li>
</ul>
<p>データフレーム<code class="docutils literal notranslate"><span class="pre">df</span></code>にあるレコードの中で，「総人口」の値が700万以上になるものだけを抽出する例を考えてみよう．
中括弧の中で条件を指定してデータフレームにアクセスすると，条件にマッチするレコードだけが絞り込まれる．
条件指定には射影を用いる．</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;総人口&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">7000000</span><span class="p">]</span>

<span class="c1"># ドット表現を用いて条件を指定することも可能</span>
<span class="c1"># df[df.総人口 &gt;=  &gt;= 7000000]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>地域コード</th>
      <th>都道府県</th>
      <th>総人口</th>
      <th>日本人人口</th>
      <th>15歳未満人口</th>
      <th>15〜64歳人口</th>
      <th>65歳以上人口</th>
      <th>外国人人口</th>
      <th>出生数</th>
      <th>合計特殊出生率</th>
      <th>...</th>
      <th>歯科診療所数</th>
      <th>医師数</th>
      <th>歯科医師数</th>
      <th>薬剤師数</th>
      <th>保育所等数</th>
      <th>保育所等在所児数</th>
      <th>消費支出（二人以上の世帯）</th>
      <th>食料費（二人以上の世帯）</th>
      <th>住居費（二人以上の世帯）</th>
      <th>教養娯楽費（二人以上の世帯）</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>R00000</td>
      <td>全国</td>
      <td>124947000</td>
      <td>122031000</td>
      <td>14503000</td>
      <td>74208000</td>
      <td>36236000</td>
      <td>2402460</td>
      <td>811622</td>
      <td>1.30</td>
      <td>...</td>
      <td>67899</td>
      <td>339623</td>
      <td>107443</td>
      <td>321982</td>
      <td>29994</td>
      <td>2643196</td>
      <td>290865</td>
      <td>77474</td>
      <td>18645</td>
      <td>26642</td>
    </tr>
    <tr>
      <th>11</th>
      <td>R11000</td>
      <td>埼玉県</td>
      <td>7337000</td>
      <td>7136000</td>
      <td>847000</td>
      <td>4483000</td>
      <td>2007000</td>
      <td>161439</td>
      <td>45424</td>
      <td>1.22</td>
      <td>...</td>
      <td>3550</td>
      <td>13604</td>
      <td>5575</td>
      <td>16370</td>
      <td>1474</td>
      <td>123008</td>
      <td>324793</td>
      <td>87922</td>
      <td>21820</td>
      <td>35050</td>
    </tr>
    <tr>
      <th>13</th>
      <td>R13000</td>
      <td>東京都</td>
      <td>14038000</td>
      <td>13443000</td>
      <td>1535000</td>
      <td>9301000</td>
      <td>3202000</td>
      <td>483372</td>
      <td>95404</td>
      <td>1.08</td>
      <td>...</td>
      <td>10678</td>
      <td>48072</td>
      <td>17245</td>
      <td>52842</td>
      <td>3523</td>
      <td>290125</td>
      <td>321633</td>
      <td>87973</td>
      <td>29988</td>
      <td>33099</td>
    </tr>
    <tr>
      <th>14</th>
      <td>R14000</td>
      <td>神奈川県</td>
      <td>9232000</td>
      <td>8991000</td>
      <td>1053000</td>
      <td>5797000</td>
      <td>2383000</td>
      <td>195535</td>
      <td>58836</td>
      <td>1.22</td>
      <td>...</td>
      <td>4984</td>
      <td>21377</td>
      <td>7605</td>
      <td>23872</td>
      <td>2012</td>
      <td>165014</td>
      <td>301379</td>
      <td>85076</td>
      <td>23065</td>
      <td>29394</td>
    </tr>
    <tr>
      <th>23</th>
      <td>R23000</td>
      <td>愛知県</td>
      <td>7495000</td>
      <td>7228000</td>
      <td>948000</td>
      <td>4628000</td>
      <td>1920000</td>
      <td>231369</td>
      <td>53918</td>
      <td>1.41</td>
      <td>...</td>
      <td>3718</td>
      <td>17842</td>
      <td>6159</td>
      <td>16003</td>
      <td>1558</td>
      <td>148009</td>
      <td>319344</td>
      <td>79757</td>
      <td>22575</td>
      <td>30894</td>
    </tr>
    <tr>
      <th>27</th>
      <td>R27000</td>
      <td>大阪府</td>
      <td>8782000</td>
      <td>8524000</td>
      <td>1002000</td>
      <td>5349000</td>
      <td>2432000</td>
      <td>208681</td>
      <td>59780</td>
      <td>1.27</td>
      <td>...</td>
      <td>5442</td>
      <td>26431</td>
      <td>8184</td>
      <td>27297</td>
      <td>1573</td>
      <td>172365</td>
      <td>265161</td>
      <td>80890</td>
      <td>18350</td>
      <td>25978</td>
    </tr>
  </tbody>
</table>
<p>6 rows × 92 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">]</span> <span class="o">*</span> <span class="mi">12</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>地域コード</th>
      <th>都道府県</th>
      <th>総人口</th>
      <th>日本人人口</th>
      <th>15歳未満人口</th>
      <th>15〜64歳人口</th>
      <th>65歳以上人口</th>
      <th>外国人人口</th>
      <th>出生数</th>
      <th>合計特殊出生率</th>
      <th>...</th>
      <th>歯科診療所数</th>
      <th>医師数</th>
      <th>歯科医師数</th>
      <th>薬剤師数</th>
      <th>保育所等数</th>
      <th>保育所等在所児数</th>
      <th>消費支出（二人以上の世帯）</th>
      <th>食料費（二人以上の世帯）</th>
      <th>住居費（二人以上の世帯）</th>
      <th>教養娯楽費（二人以上の世帯）</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>R00000</td>
      <td>全国</td>
      <td>124947000</td>
      <td>122031000</td>
      <td>14503000</td>
      <td>74208000</td>
      <td>36236000</td>
      <td>2402460</td>
      <td>811622</td>
      <td>1.30</td>
      <td>...</td>
      <td>67899</td>
      <td>339623</td>
      <td>107443</td>
      <td>321982</td>
      <td>29994</td>
      <td>2643196</td>
      <td>290865</td>
      <td>77474</td>
      <td>18645</td>
      <td>26642</td>
    </tr>
    <tr>
      <th>2</th>
      <td>R02000</td>
      <td>青森県</td>
      <td>1204000</td>
      <td>1198000</td>
      <td>123000</td>
      <td>663000</td>
      <td>419000</td>
      <td>5409</td>
      <td>6513</td>
      <td>1.31</td>
      <td>...</td>
      <td>505</td>
      <td>2773</td>
      <td>735</td>
      <td>2345</td>
      <td>472</td>
      <td>30738</td>
      <td>249660</td>
      <td>73725</td>
      <td>10541</td>
      <td>20068</td>
    </tr>
    <tr>
      <th>4</th>
      <td>R04000</td>
      <td>宮城県</td>
      <td>2280000</td>
      <td>2256000</td>
      <td>258000</td>
      <td>1363000</td>
      <td>659000</td>
      <td>19453</td>
      <td>13761</td>
      <td>1.15</td>
      <td>...</td>
      <td>1051</td>
      <td>5950</td>
      <td>1896</td>
      <td>5502</td>
      <td>506</td>
      <td>40519</td>
      <td>287781</td>
      <td>78589</td>
      <td>22951</td>
      <td>26516</td>
    </tr>
    <tr>
      <th>6</th>
      <td>R06000</td>
      <td>山形県</td>
      <td>1041000</td>
      <td>1033000</td>
      <td>113000</td>
      <td>566000</td>
      <td>362000</td>
      <td>7149</td>
      <td>5898</td>
      <td>1.32</td>
      <td>...</td>
      <td>473</td>
      <td>2608</td>
      <td>678</td>
      <td>2129</td>
      <td>299</td>
      <td>23969</td>
      <td>276567</td>
      <td>77493</td>
      <td>16140</td>
      <td>22348</td>
    </tr>
    <tr>
      <th>8</th>
      <td>R08000</td>
      <td>茨城県</td>
      <td>2840000</td>
      <td>2767000</td>
      <td>321000</td>
      <td>1655000</td>
      <td>864000</td>
      <td>57819</td>
      <td>16502</td>
      <td>1.30</td>
      <td>...</td>
      <td>1378</td>
      <td>5838</td>
      <td>1979</td>
      <td>6704</td>
      <td>627</td>
      <td>56249</td>
      <td>298053</td>
      <td>71578</td>
      <td>18805</td>
      <td>25789</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>38</th>
      <td>R38000</td>
      <td>愛媛県</td>
      <td>1306000</td>
      <td>1294000</td>
      <td>147000</td>
      <td>716000</td>
      <td>443000</td>
      <td>11159</td>
      <td>8011</td>
      <td>1.40</td>
      <td>...</td>
      <td>658</td>
      <td>3847</td>
      <td>943</td>
      <td>3024</td>
      <td>313</td>
      <td>24543</td>
      <td>245054</td>
      <td>67889</td>
      <td>17559</td>
      <td>22447</td>
    </tr>
    <tr>
      <th>40</th>
      <td>R40000</td>
      <td>福岡県</td>
      <td>5116000</td>
      <td>5030000</td>
      <td>654000</td>
      <td>3013000</td>
      <td>1449000</td>
      <td>66699</td>
      <td>37540</td>
      <td>1.37</td>
      <td>...</td>
      <td>3068</td>
      <td>16784</td>
      <td>5672</td>
      <td>12714</td>
      <td>1054</td>
      <td>117582</td>
      <td>286265</td>
      <td>75957</td>
      <td>20020</td>
      <td>28318</td>
    </tr>
    <tr>
      <th>42</th>
      <td>R42000</td>
      <td>長崎県</td>
      <td>1283000</td>
      <td>1272000</td>
      <td>158000</td>
      <td>690000</td>
      <td>435000</td>
      <td>8316</td>
      <td>8862</td>
      <td>1.60</td>
      <td>...</td>
      <td>709</td>
      <td>4399</td>
      <td>1203</td>
      <td>2954</td>
      <td>492</td>
      <td>35679</td>
      <td>271129</td>
      <td>73489</td>
      <td>23124</td>
      <td>17601</td>
    </tr>
    <tr>
      <th>44</th>
      <td>R44000</td>
      <td>大分県</td>
      <td>1107000</td>
      <td>1092000</td>
      <td>131000</td>
      <td>600000</td>
      <td>376000</td>
      <td>10168</td>
      <td>7327</td>
      <td>1.54</td>
      <td>...</td>
      <td>530</td>
      <td>3370</td>
      <td>740</td>
      <td>2317</td>
      <td>335</td>
      <td>26578</td>
      <td>298060</td>
      <td>75218</td>
      <td>18820</td>
      <td>28260</td>
    </tr>
    <tr>
      <th>46</th>
      <td>R46000</td>
      <td>鹿児島県</td>
      <td>1563000</td>
      <td>1550000</td>
      <td>201000</td>
      <td>838000</td>
      <td>523000</td>
      <td>10037</td>
      <td>11618</td>
      <td>1.65</td>
      <td>...</td>
      <td>795</td>
      <td>4653</td>
      <td>1352</td>
      <td>3266</td>
      <td>582</td>
      <td>40357</td>
      <td>279101</td>
      <td>70070</td>
      <td>20822</td>
      <td>22440</td>
    </tr>
  </tbody>
</table>
<p>24 rows × 92 columns</p>
</div></div></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p class="rubric" id="q-df-7000000">Q. df.総人口 &gt;= 7000000 を実行すると何が返ってくるのか？</p>
<p>実行してみると分かるが，<code class="docutils literal notranslate"><span class="pre">df</span></code>の各レコードの<code class="docutils literal notranslate"><span class="pre">総人口</span></code>が700万以上かそうでないかを<code class="docutils literal notranslate"><span class="pre">True</span></code>か<code class="docutils literal notranslate"><span class="pre">False</span></code>で表したpandas.Series（リストのようなもの）が返ってくる．
返ってくるpandas.Seriesでは，nつ目の要素が<code class="docutils literal notranslate"><span class="pre">df</span></code>のn番目のレコードが<code class="docutils literal notranslate"><span class="pre">True</span></code>か<code class="docutils literal notranslate"><span class="pre">False</span></code>を表している．
pandasのDataFrameオブジェクトは中括弧の中に<code class="docutils literal notranslate"><span class="pre">True/False</span></code>のリスト（もしくはpandas.Series）を入れると，値がTrueのレコードだけをDataFrameオブジェクトから抽出して返す．
この振る舞いを利用して，pandasではレコードの絞り込みを行うのである．</p>
</div>
<p>同じことをDataFrameオブジェクトの<code class="docutils literal notranslate"><span class="pre">query</span></code>メソッドを使って書くと，以下のようになる．</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;総人口 &gt;= 7000000&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>地域コード</th>
      <th>都道府県</th>
      <th>総人口</th>
      <th>日本人人口</th>
      <th>15歳未満人口</th>
      <th>15〜64歳人口</th>
      <th>65歳以上人口</th>
      <th>外国人人口</th>
      <th>出生数</th>
      <th>合計特殊出生率</th>
      <th>...</th>
      <th>歯科診療所数</th>
      <th>医師数</th>
      <th>歯科医師数</th>
      <th>薬剤師数</th>
      <th>保育所等数</th>
      <th>保育所等在所児数</th>
      <th>消費支出（二人以上の世帯）</th>
      <th>食料費（二人以上の世帯）</th>
      <th>住居費（二人以上の世帯）</th>
      <th>教養娯楽費（二人以上の世帯）</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>R00000</td>
      <td>全国</td>
      <td>124947000</td>
      <td>122031000</td>
      <td>14503000</td>
      <td>74208000</td>
      <td>36236000</td>
      <td>2402460</td>
      <td>811622</td>
      <td>1.30</td>
      <td>...</td>
      <td>67899</td>
      <td>339623</td>
      <td>107443</td>
      <td>321982</td>
      <td>29994</td>
      <td>2643196</td>
      <td>290865</td>
      <td>77474</td>
      <td>18645</td>
      <td>26642</td>
    </tr>
    <tr>
      <th>11</th>
      <td>R11000</td>
      <td>埼玉県</td>
      <td>7337000</td>
      <td>7136000</td>
      <td>847000</td>
      <td>4483000</td>
      <td>2007000</td>
      <td>161439</td>
      <td>45424</td>
      <td>1.22</td>
      <td>...</td>
      <td>3550</td>
      <td>13604</td>
      <td>5575</td>
      <td>16370</td>
      <td>1474</td>
      <td>123008</td>
      <td>324793</td>
      <td>87922</td>
      <td>21820</td>
      <td>35050</td>
    </tr>
    <tr>
      <th>13</th>
      <td>R13000</td>
      <td>東京都</td>
      <td>14038000</td>
      <td>13443000</td>
      <td>1535000</td>
      <td>9301000</td>
      <td>3202000</td>
      <td>483372</td>
      <td>95404</td>
      <td>1.08</td>
      <td>...</td>
      <td>10678</td>
      <td>48072</td>
      <td>17245</td>
      <td>52842</td>
      <td>3523</td>
      <td>290125</td>
      <td>321633</td>
      <td>87973</td>
      <td>29988</td>
      <td>33099</td>
    </tr>
    <tr>
      <th>14</th>
      <td>R14000</td>
      <td>神奈川県</td>
      <td>9232000</td>
      <td>8991000</td>
      <td>1053000</td>
      <td>5797000</td>
      <td>2383000</td>
      <td>195535</td>
      <td>58836</td>
      <td>1.22</td>
      <td>...</td>
      <td>4984</td>
      <td>21377</td>
      <td>7605</td>
      <td>23872</td>
      <td>2012</td>
      <td>165014</td>
      <td>301379</td>
      <td>85076</td>
      <td>23065</td>
      <td>29394</td>
    </tr>
    <tr>
      <th>23</th>
      <td>R23000</td>
      <td>愛知県</td>
      <td>7495000</td>
      <td>7228000</td>
      <td>948000</td>
      <td>4628000</td>
      <td>1920000</td>
      <td>231369</td>
      <td>53918</td>
      <td>1.41</td>
      <td>...</td>
      <td>3718</td>
      <td>17842</td>
      <td>6159</td>
      <td>16003</td>
      <td>1558</td>
      <td>148009</td>
      <td>319344</td>
      <td>79757</td>
      <td>22575</td>
      <td>30894</td>
    </tr>
    <tr>
      <th>27</th>
      <td>R27000</td>
      <td>大阪府</td>
      <td>8782000</td>
      <td>8524000</td>
      <td>1002000</td>
      <td>5349000</td>
      <td>2432000</td>
      <td>208681</td>
      <td>59780</td>
      <td>1.27</td>
      <td>...</td>
      <td>5442</td>
      <td>26431</td>
      <td>8184</td>
      <td>27297</td>
      <td>1573</td>
      <td>172365</td>
      <td>265161</td>
      <td>80890</td>
      <td>18350</td>
      <td>25978</td>
    </tr>
  </tbody>
</table>
<p>6 rows × 92 columns</p>
</div></div></div>
</div>
<p>絞り込み条件は複数書くこともできる．
以下はAND条件の例．AND条件は<code class="docutils literal notranslate"><span class="pre">&amp;</span></code>で繋ぐ．なお，1つ1つの条件は丸括弧で囲む．</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 総人口が700万人以上かつ都道府県名が「全国」でないレコードをすべて抽出</span>
<span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="o">.</span><span class="n">総人口</span> <span class="o">&gt;=</span> <span class="mi">7000000</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">都道府県</span> <span class="o">!=</span> <span class="s1">&#39;全国&#39;</span><span class="p">)]</span>

<span class="c1"># queryメソッドを使うと，以下のように書ける</span>
<span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;総人口 &gt;= 7000000 &amp; 都道府県 != &quot;全国&quot;&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>地域コード</th>
      <th>都道府県</th>
      <th>総人口</th>
      <th>日本人人口</th>
      <th>15歳未満人口</th>
      <th>15〜64歳人口</th>
      <th>65歳以上人口</th>
      <th>外国人人口</th>
      <th>出生数</th>
      <th>合計特殊出生率</th>
      <th>...</th>
      <th>歯科診療所数</th>
      <th>医師数</th>
      <th>歯科医師数</th>
      <th>薬剤師数</th>
      <th>保育所等数</th>
      <th>保育所等在所児数</th>
      <th>消費支出（二人以上の世帯）</th>
      <th>食料費（二人以上の世帯）</th>
      <th>住居費（二人以上の世帯）</th>
      <th>教養娯楽費（二人以上の世帯）</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>11</th>
      <td>R11000</td>
      <td>埼玉県</td>
      <td>7337000</td>
      <td>7136000</td>
      <td>847000</td>
      <td>4483000</td>
      <td>2007000</td>
      <td>161439</td>
      <td>45424</td>
      <td>1.22</td>
      <td>...</td>
      <td>3550</td>
      <td>13604</td>
      <td>5575</td>
      <td>16370</td>
      <td>1474</td>
      <td>123008</td>
      <td>324793</td>
      <td>87922</td>
      <td>21820</td>
      <td>35050</td>
    </tr>
    <tr>
      <th>13</th>
      <td>R13000</td>
      <td>東京都</td>
      <td>14038000</td>
      <td>13443000</td>
      <td>1535000</td>
      <td>9301000</td>
      <td>3202000</td>
      <td>483372</td>
      <td>95404</td>
      <td>1.08</td>
      <td>...</td>
      <td>10678</td>
      <td>48072</td>
      <td>17245</td>
      <td>52842</td>
      <td>3523</td>
      <td>290125</td>
      <td>321633</td>
      <td>87973</td>
      <td>29988</td>
      <td>33099</td>
    </tr>
    <tr>
      <th>14</th>
      <td>R14000</td>
      <td>神奈川県</td>
      <td>9232000</td>
      <td>8991000</td>
      <td>1053000</td>
      <td>5797000</td>
      <td>2383000</td>
      <td>195535</td>
      <td>58836</td>
      <td>1.22</td>
      <td>...</td>
      <td>4984</td>
      <td>21377</td>
      <td>7605</td>
      <td>23872</td>
      <td>2012</td>
      <td>165014</td>
      <td>301379</td>
      <td>85076</td>
      <td>23065</td>
      <td>29394</td>
    </tr>
    <tr>
      <th>23</th>
      <td>R23000</td>
      <td>愛知県</td>
      <td>7495000</td>
      <td>7228000</td>
      <td>948000</td>
      <td>4628000</td>
      <td>1920000</td>
      <td>231369</td>
      <td>53918</td>
      <td>1.41</td>
      <td>...</td>
      <td>3718</td>
      <td>17842</td>
      <td>6159</td>
      <td>16003</td>
      <td>1558</td>
      <td>148009</td>
      <td>319344</td>
      <td>79757</td>
      <td>22575</td>
      <td>30894</td>
    </tr>
    <tr>
      <th>27</th>
      <td>R27000</td>
      <td>大阪府</td>
      <td>8782000</td>
      <td>8524000</td>
      <td>1002000</td>
      <td>5349000</td>
      <td>2432000</td>
      <td>208681</td>
      <td>59780</td>
      <td>1.27</td>
      <td>...</td>
      <td>5442</td>
      <td>26431</td>
      <td>8184</td>
      <td>27297</td>
      <td>1573</td>
      <td>172365</td>
      <td>265161</td>
      <td>80890</td>
      <td>18350</td>
      <td>25978</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 92 columns</p>
</div></div></div>
</div>
<p>以下はOR条件の例．OR条件は<code class="docutils literal notranslate"><span class="pre">|</span></code>（パイプ）で繋ぐ．
条件が増えると，中括弧で条件を指定する方法は見にくくなる．
条件が多い場合は，<code class="docutils literal notranslate"><span class="pre">query</span></code>メソッドを使った方がコードの可読性を高められる．</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 合計特殊出生率が1.8以上もしくは1.1未満のレコードをすべて抽出</span>
<span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="o">.</span><span class="n">合計特殊出生率</span> <span class="o">&gt;=</span> <span class="mf">1.8</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">合計特殊出生率</span> <span class="o">&lt;</span> <span class="mf">1.1</span><span class="p">)]</span>

<span class="c1"># queryメソッドを使うと，以下のように書ける</span>
<span class="c1"># df.query(&#39;合計特殊出生率 &gt;= 1.8 | 合計特殊出生率 &lt; 1.1&#39;)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>地域コード</th>
      <th>都道府県</th>
      <th>総人口</th>
      <th>日本人人口</th>
      <th>15歳未満人口</th>
      <th>15〜64歳人口</th>
      <th>65歳以上人口</th>
      <th>外国人人口</th>
      <th>出生数</th>
      <th>合計特殊出生率</th>
      <th>...</th>
      <th>歯科診療所数</th>
      <th>医師数</th>
      <th>歯科医師数</th>
      <th>薬剤師数</th>
      <th>保育所等数</th>
      <th>保育所等在所児数</th>
      <th>消費支出（二人以上の世帯）</th>
      <th>食料費（二人以上の世帯）</th>
      <th>住居費（二人以上の世帯）</th>
      <th>教養娯楽費（二人以上の世帯）</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>13</th>
      <td>R13000</td>
      <td>東京都</td>
      <td>14038000</td>
      <td>13443000</td>
      <td>1535000</td>
      <td>9301000</td>
      <td>3202000</td>
      <td>483372</td>
      <td>95404</td>
      <td>1.08</td>
      <td>...</td>
      <td>10678</td>
      <td>48072</td>
      <td>17245</td>
      <td>52842</td>
      <td>3523</td>
      <td>290125</td>
      <td>321633</td>
      <td>87973</td>
      <td>29988</td>
      <td>33099</td>
    </tr>
    <tr>
      <th>47</th>
      <td>R47000</td>
      <td>沖縄県</td>
      <td>1468000</td>
      <td>1446000</td>
      <td>240000</td>
      <td>884000</td>
      <td>344000</td>
      <td>18157</td>
      <td>14535</td>
      <td>1.80</td>
      <td>...</td>
      <td>607</td>
      <td>3887</td>
      <td>885</td>
      <td>2432</td>
      <td>614</td>
      <td>57108</td>
      <td>251735</td>
      <td>68318</td>
      <td>25189</td>
      <td>18429</td>
    </tr>
  </tbody>
</table>
<p>2 rows × 92 columns</p>
</div></div></div>
</div>
</section>
<section id="id17">
<h3><span class="section-number">16.5.6. </span>比較演算子を用いない絞り込み<a class="headerlink" href="#id17" title="Link to this heading">#</a></h3>
<p>大抵の絞り込みの場合，Python固有の比較演算子を用いれば事足りるが，文字列データなど非数値データの絞り込み時にはpandas特有の絞り込み方法が必要となるケースがある．
以下はその例．</p>
<section id="id18">
<h4><span class="section-number">16.5.6.1. </span>いずれかの値にマッチするレコードの取得<a class="headerlink" href="#id18" title="Link to this heading">#</a></h4>
<p>「都道府県名が東京都，大阪府，愛知県のいずれかである」のように，ある列項目の値が指定したリストに含まれているかを条件にしたい場合は<code class="docutils literal notranslate"><span class="pre">isin</span></code>メソッドを用いる．
以下は，データフレーム<code class="docutils literal notranslate"><span class="pre">df</span></code>から都道府県名が東京都，大阪府，愛知県のいずれかであるレコードを抽出するコード例である．</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">target_prefectures</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;東京都&#39;</span><span class="p">,</span> <span class="s1">&#39;大阪府&#39;</span><span class="p">,</span> <span class="s1">&#39;愛知県&#39;</span><span class="p">]</span>
<span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">都道府県</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">target_prefectures</span><span class="p">)]</span>

<span class="c1"># 以下，queryメソッドを使った場合．外部変数には@を付ける</span>
<span class="c1"># df.query(&#39;都道府県 in @target_prefectures&#39;)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>地域コード</th>
      <th>都道府県</th>
      <th>総人口</th>
      <th>日本人人口</th>
      <th>15歳未満人口</th>
      <th>15〜64歳人口</th>
      <th>65歳以上人口</th>
      <th>外国人人口</th>
      <th>出生数</th>
      <th>合計特殊出生率</th>
      <th>...</th>
      <th>歯科診療所数</th>
      <th>医師数</th>
      <th>歯科医師数</th>
      <th>薬剤師数</th>
      <th>保育所等数</th>
      <th>保育所等在所児数</th>
      <th>消費支出（二人以上の世帯）</th>
      <th>食料費（二人以上の世帯）</th>
      <th>住居費（二人以上の世帯）</th>
      <th>教養娯楽費（二人以上の世帯）</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>13</th>
      <td>R13000</td>
      <td>東京都</td>
      <td>14038000</td>
      <td>13443000</td>
      <td>1535000</td>
      <td>9301000</td>
      <td>3202000</td>
      <td>483372</td>
      <td>95404</td>
      <td>1.08</td>
      <td>...</td>
      <td>10678</td>
      <td>48072</td>
      <td>17245</td>
      <td>52842</td>
      <td>3523</td>
      <td>290125</td>
      <td>321633</td>
      <td>87973</td>
      <td>29988</td>
      <td>33099</td>
    </tr>
    <tr>
      <th>23</th>
      <td>R23000</td>
      <td>愛知県</td>
      <td>7495000</td>
      <td>7228000</td>
      <td>948000</td>
      <td>4628000</td>
      <td>1920000</td>
      <td>231369</td>
      <td>53918</td>
      <td>1.41</td>
      <td>...</td>
      <td>3718</td>
      <td>17842</td>
      <td>6159</td>
      <td>16003</td>
      <td>1558</td>
      <td>148009</td>
      <td>319344</td>
      <td>79757</td>
      <td>22575</td>
      <td>30894</td>
    </tr>
    <tr>
      <th>27</th>
      <td>R27000</td>
      <td>大阪府</td>
      <td>8782000</td>
      <td>8524000</td>
      <td>1002000</td>
      <td>5349000</td>
      <td>2432000</td>
      <td>208681</td>
      <td>59780</td>
      <td>1.27</td>
      <td>...</td>
      <td>5442</td>
      <td>26431</td>
      <td>8184</td>
      <td>27297</td>
      <td>1573</td>
      <td>172365</td>
      <td>265161</td>
      <td>80890</td>
      <td>18350</td>
      <td>25978</td>
    </tr>
  </tbody>
</table>
<p>3 rows × 92 columns</p>
</div></div></div>
</div>
</section>
<section id="id19">
<h4><span class="section-number">16.5.6.2. </span>文字列の部分一致<a class="headerlink" href="#id19" title="Link to this heading">#</a></h4>
<p>ある列の文字列が「特定の文字列を含む」といった部分一致条件を指定してレコードの抽出を行いたい場合がある．
このようなケースでは以下に挙げた<code class="docutils literal notranslate"><span class="pre">str.xxx</span></code>メソッドを使用する（<code class="docutils literal notranslate"><span class="pre">str</span></code>を忘れないように！）．</p>
<ul class="simple">
<li><p>ある列の値が特定の文字列を「含む」レコードを抽出したい場合: <code class="docutils literal notranslate"><span class="pre">str.contains</span></code>メソッド</p></li>
<li><p>ある列の値が特定の文字列から「始まる」レコードを抽出したい場合: <code class="docutils literal notranslate"><span class="pre">str.startswith</span></code>メソッド</p></li>
<li><p>ある列の値が特定の文字列から「終わる」レコードを抽出したい場合: <code class="docutils literal notranslate"><span class="pre">str.endswith</span></code>メソッド</p></li>
</ul>
<p>以下はデータフレーム<code class="docutils literal notranslate"><span class="pre">df</span></code>から都道府県名が「府」で終わるレコードを抽出するコード例である．</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># str.をつけ忘れるとエラーを吐く</span>
<span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">都道府県</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;府&#39;</span><span class="p">)]</span>

<span class="c1"># 以下，queryメソッドを使った場合．</span>
<span class="c1"># df.query(&#39;都道府県.str.endswith(&quot;府&quot;)&#39;)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>地域コード</th>
      <th>都道府県</th>
      <th>総人口</th>
      <th>日本人人口</th>
      <th>15歳未満人口</th>
      <th>15〜64歳人口</th>
      <th>65歳以上人口</th>
      <th>外国人人口</th>
      <th>出生数</th>
      <th>合計特殊出生率</th>
      <th>...</th>
      <th>歯科診療所数</th>
      <th>医師数</th>
      <th>歯科医師数</th>
      <th>薬剤師数</th>
      <th>保育所等数</th>
      <th>保育所等在所児数</th>
      <th>消費支出（二人以上の世帯）</th>
      <th>食料費（二人以上の世帯）</th>
      <th>住居費（二人以上の世帯）</th>
      <th>教養娯楽費（二人以上の世帯）</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>26</th>
      <td>R26000</td>
      <td>京都府</td>
      <td>2550000</td>
      <td>2485000</td>
      <td>282000</td>
      <td>1512000</td>
      <td>755000</td>
      <td>52442</td>
      <td>15818</td>
      <td>1.22</td>
      <td>...</td>
      <td>1286</td>
      <td>9156</td>
      <td>1973</td>
      <td>6828</td>
      <td>512</td>
      <td>55412</td>
      <td>299924</td>
      <td>84056</td>
      <td>22849</td>
      <td>27799</td>
    </tr>
    <tr>
      <th>27</th>
      <td>R27000</td>
      <td>大阪府</td>
      <td>8782000</td>
      <td>8524000</td>
      <td>1002000</td>
      <td>5349000</td>
      <td>2432000</td>
      <td>208681</td>
      <td>59780</td>
      <td>1.27</td>
      <td>...</td>
      <td>5442</td>
      <td>26431</td>
      <td>8184</td>
      <td>27297</td>
      <td>1573</td>
      <td>172365</td>
      <td>265161</td>
      <td>80890</td>
      <td>18350</td>
      <td>25978</td>
    </tr>
  </tbody>
</table>
<p>2 rows × 92 columns</p>
</div></div></div>
</div>
</section>
</section>
</section>
<section id="id20">
<h2><span class="section-number">16.6. </span>データフレームの保存<a class="headerlink" href="#id20" title="Link to this heading">#</a></h2>
<p>データフレームの中身をCSV/TSVファイルに保存するにはDataFrameオブジェクトの<code class="docutils literal notranslate"><span class="pre">to_csv</span></code>メソッドを用いる．
以下，データフレーム<code class="docutils literal notranslate"><span class="pre">df</span></code>を<code class="docutils literal notranslate"><span class="pre">dataset</span></code>ディレクトリにCSVファイルとして保存するコード例．</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;dataset/SSDSE-E-2024.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">to_csv</span></code>メソッドは指定がなければ，データフレームをCSVファイルとして保存する．
TSVファイルとして保存したい場合は，以下のように引数<code class="docutils literal notranslate"><span class="pre">sep</span></code>に<code class="docutils literal notranslate"><span class="pre">\t</span></code>を指定する．
ファイル名の拡張子も<code class="docutils literal notranslate"><span class="pre">.tsv</span></code>としておこう．</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;dataset/SSDSE-E-2024.tsv&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>見出しやインデックス（データフレームが割り振った索引名）を保存するかは<code class="docutils literal notranslate"><span class="pre">header</span></code>引数および<code class="docutils literal notranslate"><span class="pre">index</span></code>引数で指定する．
双方の引数ともにデフォルトは<code class="docutils literal notranslate"><span class="pre">True</span></code>（保存する）．</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 以下の場合，見出しはCSVファイルに保存し，インデックスは保存しない</span>
<span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;dataset/SSDSE-E-2024.csv&#39;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="id21">
<h2><span class="section-number">16.7. </span>前処理<a class="headerlink" href="#id21" title="Link to this heading">#</a></h2>
<p><a class="reference external" href="https://github.com/lgreski/pokemonData">pokemonData</a>は，ポケットモンスターシリーズに登場するポケモンの能力値をまとめたデータセットである．
このデータセット中には，欠損値をもつポケモンデータがいくつかある．
以降，前処理の説明ではこのデータセットを用いる．</p>
<p>まずは，以下のコードでデータセットを<code class="docutils literal notranslate"><span class="pre">pokemon_df</span></code>変数に読み込んでおく．</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># na_values引数に&#39; &#39;を与えて，空文字を欠損値として認識させる</span>
<span class="n">pokemon_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span>
    <span class="s1">&#39;https://raw.githubusercontent.com/lgreski/pokemonData/refs/heads/master/Pokemon.csv&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">na_values</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39; &#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pokemon_df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ID</th>
      <th>Name</th>
      <th>Form</th>
      <th>Type1</th>
      <th>Type2</th>
      <th>Total</th>
      <th>HP</th>
      <th>Attack</th>
      <th>Defense</th>
      <th>Sp. Atk</th>
      <th>Sp. Def</th>
      <th>Speed</th>
      <th>Generation</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>Bulbasaur</td>
      <td>NaN</td>
      <td>Grass</td>
      <td>Poison</td>
      <td>318</td>
      <td>45</td>
      <td>49</td>
      <td>49</td>
      <td>65</td>
      <td>65</td>
      <td>45</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>Ivysaur</td>
      <td>NaN</td>
      <td>Grass</td>
      <td>Poison</td>
      <td>405</td>
      <td>60</td>
      <td>62</td>
      <td>63</td>
      <td>80</td>
      <td>80</td>
      <td>60</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>Venusaur</td>
      <td>NaN</td>
      <td>Grass</td>
      <td>Poison</td>
      <td>525</td>
      <td>80</td>
      <td>82</td>
      <td>83</td>
      <td>100</td>
      <td>100</td>
      <td>80</td>
      <td>1</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>Charmander</td>
      <td>NaN</td>
      <td>Fire</td>
      <td>NaN</td>
      <td>309</td>
      <td>39</td>
      <td>52</td>
      <td>43</td>
      <td>60</td>
      <td>50</td>
      <td>65</td>
      <td>1</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>Charmeleon</td>
      <td>NaN</td>
      <td>Fire</td>
      <td>NaN</td>
      <td>405</td>
      <td>58</td>
      <td>64</td>
      <td>58</td>
      <td>80</td>
      <td>65</td>
      <td>80</td>
      <td>1</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>1210</th>
      <td>1023</td>
      <td>Iron Crown</td>
      <td>NaN</td>
      <td>Steel</td>
      <td>Psychic</td>
      <td>590</td>
      <td>90</td>
      <td>72</td>
      <td>100</td>
      <td>122</td>
      <td>108</td>
      <td>98</td>
      <td>9</td>
    </tr>
    <tr>
      <th>1211</th>
      <td>1024</td>
      <td>Terapagos</td>
      <td>Normal Form</td>
      <td>Normal</td>
      <td>NaN</td>
      <td>450</td>
      <td>90</td>
      <td>65</td>
      <td>85</td>
      <td>65</td>
      <td>85</td>
      <td>60</td>
      <td>9</td>
    </tr>
    <tr>
      <th>1212</th>
      <td>1024</td>
      <td>Terapagos</td>
      <td>Terastal Form</td>
      <td>Normal</td>
      <td>NaN</td>
      <td>600</td>
      <td>95</td>
      <td>95</td>
      <td>110</td>
      <td>105</td>
      <td>110</td>
      <td>85</td>
      <td>9</td>
    </tr>
    <tr>
      <th>1213</th>
      <td>1024</td>
      <td>Terapagos</td>
      <td>Stellar Form</td>
      <td>Normal</td>
      <td>NaN</td>
      <td>700</td>
      <td>160</td>
      <td>105</td>
      <td>110</td>
      <td>130</td>
      <td>110</td>
      <td>85</td>
      <td>9</td>
    </tr>
    <tr>
      <th>1214</th>
      <td>1025</td>
      <td>Pecharunt</td>
      <td>NaN</td>
      <td>Poison</td>
      <td>Ghost</td>
      <td>600</td>
      <td>88</td>
      <td>88</td>
      <td>160</td>
      <td>88</td>
      <td>88</td>
      <td>88</td>
      <td>9</td>
    </tr>
  </tbody>
</table>
<p>1215 rows × 13 columns</p>
</div></div></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p class="rubric" id="id22">このノートで取り上げない前処理</p>
<p>このノートでは以下の項目について触れないが，重要な前処理なので興味があれば調べること．</p>
<ul class="simple">
<li><p>欠損値の穴埋め</p></li>
<li><p>ウィンドウ関数</p></li>
<li><p>データ拡張（オーバーサンプリングなど）</p></li>
<li><p>日時処理</p></li>
<li><p>自然言語処理（embeddingなど）</p></li>
</ul>
</div>
<section id="id23">
<h3><span class="section-number">16.7.1. </span>列名の変更<a class="headerlink" href="#id23" title="Link to this heading">#</a></h3>
<p>列名の変更はDataFrameオブジェクトの<code class="docutils literal notranslate"><span class="pre">rename</span></code>メソッドで行う．
<code class="docutils literal notranslate"><span class="pre">rename</span></code>メソッドのの<code class="docutils literal notranslate"><span class="pre">columns</span></code>引数に<code class="docutils literal notranslate"><span class="pre">{'変更前の列名':</span> <span class="pre">'変更後の列名'}</span></code>の辞書を与えると，列名を変更できる．
<code class="docutils literal notranslate"><span class="pre">rename</span></code>メソッドは列名変更後のDataFrameオブジェクトを返す．</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pokemon_df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Sp. Atk&#39;</span><span class="p">:</span> <span class="s1">&#39;Special_Attack&#39;</span><span class="p">,</span> <span class="s1">&#39;Sp. Def&#39;</span><span class="p">:</span> <span class="s1">&#39;Special_Defense&#39;</span><span class="p">})</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ID</th>
      <th>Name</th>
      <th>Form</th>
      <th>Type1</th>
      <th>Type2</th>
      <th>Total</th>
      <th>HP</th>
      <th>Attack</th>
      <th>Defense</th>
      <th>Special_Attack</th>
      <th>Special_Defense</th>
      <th>Speed</th>
      <th>Generation</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>Bulbasaur</td>
      <td>NaN</td>
      <td>Grass</td>
      <td>Poison</td>
      <td>318</td>
      <td>45</td>
      <td>49</td>
      <td>49</td>
      <td>65</td>
      <td>65</td>
      <td>45</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>Ivysaur</td>
      <td>NaN</td>
      <td>Grass</td>
      <td>Poison</td>
      <td>405</td>
      <td>60</td>
      <td>62</td>
      <td>63</td>
      <td>80</td>
      <td>80</td>
      <td>60</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>Venusaur</td>
      <td>NaN</td>
      <td>Grass</td>
      <td>Poison</td>
      <td>525</td>
      <td>80</td>
      <td>82</td>
      <td>83</td>
      <td>100</td>
      <td>100</td>
      <td>80</td>
      <td>1</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>Charmander</td>
      <td>NaN</td>
      <td>Fire</td>
      <td>NaN</td>
      <td>309</td>
      <td>39</td>
      <td>52</td>
      <td>43</td>
      <td>60</td>
      <td>50</td>
      <td>65</td>
      <td>1</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>Charmeleon</td>
      <td>NaN</td>
      <td>Fire</td>
      <td>NaN</td>
      <td>405</td>
      <td>58</td>
      <td>64</td>
      <td>58</td>
      <td>80</td>
      <td>65</td>
      <td>80</td>
      <td>1</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>1210</th>
      <td>1023</td>
      <td>Iron Crown</td>
      <td>NaN</td>
      <td>Steel</td>
      <td>Psychic</td>
      <td>590</td>
      <td>90</td>
      <td>72</td>
      <td>100</td>
      <td>122</td>
      <td>108</td>
      <td>98</td>
      <td>9</td>
    </tr>
    <tr>
      <th>1211</th>
      <td>1024</td>
      <td>Terapagos</td>
      <td>Normal Form</td>
      <td>Normal</td>
      <td>NaN</td>
      <td>450</td>
      <td>90</td>
      <td>65</td>
      <td>85</td>
      <td>65</td>
      <td>85</td>
      <td>60</td>
      <td>9</td>
    </tr>
    <tr>
      <th>1212</th>
      <td>1024</td>
      <td>Terapagos</td>
      <td>Terastal Form</td>
      <td>Normal</td>
      <td>NaN</td>
      <td>600</td>
      <td>95</td>
      <td>95</td>
      <td>110</td>
      <td>105</td>
      <td>110</td>
      <td>85</td>
      <td>9</td>
    </tr>
    <tr>
      <th>1213</th>
      <td>1024</td>
      <td>Terapagos</td>
      <td>Stellar Form</td>
      <td>Normal</td>
      <td>NaN</td>
      <td>700</td>
      <td>160</td>
      <td>105</td>
      <td>110</td>
      <td>130</td>
      <td>110</td>
      <td>85</td>
      <td>9</td>
    </tr>
    <tr>
      <th>1214</th>
      <td>1025</td>
      <td>Pecharunt</td>
      <td>NaN</td>
      <td>Poison</td>
      <td>Ghost</td>
      <td>600</td>
      <td>88</td>
      <td>88</td>
      <td>160</td>
      <td>88</td>
      <td>88</td>
      <td>88</td>
      <td>9</td>
    </tr>
  </tbody>
</table>
<p>1215 rows × 13 columns</p>
</div></div></div>
</div>
</section>
<section id="id24">
<h3><span class="section-number">16.7.2. </span>データフレームの結合<a class="headerlink" href="#id24" title="Link to this heading">#</a></h3>
<section id="id25">
<h4><span class="section-number">16.7.2.1. </span>縦方向の結合<a class="headerlink" href="#id25" title="Link to this heading">#</a></h4>
<p>同じ構造を持つ（列項目が同じ）2つのデータフレームを縦方向に結合するには<code class="docutils literal notranslate"><span class="pre">concat</span></code>関数を用いる．
縦方向に結合する<code class="docutils literal notranslate"><span class="pre">concat</span></code>関数は，SQLの<code class="docutils literal notranslate"><span class="pre">UNION</span></code>に相当する．</p>
<p>以下は，仮にデータフレーム<code class="docutils literal notranslate"><span class="pre">pokemon_df</span></code>が</p>
<ul class="simple">
<li><p>第4世代以下のポケモン情報を格納した<code class="docutils literal notranslate"><span class="pre">pokemon_df1</span></code></p></li>
<li><p>第5世代以上のポケモン情報を格納した<code class="docutils literal notranslate"><span class="pre">pokemon_df2</span></code></p></li>
</ul>
<p>の2つのデータフレームに分割されているとしたときに，2つのデータフレームを結合して第1世代から第9世代のポケモン情報をまとめた1つのデータフレームを作るコード例である．</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># pokemon_dfが2つのデータフレームに分かれているとする</span>
<span class="n">pokemon_df1</span> <span class="o">=</span> <span class="n">pokemon_df</span><span class="p">[</span><span class="n">pokemon_df</span><span class="o">.</span><span class="n">Generation</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">]</span>
<span class="n">pokemon_df2</span> <span class="o">=</span> <span class="n">pokemon_df</span><span class="p">[</span><span class="n">pokemon_df</span><span class="o">.</span><span class="n">Generation</span> <span class="o">&gt;=</span> <span class="mi">5</span><span class="p">]</span>

<span class="c1"># concat関数で2つのデータフレームを縦方向に結合する</span>
<span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">pokemon_df1</span><span class="p">,</span> <span class="n">pokemon_df2</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ID</th>
      <th>Name</th>
      <th>Form</th>
      <th>Type1</th>
      <th>Type2</th>
      <th>Total</th>
      <th>HP</th>
      <th>Attack</th>
      <th>Defense</th>
      <th>Sp. Atk</th>
      <th>Sp. Def</th>
      <th>Speed</th>
      <th>Generation</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>Bulbasaur</td>
      <td>NaN</td>
      <td>Grass</td>
      <td>Poison</td>
      <td>318</td>
      <td>45</td>
      <td>49</td>
      <td>49</td>
      <td>65</td>
      <td>65</td>
      <td>45</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>Ivysaur</td>
      <td>NaN</td>
      <td>Grass</td>
      <td>Poison</td>
      <td>405</td>
      <td>60</td>
      <td>62</td>
      <td>63</td>
      <td>80</td>
      <td>80</td>
      <td>60</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>Venusaur</td>
      <td>NaN</td>
      <td>Grass</td>
      <td>Poison</td>
      <td>525</td>
      <td>80</td>
      <td>82</td>
      <td>83</td>
      <td>100</td>
      <td>100</td>
      <td>80</td>
      <td>1</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>Charmander</td>
      <td>NaN</td>
      <td>Fire</td>
      <td>NaN</td>
      <td>309</td>
      <td>39</td>
      <td>52</td>
      <td>43</td>
      <td>60</td>
      <td>50</td>
      <td>65</td>
      <td>1</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>Charmeleon</td>
      <td>NaN</td>
      <td>Fire</td>
      <td>NaN</td>
      <td>405</td>
      <td>58</td>
      <td>64</td>
      <td>58</td>
      <td>80</td>
      <td>65</td>
      <td>80</td>
      <td>1</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>1210</th>
      <td>1023</td>
      <td>Iron Crown</td>
      <td>NaN</td>
      <td>Steel</td>
      <td>Psychic</td>
      <td>590</td>
      <td>90</td>
      <td>72</td>
      <td>100</td>
      <td>122</td>
      <td>108</td>
      <td>98</td>
      <td>9</td>
    </tr>
    <tr>
      <th>1211</th>
      <td>1024</td>
      <td>Terapagos</td>
      <td>Normal Form</td>
      <td>Normal</td>
      <td>NaN</td>
      <td>450</td>
      <td>90</td>
      <td>65</td>
      <td>85</td>
      <td>65</td>
      <td>85</td>
      <td>60</td>
      <td>9</td>
    </tr>
    <tr>
      <th>1212</th>
      <td>1024</td>
      <td>Terapagos</td>
      <td>Terastal Form</td>
      <td>Normal</td>
      <td>NaN</td>
      <td>600</td>
      <td>95</td>
      <td>95</td>
      <td>110</td>
      <td>105</td>
      <td>110</td>
      <td>85</td>
      <td>9</td>
    </tr>
    <tr>
      <th>1213</th>
      <td>1024</td>
      <td>Terapagos</td>
      <td>Stellar Form</td>
      <td>Normal</td>
      <td>NaN</td>
      <td>700</td>
      <td>160</td>
      <td>105</td>
      <td>110</td>
      <td>130</td>
      <td>110</td>
      <td>85</td>
      <td>9</td>
    </tr>
    <tr>
      <th>1214</th>
      <td>1025</td>
      <td>Pecharunt</td>
      <td>NaN</td>
      <td>Poison</td>
      <td>Ghost</td>
      <td>600</td>
      <td>88</td>
      <td>88</td>
      <td>160</td>
      <td>88</td>
      <td>88</td>
      <td>88</td>
      <td>9</td>
    </tr>
  </tbody>
</table>
<p>1215 rows × 13 columns</p>
</div></div></div>
</div>
</section>
<section id="id26">
<h4><span class="section-number">16.7.2.2. </span>横方向の結合<a class="headerlink" href="#id26" title="Link to this heading">#</a></h4>
<p>SQLの<code class="docutils literal notranslate"><span class="pre">JOIN</span></code>に相当する結合をPandasのデータフレームに対して行うには<code class="docutils literal notranslate"><span class="pre">merge</span></code>関数を用いる．
<code class="docutils literal notranslate"><span class="pre">merge</span></code>関数の第1引数には結合したい1つ目のデータフレーム，第2引数には結合したい2つ目のデータフレームを指定する．
また，<code class="docutils literal notranslate"><span class="pre">on</span></code>引数には結合に用いる列項目名を，<code class="docutils literal notranslate"><span class="pre">how</span></code>引数には<code class="docutils literal notranslate"><span class="pre">inner</span></code>（内部結合），<code class="docutils literal notranslate"><span class="pre">outer</span></code>（外部結合），<code class="docutils literal notranslate"><span class="pre">left</span></code>（左外部結合），<code class="docutils literal notranslate"><span class="pre">right</span></code>（右外部結合）を指定できる．</p>
<p>以下は，仮にデータフレーム<code class="docutils literal notranslate"><span class="pre">pokemon_df</span></code>が</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">pokemon_df_base</span></code>: <code class="docutils literal notranslate"><span class="pre">ID</span></code>，<code class="docutils literal notranslate"><span class="pre">Name</span></code>，<code class="docutils literal notranslate"><span class="pre">Generation</span></code>，<code class="docutils literal notranslate"><span class="pre">Form</span></code>，<code class="docutils literal notranslate"><span class="pre">Type1</span></code>，<code class="docutils literal notranslate"><span class="pre">Type2</span></code>といったポケモンの基礎情報を格納</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pokemon_df_status</span></code>: <code class="docutils literal notranslate"><span class="pre">ID</span></code>，<code class="docutils literal notranslate"><span class="pre">Form</span></code>，<code class="docutils literal notranslate"><span class="pre">Total</span></code>，<code class="docutils literal notranslate"><span class="pre">Attack</span></code>，<code class="docutils literal notranslate"><span class="pre">Defense</span></code>，<code class="docutils literal notranslate"><span class="pre">Sp.</span> <span class="pre">Atk</span></code>，<code class="docutils literal notranslate"><span class="pre">Sp.</span> <span class="pre">Def</span></code>，<code class="docutils literal notranslate"><span class="pre">Speed</span></code>といったポケモンの戦闘力情報を格納</p></li>
</ul>
<p>の2つのデータフレームに分割されているとしたときに，2つのデータフレームを横方向に結合してポケモン情報をまとめた1つのデータフレームを作るコード例である．</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># pokemon_dfが2つのデータフレームに分かれているとする</span>
<span class="n">pokemon_df_base</span> <span class="o">=</span> <span class="n">pokemon_df</span><span class="p">[[</span><span class="s1">&#39;ID&#39;</span><span class="p">,</span> <span class="s1">&#39;Name&#39;</span><span class="p">,</span> <span class="s1">&#39;Generation&#39;</span><span class="p">,</span> <span class="s1">&#39;Form&#39;</span><span class="p">,</span> <span class="s1">&#39;Type1&#39;</span><span class="p">,</span> <span class="s1">&#39;Type2&#39;</span><span class="p">]]</span>
<span class="n">pokemon_df_status</span> <span class="o">=</span> <span class="n">pokemon_df</span><span class="p">[[</span><span class="s1">&#39;ID&#39;</span><span class="p">,</span> <span class="s1">&#39;Total&#39;</span><span class="p">,</span> <span class="s1">&#39;Attack&#39;</span><span class="p">,</span> <span class="s1">&#39;Defense&#39;</span><span class="p">,</span> <span class="s1">&#39;Sp. Atk&#39;</span><span class="p">,</span> <span class="s1">&#39;Sp. Def&#39;</span><span class="p">,</span> <span class="s1">&#39;Speed&#39;</span><span class="p">]]</span>

<span class="c1"># merge関数で2つのデータフレームを横方向に内部結合する（結合軸はID）</span>
<span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">pokemon_df_base</span><span class="p">,</span> <span class="n">pokemon_df_status</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;ID&#39;</span><span class="p">],</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;inner&#39;</span><span class="p">)</span>

<span class="c1"># 実は下のようにも書ける</span>
<span class="c1"># pokemon_df_base.merge(pokemon_df_status, on=[&#39;ID&#39;], how=&#39;inner&#39;)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ID</th>
      <th>Name</th>
      <th>Generation</th>
      <th>Form</th>
      <th>Type1</th>
      <th>Type2</th>
      <th>Total</th>
      <th>Attack</th>
      <th>Defense</th>
      <th>Sp. Atk</th>
      <th>Sp. Def</th>
      <th>Speed</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>Bulbasaur</td>
      <td>1</td>
      <td>NaN</td>
      <td>Grass</td>
      <td>Poison</td>
      <td>318</td>
      <td>49</td>
      <td>49</td>
      <td>65</td>
      <td>65</td>
      <td>45</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>Ivysaur</td>
      <td>1</td>
      <td>NaN</td>
      <td>Grass</td>
      <td>Poison</td>
      <td>405</td>
      <td>62</td>
      <td>63</td>
      <td>80</td>
      <td>80</td>
      <td>60</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>Venusaur</td>
      <td>1</td>
      <td>NaN</td>
      <td>Grass</td>
      <td>Poison</td>
      <td>525</td>
      <td>82</td>
      <td>83</td>
      <td>100</td>
      <td>100</td>
      <td>80</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3</td>
      <td>Venusaur</td>
      <td>1</td>
      <td>NaN</td>
      <td>Grass</td>
      <td>Poison</td>
      <td>625</td>
      <td>100</td>
      <td>123</td>
      <td>122</td>
      <td>120</td>
      <td>80</td>
    </tr>
    <tr>
      <th>4</th>
      <td>4</td>
      <td>Charmander</td>
      <td>1</td>
      <td>NaN</td>
      <td>Fire</td>
      <td>NaN</td>
      <td>309</td>
      <td>52</td>
      <td>43</td>
      <td>60</td>
      <td>50</td>
      <td>65</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>1696</th>
      <td>1024</td>
      <td>Terapagos</td>
      <td>9</td>
      <td>Terastal Form</td>
      <td>Normal</td>
      <td>NaN</td>
      <td>700</td>
      <td>105</td>
      <td>110</td>
      <td>130</td>
      <td>110</td>
      <td>85</td>
    </tr>
    <tr>
      <th>1697</th>
      <td>1024</td>
      <td>Terapagos</td>
      <td>9</td>
      <td>Stellar Form</td>
      <td>Normal</td>
      <td>NaN</td>
      <td>450</td>
      <td>65</td>
      <td>85</td>
      <td>65</td>
      <td>85</td>
      <td>60</td>
    </tr>
    <tr>
      <th>1698</th>
      <td>1024</td>
      <td>Terapagos</td>
      <td>9</td>
      <td>Stellar Form</td>
      <td>Normal</td>
      <td>NaN</td>
      <td>600</td>
      <td>95</td>
      <td>110</td>
      <td>105</td>
      <td>110</td>
      <td>85</td>
    </tr>
    <tr>
      <th>1699</th>
      <td>1024</td>
      <td>Terapagos</td>
      <td>9</td>
      <td>Stellar Form</td>
      <td>Normal</td>
      <td>NaN</td>
      <td>700</td>
      <td>105</td>
      <td>110</td>
      <td>130</td>
      <td>110</td>
      <td>85</td>
    </tr>
    <tr>
      <th>1700</th>
      <td>1025</td>
      <td>Pecharunt</td>
      <td>9</td>
      <td>NaN</td>
      <td>Poison</td>
      <td>Ghost</td>
      <td>600</td>
      <td>88</td>
      <td>160</td>
      <td>88</td>
      <td>88</td>
      <td>88</td>
    </tr>
  </tbody>
</table>
<p>1701 rows × 12 columns</p>
</div></div></div>
</div>
</section>
</section>
<section id="id27">
<h3><span class="section-number">16.7.3. </span>データの整然化：横持ちデータから縦持ちデータへ<a class="headerlink" href="#id27" title="Link to this heading">#</a></h3>
<p>以下の表は，<a class="reference external" href="https://www.gapminder.org/data">Gapminder</a>で公開されている世界各国の幸福度スコアをまとめたものである．
表中の各行は国を表し，年ごとの幸福度スコアが各列に格納されている．
なお，国によっては幸福度スコアが計測されていない年もある．</p>
<div class="cell tag_remove-input docutils container">
</div>
<p>以下の表は，上の表と同じ内容を別の表現で表したものである．
各行が1回の（幸福度スコア）計測に対応しており，行にはどの国（<code class="docutils literal notranslate"><span class="pre">country</span></code>）のいつ計測された（<code class="docutils literal notranslate"><span class="pre">year</span></code>）幸福度スコアがいくつだったか（<code class="docutils literal notranslate"><span class="pre">happiness_score</span></code>）の情報が格納されている．
下の表のように，</p>
<ul class="simple">
<li><p>個々の変数が列に対応し，</p></li>
<li><p>個々の観測が行に対応し，</p></li>
<li><p>個々の値がセルに対応し</p></li>
<li><p>個々の観測ユニットの類型が1つの表に対応する</p></li>
</ul>
<p>表データを<strong>整然データ（tidy data）</strong> あるいは<strong>縦持ちデータ</strong>と呼ぶ．
整然データでない表データは<strong>雑然データ（messy data）</strong> や<strong>横持ちデータ</strong>と呼ばれる．</p>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>country</th>
      <th>year</th>
      <th>happiness_score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Afghanistan</td>
      <td>2005</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Angola</td>
      <td>2005</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Albania</td>
      <td>2005</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3</th>
      <td>UAE</td>
      <td>2005</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Argentina</td>
      <td>2005</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>3111</th>
      <td>Vietnam</td>
      <td>2023</td>
      <td>63.3</td>
    </tr>
    <tr>
      <th>3112</th>
      <td>Yemen</td>
      <td>2023</td>
      <td>35.3</td>
    </tr>
    <tr>
      <th>3113</th>
      <td>South Africa</td>
      <td>2023</td>
      <td>50.8</td>
    </tr>
    <tr>
      <th>3114</th>
      <td>Zambia</td>
      <td>2023</td>
      <td>36.9</td>
    </tr>
    <tr>
      <th>3115</th>
      <td>Zimbabwe</td>
      <td>2023</td>
      <td>35.7</td>
    </tr>
  </tbody>
</table>
<p>3116 rows × 3 columns</p>
</div></div></div>
</div>
<p>整然データはデータの管理がしやすい．
また，計算機によるデータ処理を行う際には，整然データのほうが都合が良いことが多い．
例えば，例に挙げた幸福度スコアの表を</p>
<ul class="simple">
<li><p>雑然データ形式で格納したデータフレーム<code class="docutils literal notranslate"><span class="pre">messy_df</span></code></p></li>
<li><p>整然データ形式で格納したデータフレーム<code class="docutils literal notranslate"><span class="pre">tidy_df</span></code></p></li>
</ul>
<p>のそれぞれが手元にあるとしよう．
それぞれのデータフレームを使って，</p>
<ul class="simple">
<li><p>ある年に計測した幸福度が50を超えている国を抽出したい</p></li>
<li><p>国ごとに幸福度の平均値を算出したい</p></li>
</ul>
<p>とき，整然データ形式の<code class="docutils literal notranslate"><span class="pre">tidy_df</span></code>であれば</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># ある年に計測した幸福度が50を超えている国を抽出</span>
<span class="n">tidy_df</span><span class="p">[</span><span class="n">tidy_df</span><span class="o">.</span><span class="n">happiness_score</span> <span class="o">&gt;=</span> <span class="mi">50</span><span class="p">][</span><span class="s1">&#39;country&#39;</span><span class="p">]</span>

<span class="c1"># 国毎に幸福度の平均値を算出</span>
<span class="n">tidy_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;country&#39;</span><span class="p">)[</span><span class="s1">&#39;happiness_score&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
<p>と書ける．
一方，雑然データ形式の<code class="docutils literal notranslate"><span class="pre">messy_df</span></code>を使った場合，アッサリとコードを書けない．</p>
<p>雑然データ形式のDataFrameオブジェクトを整然データ形式に変換するには，pandasの<code class="docutils literal notranslate"><span class="pre">melt</span></code>関数を用いる．
例えば，上の例で用いた世界各国の幸福度スコアを格納した雑然データを整然データに変換するには，以下のようなコードを書く．
<code class="docutils literal notranslate"><span class="pre">melt</span></code>関数の</p>
<ul class="simple">
<li><p>第1引数には雑然データ形式のDataFrameオブジェクト</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">id_vars</span></code>引数にはIDとして使用する列名</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">var_name</span></code>引数には<code class="docutils literal notranslate"><span class="pre">id_vars</span></code>で指定しなかった（雑然データ中で）残りの列名をまとめる変数名</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">value_name</span></code>引数には雑然データにおけるセル値に割り当てる変数名</p></li>
</ul>
<p>を指定する．</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Gapminderで公開されている世界各国の幸福度スコアを格納したCSVファイルを読み込む</span>
<span class="c1"># このCSVファイルに格納された表データは雑然データ</span>
<span class="n">happiness_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="s1">&#39;dataset/happiness_score.csv&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>

<span class="c1"># 整然データ形式に変換</span>
<span class="n">tidy_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">happiness_df</span><span class="p">,</span> <span class="n">id_vars</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;country&#39;</span><span class="p">],</span> <span class="n">var_name</span><span class="o">=</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="n">value_name</span><span class="o">=</span><span class="s1">&#39;happiness_score&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>雑然データは計算機では処理しづらいが，人間には理解しやすいというメリットがある．
整然データ形式のDataFrameオブジェクトを雑然データ形式に変換するには，DataFrameオブジェクトの<code class="docutils literal notranslate"><span class="pre">pivot</span></code>メソッドを用いる．</p>
<p>以下は，整然データ形式で格納された幸福度スコアのデータフレーム<code class="docutils literal notranslate"><span class="pre">tidy_df</span></code>を雑然データに変換するコード例である．</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tidy_df</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="s1">&#39;country&#39;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="s1">&#39;happiness_score&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>year</th>
      <th>2005</th>
      <th>2006</th>
      <th>2007</th>
      <th>2008</th>
      <th>2009</th>
      <th>2010</th>
      <th>2011</th>
      <th>2012</th>
      <th>2013</th>
      <th>2014</th>
      <th>2015</th>
      <th>2016</th>
      <th>2017</th>
      <th>2018</th>
      <th>2019</th>
      <th>2020</th>
      <th>2021</th>
      <th>2022</th>
      <th>2023</th>
    </tr>
    <tr>
      <th>country</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Afghanistan</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>37.2</td>
      <td>44.0</td>
      <td>47.6</td>
      <td>38.3</td>
      <td>37.8</td>
      <td>35.7</td>
      <td>31.3</td>
      <td>39.8</td>
      <td>42.2</td>
      <td>26.6</td>
      <td>26.9</td>
      <td>23.8</td>
      <td>NaN</td>
      <td>24.4</td>
      <td>12.8</td>
      <td>14.5</td>
    </tr>
    <tr>
      <th>Albania</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>46.3</td>
      <td>NaN</td>
      <td>54.9</td>
      <td>52.7</td>
      <td>58.7</td>
      <td>55.1</td>
      <td>45.5</td>
      <td>48.1</td>
      <td>46.1</td>
      <td>45.1</td>
      <td>46.4</td>
      <td>50.0</td>
      <td>50.0</td>
      <td>53.6</td>
      <td>52.5</td>
      <td>52.1</td>
      <td>54.5</td>
    </tr>
    <tr>
      <th>Algeria</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>54.6</td>
      <td>53.2</td>
      <td>56.0</td>
      <td>NaN</td>
      <td>63.5</td>
      <td>NaN</td>
      <td>53.4</td>
      <td>52.5</td>
      <td>50.4</td>
      <td>47.5</td>
      <td>54.4</td>
      <td>52.2</td>
      <td>55.4</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>Angola</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>55.9</td>
      <td>43.6</td>
      <td>39.4</td>
      <td>38.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>Argentina</th>
      <td>NaN</td>
      <td>63.1</td>
      <td>60.7</td>
      <td>59.6</td>
      <td>64.2</td>
      <td>64.4</td>
      <td>67.8</td>
      <td>64.7</td>
      <td>65.8</td>
      <td>66.7</td>
      <td>67.0</td>
      <td>64.3</td>
      <td>60.4</td>
      <td>57.9</td>
      <td>60.9</td>
      <td>59.0</td>
      <td>59.1</td>
      <td>62.6</td>
      <td>63.9</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>Venezuela</th>
      <td>71.7</td>
      <td>65.3</td>
      <td>NaN</td>
      <td>62.6</td>
      <td>71.9</td>
      <td>74.8</td>
      <td>65.8</td>
      <td>70.7</td>
      <td>65.5</td>
      <td>61.4</td>
      <td>55.7</td>
      <td>40.4</td>
      <td>50.7</td>
      <td>50.1</td>
      <td>50.8</td>
      <td>45.7</td>
      <td>51.1</td>
      <td>59.5</td>
      <td>57.6</td>
    </tr>
    <tr>
      <th>Vietnam</th>
      <td>NaN</td>
      <td>52.9</td>
      <td>54.2</td>
      <td>54.8</td>
      <td>53.0</td>
      <td>53.0</td>
      <td>57.7</td>
      <td>55.4</td>
      <td>50.2</td>
      <td>50.9</td>
      <td>50.8</td>
      <td>50.6</td>
      <td>51.8</td>
      <td>53.0</td>
      <td>54.7</td>
      <td>54.6</td>
      <td>55.4</td>
      <td>62.7</td>
      <td>63.3</td>
    </tr>
    <tr>
      <th>Yemen</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>44.8</td>
      <td>NaN</td>
      <td>48.1</td>
      <td>43.5</td>
      <td>37.5</td>
      <td>40.6</td>
      <td>42.2</td>
      <td>39.7</td>
      <td>29.8</td>
      <td>38.3</td>
      <td>32.5</td>
      <td>30.6</td>
      <td>42.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>35.9</td>
      <td>35.3</td>
    </tr>
    <tr>
      <th>Zambia</th>
      <td>NaN</td>
      <td>48.2</td>
      <td>40.0</td>
      <td>47.3</td>
      <td>52.6</td>
      <td>NaN</td>
      <td>50.0</td>
      <td>50.1</td>
      <td>52.4</td>
      <td>43.5</td>
      <td>48.4</td>
      <td>43.5</td>
      <td>39.3</td>
      <td>40.4</td>
      <td>33.1</td>
      <td>48.4</td>
      <td>30.8</td>
      <td>37.3</td>
      <td>36.9</td>
    </tr>
    <tr>
      <th>Zimbabwe</th>
      <td>NaN</td>
      <td>38.3</td>
      <td>32.8</td>
      <td>31.7</td>
      <td>40.6</td>
      <td>46.8</td>
      <td>48.5</td>
      <td>49.5</td>
      <td>46.9</td>
      <td>41.8</td>
      <td>37.0</td>
      <td>37.4</td>
      <td>36.4</td>
      <td>36.2</td>
      <td>26.9</td>
      <td>31.6</td>
      <td>31.6</td>
      <td>33.0</td>
      <td>35.7</td>
    </tr>
  </tbody>
</table>
<p>164 rows × 19 columns</p>
</div></div></div>
</div>
</section>
<section id="id28">
<h3><span class="section-number">16.7.4. </span>新しい列の追加<a class="headerlink" href="#id28" title="Link to this heading">#</a></h3>
<p>DataFrameオブジェクトに新しい列を追加する最も単純な方法は，中括弧で新規で追加する列に「アクセス」して値を代入する方法である．
以下は，データフレーム<code class="docutils literal notranslate"><span class="pre">pokemon_df</span></code>に<code class="docutils literal notranslate"><span class="pre">Special_Total</span></code>という列名を追加して，<code class="docutils literal notranslate"><span class="pre">Sp.</span> <span class="pre">Atk</span></code>列と<code class="docutils literal notranslate"><span class="pre">Sp.</span> <span class="pre">Def</span></code>列の合計値を代入するコード例である．</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pokemon_df</span><span class="p">[</span><span class="s1">&#39;Special_Total&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pokemon_df</span><span class="p">[</span><span class="s1">&#39;Sp. Atk&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">pokemon_df</span><span class="p">[</span><span class="s1">&#39;Sp. Def&#39;</span><span class="p">]</span>

<span class="c1"># 以下のように，ドットを使って代入先を指定する方法を用いると，データフレーム中に列名が存在しないと警告が出る</span>
<span class="c1"># pokemon_df.Special_Total = pokemon_df[&#39;Sp. Atk&#39;] + pokemon_df[&#39;Sp. Def&#39;]</span>
</pre></div>
</div>
</div>
</div>
<p>DataFrameオブジェクトに新しい列を追加するもう1つの方法は<code class="docutils literal notranslate"><span class="pre">assign</span></code>メソッドを用いる方法である．
<code class="docutils literal notranslate"><span class="pre">assign</span></code>メソッドを用いると，複数の列を同時に追加できる．</p>
<p>以下は，データフレーム<code class="docutils literal notranslate"><span class="pre">pokemon_df</span></code>に</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Sp.</span> <span class="pre">Atk</span></code>列と<code class="docutils literal notranslate"><span class="pre">Sp.</span> <span class="pre">Def</span></code>列の合計値を格納した<code class="docutils literal notranslate"><span class="pre">Special_Total</span></code>という列</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Attack</span></code>列と<code class="docutils literal notranslate"><span class="pre">Defense</span></code>列の合計値を格納した<code class="docutils literal notranslate"><span class="pre">Base_Total</span></code>という列</p></li>
</ul>
<p>を追加するコード例である．
なお，<code class="docutils literal notranslate"><span class="pre">assign</span></code>メソッドは返り値として列を追加後のDataFrameオブジェクトを返すことに注意（元のDataFrameオブジェクトを変更しない）．
また，<code class="docutils literal notranslate"><span class="pre">assign</span></code>メソッドを使用するときは，代入先の列名はクオーツ（’）で包まない（文字列リテラルにする）ことに注意．</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pokemon_df</span> <span class="o">=</span> <span class="n">pokemon_df</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span>
    <span class="n">Special_Total</span> <span class="o">=</span> <span class="n">pokemon_df</span><span class="p">[</span><span class="s1">&#39;Sp. Atk&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">pokemon_df</span><span class="p">[</span><span class="s1">&#39;Sp. Def&#39;</span><span class="p">],</span>
    <span class="n">Base_Total</span> <span class="o">=</span> <span class="n">pokemon_df</span><span class="p">[</span><span class="s1">&#39;Attack&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">pokemon_df</span><span class="p">[</span><span class="s1">&#39;Defense&#39;</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="id29">
<h3><span class="section-number">16.7.5. </span>関数の適用によるデータ加工<a class="headerlink" href="#id29" title="Link to this heading">#</a></h3>
<p>データフレーム中の任意の列の各データに一括処理を行うには<code class="docutils literal notranslate"><span class="pre">apply</span></code>メソッドを用いる．
<code class="docutils literal notranslate"><span class="pre">apply</span></code>メソッドの第1引数には関数オブジェクトを与える．
必要なら<code class="docutils literal notranslate"><span class="pre">args</span></code>引数に関数オブジェクトに渡す追加引数をリストで指定する．</p>
<p>以下は，データフレーム<code class="docutils literal notranslate"><span class="pre">pokemon_df</span></code>の<code class="docutils literal notranslate"><span class="pre">Speed</span></code>の値がその平均値よりも大きい場合は”fast”グループ，小さければ”slow”グループに割り当て，割り当てられたグループ名を<code class="docutils literal notranslate"><span class="pre">speed_class</span></code>列に格納するコード例である．</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Speedの平均値をあらかじめ計算しておく</span>
<span class="n">avg_speed</span> <span class="o">=</span> <span class="n">pokemon_df</span><span class="o">.</span><span class="n">Speed</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

<span class="k">def</span><span class="w"> </span><span class="nf">greater_than</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">avg_total</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">val</span> <span class="o">&gt;=</span> <span class="n">avg_speed</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;fast&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;slow&#39;</span>

<span class="c1"># args引数にgreater_than関数に渡す追加引数avg_speedを指定</span>
<span class="n">pokemon_df</span><span class="p">[</span><span class="s1">&#39;speed_class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pokemon_df</span><span class="o">.</span><span class="n">Speed</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">greater_than</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">avg_speed</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">apply</span></code>メソッドはlambda関数を使うとすっきり書ける．
上記コード例をlambda関数を使って書いたのが以下である．</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pokemon_df</span><span class="p">[</span><span class="s1">&#39;speed_class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pokemon_df</span><span class="o">.</span><span class="n">Speed</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="s1">&#39;fast&#39;</span> <span class="k">if</span> <span class="n">s</span> <span class="o">&gt;=</span> <span class="n">pokemon_df</span><span class="o">.</span><span class="n">Speed</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="k">else</span> <span class="s1">&#39;slow&#39;</span><span class="p">)</span>

<span class="c1"># データの読み込み，複数の前処理を一気にやるなら，assignメソッドを使った方が読みやすい</span>
<span class="c1"># pokemon_df = pd.read_table(</span>
<span class="c1">#     &#39;https://raw.githubusercontent.com/lgreski/pokemonData/refs/heads/master/Pokemon.csv&#39;,</span>
<span class="c1">#     sep=&#39;,&#39;, na_values=[&#39; &#39;]</span>
<span class="c1"># ).assign(</span>
<span class="c1">#     speed_class = lambda df: df.Speed.apply(lambda s: &#39;fast&#39; if s &gt;= pokemon_df.Speed.mean() else &#39;slow&#39;),</span>
<span class="c1">#     attack_class = lambda df: df.Attack.apply(lambda s: &#39;high_attack&#39; if s &gt;= pokemon_df.Attack.mean() else &#39;low_attack&#39;)</span>
<span class="c1"># )</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="id30">
<h3><span class="section-number">16.7.6. </span>ダミー変数化<a class="headerlink" href="#id30" title="Link to this heading">#</a></h3>
<p>商品カテゴリや性別など，データには何らかのカテゴリやラベルを示す値が数値または文字列で入っていることがしばしばある．
このような<strong>カテゴリデータ（categorical data）</strong> は，そのまま扱うとに機械学習では都合が悪い．
そのため，<strong>ダミー変数化</strong>と呼ばれるデータ変換がしばしば行われる．</p>
<p>代表的なダミー変数化方法は<strong>one-hotエンコーディング</strong>である．
One-hotエンコーディングは，カテゴリデータが格納されているある列の各値が特定のカテゴリ値と一致しているかを0か1の2値で表す新たな列データを生成する．
例えば，データフレーム中に性別情報を示す<code class="docutils literal notranslate"><span class="pre">gender</span></code>という列があり，<code class="docutils literal notranslate"><span class="pre">gender</span></code>列には「男性」「女性」「答えたくない」の3つのカテゴリ値が格納されているとしよう．
この<code class="docutils literal notranslate"><span class="pre">gender</span></code>列のデータにone-hotエンコーディングを適用すると，<code class="docutils literal notranslate"><span class="pre">gender</span></code>列と同等の情報を表現するために，</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">is_gender_male</span></code>列: 対象レコードの性別情報が「男性」であるか否かを1もしくは0で示す</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">is_gender_female</span></code>列: 対象レコードの性別情報が「女性」であるか否かを1もしくは0で示す</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">is_gender_NA</span></code>列: 対象レコードの性別情報が「答えたくない」であるか否かを1もしくは0で示す</p></li>
</ul>
<p>のような3列を生成する．</p>
<p>実際にone-hotエンコーディングを用いる際には，すべてのカテゴリ値を列に変換しない．
例えば，上の<code class="docutils literal notranslate"><span class="pre">gender</span></code>列の例の場合，<code class="docutils literal notranslate"><span class="pre">gender</span></code>列が取り得る3つの値をすべて表現するには<code class="docutils literal notranslate"><span class="pre">is_gender_male</span></code>列，<code class="docutils literal notranslate"><span class="pre">is_gender_female</span></code>列，<code class="docutils literal notranslate"><span class="pre">is_gender_NA</span></code>列からいずれか2つの列を用いれば十分である．</p>
<p>pandasには，データフレーム中の特定の列にone-hotエンコーディングを適用する<code class="docutils literal notranslate"><span class="pre">pandas.get_dummies</span></code>関数がある．
<code class="docutils literal notranslate"><span class="pre">get_dummies</span></code>関数は，第1引数にDataFrameオブジェクト，<code class="docutils literal notranslate"><span class="pre">columns</span></code>引数にダミー変数化の対象となる列項目のリストを指定する．
また，<code class="docutils literal notranslate"><span class="pre">drop_first</span></code>引数に<code class="docutils literal notranslate"><span class="pre">True</span></code>を与えると，（上の<code class="docutils literal notranslate"><span class="pre">gender</span></code>列の例でダミー変数化された列が2つで十分だったように）カテゴリ値を表現するのに余分なダミー変数列を生成しない．</p>
<p>以下は，データフレーム<code class="docutils literal notranslate"><span class="pre">pokemon_df</span></code>の<code class="docutils literal notranslate"><span class="pre">Generation</span></code>列にone-hotエンコーディングを適用するコード例である．
<code class="docutils literal notranslate"><span class="pre">Generation</span></code>列の値は1から9の9種類あるが，<code class="docutils literal notranslate"><span class="pre">drop_first</span></code>引数に<code class="docutils literal notranslate"><span class="pre">True</span></code>を指定しているので，<code class="docutils literal notranslate"><span class="pre">get_dummies</span></code>関数によって生成されたダミー変数列は8つとなっている．</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># get_dummies関数の返値は，ダミー変数化した列を含めた新しいDataFrameオブジェクト</span>
<span class="n">pd</span><span class="o">.</span><span class="n">get_dummies</span><span class="p">(</span><span class="n">pokemon_df</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Generation&#39;</span><span class="p">],</span> <span class="n">drop_first</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ID</th>
      <th>Name</th>
      <th>Form</th>
      <th>Type1</th>
      <th>Type2</th>
      <th>Total</th>
      <th>HP</th>
      <th>Attack</th>
      <th>Defense</th>
      <th>Sp. Atk</th>
      <th>...</th>
      <th>Base_Total</th>
      <th>speed_class</th>
      <th>Generation_2</th>
      <th>Generation_3</th>
      <th>Generation_4</th>
      <th>Generation_5</th>
      <th>Generation_6</th>
      <th>Generation_7</th>
      <th>Generation_8</th>
      <th>Generation_9</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>Bulbasaur</td>
      <td>NaN</td>
      <td>Grass</td>
      <td>Poison</td>
      <td>318</td>
      <td>45</td>
      <td>49</td>
      <td>49</td>
      <td>65</td>
      <td>...</td>
      <td>98</td>
      <td>slow</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>Ivysaur</td>
      <td>NaN</td>
      <td>Grass</td>
      <td>Poison</td>
      <td>405</td>
      <td>60</td>
      <td>62</td>
      <td>63</td>
      <td>80</td>
      <td>...</td>
      <td>125</td>
      <td>slow</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>Venusaur</td>
      <td>NaN</td>
      <td>Grass</td>
      <td>Poison</td>
      <td>525</td>
      <td>80</td>
      <td>82</td>
      <td>83</td>
      <td>100</td>
      <td>...</td>
      <td>165</td>
      <td>fast</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>Charmander</td>
      <td>NaN</td>
      <td>Fire</td>
      <td>NaN</td>
      <td>309</td>
      <td>39</td>
      <td>52</td>
      <td>43</td>
      <td>60</td>
      <td>...</td>
      <td>95</td>
      <td>slow</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>Charmeleon</td>
      <td>NaN</td>
      <td>Fire</td>
      <td>NaN</td>
      <td>405</td>
      <td>58</td>
      <td>64</td>
      <td>58</td>
      <td>80</td>
      <td>...</td>
      <td>122</td>
      <td>fast</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>1210</th>
      <td>1023</td>
      <td>Iron Crown</td>
      <td>NaN</td>
      <td>Steel</td>
      <td>Psychic</td>
      <td>590</td>
      <td>90</td>
      <td>72</td>
      <td>100</td>
      <td>122</td>
      <td>...</td>
      <td>172</td>
      <td>fast</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>True</td>
    </tr>
    <tr>
      <th>1211</th>
      <td>1024</td>
      <td>Terapagos</td>
      <td>Normal Form</td>
      <td>Normal</td>
      <td>NaN</td>
      <td>450</td>
      <td>90</td>
      <td>65</td>
      <td>85</td>
      <td>65</td>
      <td>...</td>
      <td>150</td>
      <td>slow</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>True</td>
    </tr>
    <tr>
      <th>1212</th>
      <td>1024</td>
      <td>Terapagos</td>
      <td>Terastal Form</td>
      <td>Normal</td>
      <td>NaN</td>
      <td>600</td>
      <td>95</td>
      <td>95</td>
      <td>110</td>
      <td>105</td>
      <td>...</td>
      <td>205</td>
      <td>fast</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>True</td>
    </tr>
    <tr>
      <th>1213</th>
      <td>1024</td>
      <td>Terapagos</td>
      <td>Stellar Form</td>
      <td>Normal</td>
      <td>NaN</td>
      <td>700</td>
      <td>160</td>
      <td>105</td>
      <td>110</td>
      <td>130</td>
      <td>...</td>
      <td>215</td>
      <td>fast</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>True</td>
    </tr>
    <tr>
      <th>1214</th>
      <td>1025</td>
      <td>Pecharunt</td>
      <td>NaN</td>
      <td>Poison</td>
      <td>Ghost</td>
      <td>600</td>
      <td>88</td>
      <td>88</td>
      <td>160</td>
      <td>88</td>
      <td>...</td>
      <td>248</td>
      <td>fast</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>True</td>
    </tr>
  </tbody>
</table>
<p>1215 rows × 23 columns</p>
</div></div></div>
</div>
</section>
<section id="id31">
<h3><span class="section-number">16.7.7. </span>集約演算<a class="headerlink" href="#id31" title="Link to this heading">#</a></h3>
<p>表データを扱うpandasは，SQLのように集約演算を行うことができる．
pandasにおける集約演算は，DataFrameオブジェクトの<code class="docutils literal notranslate"><span class="pre">groupby</span></code>メソッドで行う．
<code class="docutils literal notranslate"><span class="pre">groups</span></code>メソッドは引数で指定された値でグループ化したGroupByオブジェクトを返すので，GroupByオブジェクトの関心のある列項目にアクセスして集計関数を適用する．</p>
<p>以下は，データフレーム<code class="docutils literal notranslate"><span class="pre">pokemon_df</span></code>を<code class="docutils literal notranslate"><span class="pre">Generation</span></code>項目の値で集約し，<code class="docutils literal notranslate"><span class="pre">Geneartion</span></code>ごとの<code class="docutils literal notranslate"><span class="pre">HP</span></code>，<code class="docutils literal notranslate"><span class="pre">Attack</span></code>，<code class="docutils literal notranslate"><span class="pre">Defense</span></code>項目の平均値を計算するコードである．</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 平均値</span>
<span class="n">pokemon_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Generation&#39;</span><span class="p">])[[</span><span class="s1">&#39;HP&#39;</span><span class="p">,</span> <span class="s1">&#39;Attack&#39;</span><span class="p">,</span> <span class="s1">&#39;Defense&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

<span class="c1"># 個数</span>
<span class="c1"># pokemon_df.groupby([&#39;Generation&#39;])[[&#39;HP&#39;, &#39;Attack&#39;, &#39;Defense&#39;]].size()</span>

<span class="c1"># 合計</span>
<span class="c1"># pokemon_df.groupby([&#39;Generation&#39;])[[&#39;HP&#39;, &#39;Attack&#39;, &#39;Defense&#39;]].sum()</span>

<span class="c1"># 最大値</span>
<span class="c1"># pokemon_df.groupby([&#39;Generation&#39;])[[&#39;HP&#39;, &#39;Attack&#39;, &#39;Defense&#39;]].max()</span>

<span class="c1"># 最小値</span>
<span class="c1"># pokemon_df.groupby([&#39;Generation&#39;])[[&#39;HP&#39;, &#39;Attack&#39;, &#39;Defense&#39;]].min()</span>

<span class="c1"># 中央値</span>
<span class="c1"># pokemon_df.groupby([&#39;Generation&#39;])[[&#39;HP&#39;, &#39;Attack&#39;, &#39;Defense&#39;]].median()</span>

<span class="c1"># 標準偏差</span>
<span class="c1"># pokemon_df.groupby([&#39;Generation&#39;])[[&#39;HP&#39;, &#39;Attack&#39;, &#39;Defense&#39;]].std()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>HP</th>
      <th>Attack</th>
      <th>Defense</th>
    </tr>
    <tr>
      <th>Generation</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>64.211921</td>
      <td>72.913907</td>
      <td>68.225166</td>
    </tr>
    <tr>
      <th>2</th>
      <td>70.980000</td>
      <td>68.260000</td>
      <td>69.690000</td>
    </tr>
    <tr>
      <th>3</th>
      <td>65.425532</td>
      <td>73.936170</td>
      <td>69.475177</td>
    </tr>
    <tr>
      <th>4</th>
      <td>72.220339</td>
      <td>79.127119</td>
      <td>76.584746</td>
    </tr>
    <tr>
      <th>5</th>
      <td>71.709091</td>
      <td>82.442424</td>
      <td>72.078788</td>
    </tr>
    <tr>
      <th>6</th>
      <td>72.549618</td>
      <td>94.923664</td>
      <td>87.877863</td>
    </tr>
    <tr>
      <th>7</th>
      <td>70.434426</td>
      <td>86.508197</td>
      <td>78.278689</td>
    </tr>
    <tr>
      <th>8</th>
      <td>75.346939</td>
      <td>86.197279</td>
      <td>76.829932</td>
    </tr>
    <tr>
      <th>9</th>
      <td>78.685714</td>
      <td>83.850000</td>
      <td>77.007143</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>なお，集約されたレコードの個数を求めるだけなら，<code class="docutils literal notranslate"><span class="pre">groupby</span></code>メソッドを使わず，下記のように<code class="docutils literal notranslate"><span class="pre">value_counts</span></code>メソッドを使った方が簡単に書ける．</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># ジェネレーションごとのレコードの個数を計算</span>
<span class="n">pokemon_df</span><span class="p">[</span><span class="s1">&#39;Generation&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Generation
5    165
1    151
8    147
3    141
9    140
6    131
7    122
4    118
2    100
Name: count, dtype: int64
</pre></div>
</div>
</div>
</div>
<p>平均と標準偏差を同時に知りたいなど，複数の集計関数を同時に適用したい場合，DataFrameオブジェクトの<code class="docutils literal notranslate"><span class="pre">agg</span></code>メソッドを用いる．
<code class="docutils literal notranslate"><span class="pre">agg</span></code>メソッドの引数には集計対象となる列項目をキー，集計のための関数（のリスト）を値とする辞書を指定する．</p>
<p>以下は，データフレーム<code class="docutils literal notranslate"><span class="pre">pokemon_df</span></code>を<code class="docutils literal notranslate"><span class="pre">Generation</span></code>値で集約し，</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Total</span></code>値の平均，標準偏差</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Attack</span></code>値の最大値，最小値</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Defense</span></code>値の分散</p></li>
</ul>
<p>を計算するコード例である．
なお，下記コード例のように，関数は自作関数も指定可能である．</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># numpyの関数を使うために，ライブラリを読み込んでおく</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="c1"># 標準偏差から分散を求める関数を定義</span>
<span class="k">def</span><span class="w"> </span><span class="nf">variance</span><span class="p">(</span><span class="n">s</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">s</span><span class="o">.</span><span class="n">std</span><span class="p">()</span> <span class="o">**</span> <span class="mi">2</span>

<span class="n">pokemon_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Generation&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span>
    <span class="s1">&#39;Total&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">],</span> <span class="c1"># 平均と標準偏差を求める関数をリストで指定</span>
    <span class="s1">&#39;Attack&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">],</span> <span class="c1"># 最大値と最小値を求める関数をリストで指定</span>
    <span class="s1">&#39;Defense&#39;</span><span class="p">:</span> <span class="n">variance</span>         <span class="c1"># varianceは自分で定義した関数</span>
<span class="p">})</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th colspan="2" halign="left">Total</th>
      <th colspan="2" halign="left">Attack</th>
      <th>Defense</th>
    </tr>
    <tr>
      <th></th>
      <th>mean</th>
      <th>std</th>
      <th>max</th>
      <th>min</th>
      <th>variance</th>
    </tr>
    <tr>
      <th>Generation</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>407.642384</td>
      <td>99.875212</td>
      <td>134</td>
      <td>5</td>
      <td>724.508962</td>
    </tr>
    <tr>
      <th>2</th>
      <td>407.180000</td>
      <td>112.456266</td>
      <td>134</td>
      <td>10</td>
      <td>1241.226162</td>
    </tr>
    <tr>
      <th>3</th>
      <td>408.248227</td>
      <td>116.596260</td>
      <td>180</td>
      <td>15</td>
      <td>1002.579737</td>
    </tr>
    <tr>
      <th>4</th>
      <td>447.898305</td>
      <td>119.190101</td>
      <td>165</td>
      <td>5</td>
      <td>918.911560</td>
    </tr>
    <tr>
      <th>5</th>
      <td>434.896970</td>
      <td>107.931190</td>
      <td>170</td>
      <td>25</td>
      <td>518.585218</td>
    </tr>
    <tr>
      <th>6</th>
      <td>505.610687</td>
      <td>135.629335</td>
      <td>190</td>
      <td>22</td>
      <td>1338.769583</td>
    </tr>
    <tr>
      <th>7</th>
      <td>452.893443</td>
      <td>122.155761</td>
      <td>181</td>
      <td>20</td>
      <td>1017.194418</td>
    </tr>
    <tr>
      <th>8</th>
      <td>460.795918</td>
      <td>128.727222</td>
      <td>165</td>
      <td>20</td>
      <td>963.101016</td>
    </tr>
    <tr>
      <th>9</th>
      <td>462.157143</td>
      <td>115.871193</td>
      <td>160</td>
      <td>30</td>
      <td>756.669013</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="id32">
<h3><span class="section-number">16.7.8. </span>欠損値の発見<a class="headerlink" href="#id32" title="Link to this heading">#</a></h3>
<p>データフレーム中にある欠損値を発見するには，DataFrameオブジェクトの<code class="docutils literal notranslate"><span class="pre">isnull</span></code>メソッドを用いる．
DataFrameオブジェクトに<code class="docutils literal notranslate"><span class="pre">isnull</span></code>メソッドを適用すると，データフレーム中の各セルが欠損値か否かを示す真偽値を返す．</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pokemon_df</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ID</th>
      <th>Name</th>
      <th>Form</th>
      <th>Type1</th>
      <th>Type2</th>
      <th>Total</th>
      <th>HP</th>
      <th>Attack</th>
      <th>Defense</th>
      <th>Sp. Atk</th>
      <th>Sp. Def</th>
      <th>Speed</th>
      <th>Generation</th>
      <th>Special_Total</th>
      <th>Base_Total</th>
      <th>speed_class</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>False</td>
      <td>False</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
    </tr>
    <tr>
      <th>1</th>
      <td>False</td>
      <td>False</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
    </tr>
    <tr>
      <th>2</th>
      <td>False</td>
      <td>False</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
    </tr>
    <tr>
      <th>3</th>
      <td>False</td>
      <td>False</td>
      <td>True</td>
      <td>False</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
    </tr>
    <tr>
      <th>4</th>
      <td>False</td>
      <td>False</td>
      <td>True</td>
      <td>False</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>1210</th>
      <td>False</td>
      <td>False</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
    </tr>
    <tr>
      <th>1211</th>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
    </tr>
    <tr>
      <th>1212</th>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
    </tr>
    <tr>
      <th>1213</th>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
    </tr>
    <tr>
      <th>1214</th>
      <td>False</td>
      <td>False</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
    </tr>
  </tbody>
</table>
<p>1215 rows × 16 columns</p>
</div></div></div>
</div>
<p>欠損値を扱う場合，実際に知りたいのは</p>
<ol class="arabic simple">
<li><p>どの「項目（列）」に欠損値が存在するのか？</p></li>
<li><p>どの「レコード（行）」が欠損値を持つのか？</p></li>
</ol>
<p>であることが大半であろう．そのため，上記ニーズに応えるには<code class="docutils literal notranslate"><span class="pre">isnull</span></code>メソッドが返す結果を列方向か行方向に集約する必要がある．</p>
<section id="id33">
<h4><span class="section-number">16.7.8.1. </span>欠損値が存在する項目（列）を知りたい場合<a class="headerlink" href="#id33" title="Link to this heading">#</a></h4>
<p>DataFrameオブジェクトの<code class="docutils literal notranslate"><span class="pre">any</span></code>メソッドは，列方向（or 行方向）にセルの要素を調べたとき1つでもTrueがあればTrueを，それ以外ならFalseを返す，という操作を列（or 行）ごとに行う．
列方向に欠損値の有無を調べたい場合は，以下のコード例のように<code class="docutils literal notranslate"><span class="pre">any</span></code>メソッドの引数<code class="docutils literal notranslate"><span class="pre">axis</span></code>に<code class="docutils literal notranslate"><span class="pre">0</span></code>を設定する．</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pokemon_df</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ID               False
Name             False
Form              True
Type1            False
Type2             True
                 ...  
Speed            False
Generation       False
Special_Total    False
Base_Total       False
speed_class      False
Length: 16, dtype: bool
</pre></div>
</div>
</div>
</div>
<p>欠損値がある列を知りたい場合は，以下のようにする．</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pokemon_df</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">pokemon_df</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Index([&#39;Form&#39;, &#39;Type2&#39;], dtype=&#39;object&#39;)
</pre></div>
</div>
</div>
</div>
</section>
<section id="id34">
<h4><span class="section-number">16.7.8.2. </span>欠損値が存在するレコード（行）を知りたい場合<a class="headerlink" href="#id34" title="Link to this heading">#</a></h4>
<p>行方向に欠損値の有無を調べたい場合は，以下のコード例のように<code class="docutils literal notranslate"><span class="pre">any</span></code>メソッドの引数<code class="docutils literal notranslate"><span class="pre">axis</span></code>に<code class="docutils literal notranslate"><span class="pre">1</span></code>を設定する．</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pokemon_df</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0       True
1       True
2       True
3       True
4       True
        ... 
1210    True
1211    True
1212    True
1213    True
1214    True
Length: 1215, dtype: bool
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">isnull().any(axis=1)</span></code>は各レコード（行）に欠損値が含まれるか否かの情報のみを返すので，欠損値が含まれるレコードを抽出するには以下のようにする．</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pokemon_df</span><span class="p">[</span><span class="n">pokemon_df</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ID</th>
      <th>Name</th>
      <th>Form</th>
      <th>Type1</th>
      <th>Type2</th>
      <th>Total</th>
      <th>HP</th>
      <th>Attack</th>
      <th>Defense</th>
      <th>Sp. Atk</th>
      <th>Sp. Def</th>
      <th>Speed</th>
      <th>Generation</th>
      <th>Special_Total</th>
      <th>Base_Total</th>
      <th>speed_class</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>Bulbasaur</td>
      <td>NaN</td>
      <td>Grass</td>
      <td>Poison</td>
      <td>318</td>
      <td>45</td>
      <td>49</td>
      <td>49</td>
      <td>65</td>
      <td>65</td>
      <td>45</td>
      <td>1</td>
      <td>130</td>
      <td>98</td>
      <td>slow</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>Ivysaur</td>
      <td>NaN</td>
      <td>Grass</td>
      <td>Poison</td>
      <td>405</td>
      <td>60</td>
      <td>62</td>
      <td>63</td>
      <td>80</td>
      <td>80</td>
      <td>60</td>
      <td>1</td>
      <td>160</td>
      <td>125</td>
      <td>slow</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>Venusaur</td>
      <td>NaN</td>
      <td>Grass</td>
      <td>Poison</td>
      <td>525</td>
      <td>80</td>
      <td>82</td>
      <td>83</td>
      <td>100</td>
      <td>100</td>
      <td>80</td>
      <td>1</td>
      <td>200</td>
      <td>165</td>
      <td>fast</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>Charmander</td>
      <td>NaN</td>
      <td>Fire</td>
      <td>NaN</td>
      <td>309</td>
      <td>39</td>
      <td>52</td>
      <td>43</td>
      <td>60</td>
      <td>50</td>
      <td>65</td>
      <td>1</td>
      <td>110</td>
      <td>95</td>
      <td>slow</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>Charmeleon</td>
      <td>NaN</td>
      <td>Fire</td>
      <td>NaN</td>
      <td>405</td>
      <td>58</td>
      <td>64</td>
      <td>58</td>
      <td>80</td>
      <td>65</td>
      <td>80</td>
      <td>1</td>
      <td>145</td>
      <td>122</td>
      <td>fast</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>1210</th>
      <td>1023</td>
      <td>Iron Crown</td>
      <td>NaN</td>
      <td>Steel</td>
      <td>Psychic</td>
      <td>590</td>
      <td>90</td>
      <td>72</td>
      <td>100</td>
      <td>122</td>
      <td>108</td>
      <td>98</td>
      <td>9</td>
      <td>230</td>
      <td>172</td>
      <td>fast</td>
    </tr>
    <tr>
      <th>1211</th>
      <td>1024</td>
      <td>Terapagos</td>
      <td>Normal Form</td>
      <td>Normal</td>
      <td>NaN</td>
      <td>450</td>
      <td>90</td>
      <td>65</td>
      <td>85</td>
      <td>65</td>
      <td>85</td>
      <td>60</td>
      <td>9</td>
      <td>150</td>
      <td>150</td>
      <td>slow</td>
    </tr>
    <tr>
      <th>1212</th>
      <td>1024</td>
      <td>Terapagos</td>
      <td>Terastal Form</td>
      <td>Normal</td>
      <td>NaN</td>
      <td>600</td>
      <td>95</td>
      <td>95</td>
      <td>110</td>
      <td>105</td>
      <td>110</td>
      <td>85</td>
      <td>9</td>
      <td>215</td>
      <td>205</td>
      <td>fast</td>
    </tr>
    <tr>
      <th>1213</th>
      <td>1024</td>
      <td>Terapagos</td>
      <td>Stellar Form</td>
      <td>Normal</td>
      <td>NaN</td>
      <td>700</td>
      <td>160</td>
      <td>105</td>
      <td>110</td>
      <td>130</td>
      <td>110</td>
      <td>85</td>
      <td>9</td>
      <td>240</td>
      <td>215</td>
      <td>fast</td>
    </tr>
    <tr>
      <th>1214</th>
      <td>1025</td>
      <td>Pecharunt</td>
      <td>NaN</td>
      <td>Poison</td>
      <td>Ghost</td>
      <td>600</td>
      <td>88</td>
      <td>88</td>
      <td>160</td>
      <td>88</td>
      <td>88</td>
      <td>88</td>
      <td>9</td>
      <td>176</td>
      <td>248</td>
      <td>fast</td>
    </tr>
  </tbody>
</table>
<p>1053 rows × 16 columns</p>
</div></div></div>
</div>
</section>
</section>
<section id="id35">
<h3><span class="section-number">16.7.9. </span>欠損値を持つレコードの除去<a class="headerlink" href="#id35" title="Link to this heading">#</a></h3>
<p>欠損値を含むレコードを除去する場合，以下の2パターンの処理が考えられる：</p>
<ol class="arabic simple">
<li><p>いずれかの列項目に1つでも欠損値を含む場合，そのレコードを除去する</p></li>
<li><p>指定した列項目に欠損値を含む場合，そのレコードを除去する</p></li>
</ol>
<p>いずれのパターンの場合も，DataFrameオブジェクトの<code class="docutils literal notranslate"><span class="pre">dropna</span></code>メソッドを用いる．
違いは<code class="docutils literal notranslate"><span class="pre">dropna</span></code>メソッドに与えるパラメータにある．</p>
<section id="id36">
<h4><span class="section-number">16.7.9.1. </span>いずれかの列項目に1つでも欠損値を含む場合<a class="headerlink" href="#id36" title="Link to this heading">#</a></h4>
<p>パターン1の場合，<code class="docutils literal notranslate"><span class="pre">dropna</span></code>メソッドの引数<code class="docutils literal notranslate"><span class="pre">how</span></code>に<code class="docutils literal notranslate"><span class="pre">any</span></code>を指定する．
以下は，データフレーム<code class="docutils literal notranslate"><span class="pre">pokemon_df</span></code>からいずれかの列項目が空の値になっているレコードを全て除去した上で，新たなデータフレームを返すコード例である．</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pokemon_df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;any&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ID</th>
      <th>Name</th>
      <th>Form</th>
      <th>Type1</th>
      <th>Type2</th>
      <th>Total</th>
      <th>HP</th>
      <th>Attack</th>
      <th>Defense</th>
      <th>Sp. Atk</th>
      <th>Sp. Def</th>
      <th>Speed</th>
      <th>Generation</th>
      <th>Special_Total</th>
      <th>Base_Total</th>
      <th>speed_class</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>420</th>
      <td>413</td>
      <td>Wormadam</td>
      <td>Plant Cloak</td>
      <td>Bug</td>
      <td>Grass</td>
      <td>424</td>
      <td>60</td>
      <td>59</td>
      <td>85</td>
      <td>79</td>
      <td>105</td>
      <td>36</td>
      <td>4</td>
      <td>184</td>
      <td>144</td>
      <td>slow</td>
    </tr>
    <tr>
      <th>421</th>
      <td>413</td>
      <td>Wormadam</td>
      <td>Sandy Cloak</td>
      <td>Bug</td>
      <td>Ground</td>
      <td>424</td>
      <td>60</td>
      <td>79</td>
      <td>105</td>
      <td>59</td>
      <td>85</td>
      <td>36</td>
      <td>4</td>
      <td>144</td>
      <td>184</td>
      <td>slow</td>
    </tr>
    <tr>
      <th>422</th>
      <td>413</td>
      <td>Wormadam</td>
      <td>Trash Cloak</td>
      <td>Bug</td>
      <td>Steel</td>
      <td>424</td>
      <td>60</td>
      <td>69</td>
      <td>95</td>
      <td>69</td>
      <td>95</td>
      <td>36</td>
      <td>4</td>
      <td>164</td>
      <td>164</td>
      <td>slow</td>
    </tr>
    <tr>
      <th>489</th>
      <td>479</td>
      <td>Rotom</td>
      <td>Heat Rotom</td>
      <td>Electric</td>
      <td>Fire</td>
      <td>520</td>
      <td>50</td>
      <td>65</td>
      <td>107</td>
      <td>105</td>
      <td>107</td>
      <td>86</td>
      <td>4</td>
      <td>212</td>
      <td>172</td>
      <td>fast</td>
    </tr>
    <tr>
      <th>490</th>
      <td>479</td>
      <td>Rotom</td>
      <td>Wash Rotom</td>
      <td>Electric</td>
      <td>Water</td>
      <td>520</td>
      <td>50</td>
      <td>65</td>
      <td>107</td>
      <td>105</td>
      <td>107</td>
      <td>86</td>
      <td>4</td>
      <td>212</td>
      <td>172</td>
      <td>fast</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>1159</th>
      <td>978</td>
      <td>Tatsugiri</td>
      <td>Droopy Form</td>
      <td>Dragon</td>
      <td>Water</td>
      <td>475</td>
      <td>68</td>
      <td>50</td>
      <td>60</td>
      <td>120</td>
      <td>95</td>
      <td>82</td>
      <td>9</td>
      <td>215</td>
      <td>110</td>
      <td>fast</td>
    </tr>
    <tr>
      <th>1160</th>
      <td>978</td>
      <td>Tatsugiri</td>
      <td>Stretchy Form</td>
      <td>Dragon</td>
      <td>Water</td>
      <td>475</td>
      <td>68</td>
      <td>50</td>
      <td>60</td>
      <td>120</td>
      <td>95</td>
      <td>82</td>
      <td>9</td>
      <td>215</td>
      <td>110</td>
      <td>fast</td>
    </tr>
    <tr>
      <th>1202</th>
      <td>1017</td>
      <td>Ogerpon</td>
      <td>Wellspring Mask</td>
      <td>Grass</td>
      <td>Water</td>
      <td>550</td>
      <td>80</td>
      <td>120</td>
      <td>84</td>
      <td>60</td>
      <td>96</td>
      <td>110</td>
      <td>9</td>
      <td>156</td>
      <td>204</td>
      <td>fast</td>
    </tr>
    <tr>
      <th>1203</th>
      <td>1017</td>
      <td>Ogerpon</td>
      <td>Hearthflame Mask</td>
      <td>Grass</td>
      <td>Fire</td>
      <td>550</td>
      <td>80</td>
      <td>120</td>
      <td>84</td>
      <td>60</td>
      <td>96</td>
      <td>110</td>
      <td>9</td>
      <td>156</td>
      <td>204</td>
      <td>fast</td>
    </tr>
    <tr>
      <th>1204</th>
      <td>1017</td>
      <td>Ogerpon</td>
      <td>Cornerstone Mask</td>
      <td>Grass</td>
      <td>Rock</td>
      <td>550</td>
      <td>80</td>
      <td>120</td>
      <td>84</td>
      <td>60</td>
      <td>96</td>
      <td>110</td>
      <td>9</td>
      <td>156</td>
      <td>204</td>
      <td>fast</td>
    </tr>
  </tbody>
</table>
<p>162 rows × 16 columns</p>
</div></div></div>
</div>
</section>
<section id="id37">
<h4><span class="section-number">16.7.9.2. </span>指定した列項目に欠損値を含む場合<a class="headerlink" href="#id37" title="Link to this heading">#</a></h4>
<p>指定した列項目にのみ空値があるレコードを除外する場合には，<code class="docutils literal notranslate"><span class="pre">dropna</span></code>メソッドの<code class="docutils literal notranslate"><span class="pre">subset</span></code>引数に対象列名を指定する．
以下は，データフレーム<code class="docutils literal notranslate"><span class="pre">pokemon_df</span></code>から<code class="docutils literal notranslate"><span class="pre">Type2</span></code>の項目に空値を含むレコードを除外し，新たなデータフレームを返すコード例である．</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pokemon_df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="s1">&#39;Type2&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ID</th>
      <th>Name</th>
      <th>Form</th>
      <th>Type1</th>
      <th>Type2</th>
      <th>Total</th>
      <th>HP</th>
      <th>Attack</th>
      <th>Defense</th>
      <th>Sp. Atk</th>
      <th>Sp. Def</th>
      <th>Speed</th>
      <th>Generation</th>
      <th>Special_Total</th>
      <th>Base_Total</th>
      <th>speed_class</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>Bulbasaur</td>
      <td>NaN</td>
      <td>Grass</td>
      <td>Poison</td>
      <td>318</td>
      <td>45</td>
      <td>49</td>
      <td>49</td>
      <td>65</td>
      <td>65</td>
      <td>45</td>
      <td>1</td>
      <td>130</td>
      <td>98</td>
      <td>slow</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>Ivysaur</td>
      <td>NaN</td>
      <td>Grass</td>
      <td>Poison</td>
      <td>405</td>
      <td>60</td>
      <td>62</td>
      <td>63</td>
      <td>80</td>
      <td>80</td>
      <td>60</td>
      <td>1</td>
      <td>160</td>
      <td>125</td>
      <td>slow</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>Venusaur</td>
      <td>NaN</td>
      <td>Grass</td>
      <td>Poison</td>
      <td>525</td>
      <td>80</td>
      <td>82</td>
      <td>83</td>
      <td>100</td>
      <td>100</td>
      <td>80</td>
      <td>1</td>
      <td>200</td>
      <td>165</td>
      <td>fast</td>
    </tr>
    <tr>
      <th>5</th>
      <td>6</td>
      <td>Charizard</td>
      <td>NaN</td>
      <td>Fire</td>
      <td>Flying</td>
      <td>534</td>
      <td>78</td>
      <td>84</td>
      <td>78</td>
      <td>109</td>
      <td>85</td>
      <td>100</td>
      <td>1</td>
      <td>194</td>
      <td>162</td>
      <td>fast</td>
    </tr>
    <tr>
      <th>11</th>
      <td>12</td>
      <td>Butterfree</td>
      <td>NaN</td>
      <td>Bug</td>
      <td>Flying</td>
      <td>395</td>
      <td>60</td>
      <td>45</td>
      <td>50</td>
      <td>90</td>
      <td>80</td>
      <td>70</td>
      <td>1</td>
      <td>170</td>
      <td>95</td>
      <td>slow</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>1207</th>
      <td>1020</td>
      <td>Gouging Fire</td>
      <td>NaN</td>
      <td>Fire</td>
      <td>Dragon</td>
      <td>590</td>
      <td>105</td>
      <td>115</td>
      <td>121</td>
      <td>65</td>
      <td>93</td>
      <td>91</td>
      <td>9</td>
      <td>158</td>
      <td>236</td>
      <td>fast</td>
    </tr>
    <tr>
      <th>1208</th>
      <td>1021</td>
      <td>Raging Bolt</td>
      <td>NaN</td>
      <td>Electric</td>
      <td>Dragon</td>
      <td>590</td>
      <td>125</td>
      <td>73</td>
      <td>91</td>
      <td>137</td>
      <td>89</td>
      <td>75</td>
      <td>9</td>
      <td>226</td>
      <td>164</td>
      <td>fast</td>
    </tr>
    <tr>
      <th>1209</th>
      <td>1022</td>
      <td>Iron Boulder</td>
      <td>NaN</td>
      <td>Rock</td>
      <td>Psychic</td>
      <td>590</td>
      <td>90</td>
      <td>120</td>
      <td>80</td>
      <td>68</td>
      <td>108</td>
      <td>124</td>
      <td>9</td>
      <td>176</td>
      <td>200</td>
      <td>fast</td>
    </tr>
    <tr>
      <th>1210</th>
      <td>1023</td>
      <td>Iron Crown</td>
      <td>NaN</td>
      <td>Steel</td>
      <td>Psychic</td>
      <td>590</td>
      <td>90</td>
      <td>72</td>
      <td>100</td>
      <td>122</td>
      <td>108</td>
      <td>98</td>
      <td>9</td>
      <td>230</td>
      <td>172</td>
      <td>fast</td>
    </tr>
    <tr>
      <th>1214</th>
      <td>1025</td>
      <td>Pecharunt</td>
      <td>NaN</td>
      <td>Poison</td>
      <td>Ghost</td>
      <td>600</td>
      <td>88</td>
      <td>88</td>
      <td>160</td>
      <td>88</td>
      <td>88</td>
      <td>88</td>
      <td>9</td>
      <td>176</td>
      <td>248</td>
      <td>fast</td>
    </tr>
  </tbody>
</table>
<p>669 rows × 16 columns</p>
</div></div></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">subset</span></code>引数では，対象列をリスト形式で複数指定することが可能である．
以下は，データフレーム<code class="docutils literal notranslate"><span class="pre">pokemon_df</span></code>から<code class="docutils literal notranslate"><span class="pre">Type2</span></code>と<code class="docutils literal notranslate"><span class="pre">Form</span></code>の項目の「両方」に空値を含むレコードを除外し，新たなデータフレームを返すコード例である．</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># howに&#39;any&#39;を指定すると，Type2とForm項目の「いずれか」に欠損値があるレコードを除外する</span>
<span class="n">pokemon_df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Type2&#39;</span><span class="p">,</span> <span class="s1">&#39;Form&#39;</span><span class="p">],</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ID</th>
      <th>Name</th>
      <th>Form</th>
      <th>Type1</th>
      <th>Type2</th>
      <th>Total</th>
      <th>HP</th>
      <th>Attack</th>
      <th>Defense</th>
      <th>Sp. Atk</th>
      <th>Sp. Def</th>
      <th>Speed</th>
      <th>Generation</th>
      <th>Special_Total</th>
      <th>Base_Total</th>
      <th>speed_class</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>Bulbasaur</td>
      <td>NaN</td>
      <td>Grass</td>
      <td>Poison</td>
      <td>318</td>
      <td>45</td>
      <td>49</td>
      <td>49</td>
      <td>65</td>
      <td>65</td>
      <td>45</td>
      <td>1</td>
      <td>130</td>
      <td>98</td>
      <td>slow</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>Ivysaur</td>
      <td>NaN</td>
      <td>Grass</td>
      <td>Poison</td>
      <td>405</td>
      <td>60</td>
      <td>62</td>
      <td>63</td>
      <td>80</td>
      <td>80</td>
      <td>60</td>
      <td>1</td>
      <td>160</td>
      <td>125</td>
      <td>slow</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>Venusaur</td>
      <td>NaN</td>
      <td>Grass</td>
      <td>Poison</td>
      <td>525</td>
      <td>80</td>
      <td>82</td>
      <td>83</td>
      <td>100</td>
      <td>100</td>
      <td>80</td>
      <td>1</td>
      <td>200</td>
      <td>165</td>
      <td>fast</td>
    </tr>
    <tr>
      <th>5</th>
      <td>6</td>
      <td>Charizard</td>
      <td>NaN</td>
      <td>Fire</td>
      <td>Flying</td>
      <td>534</td>
      <td>78</td>
      <td>84</td>
      <td>78</td>
      <td>109</td>
      <td>85</td>
      <td>100</td>
      <td>1</td>
      <td>194</td>
      <td>162</td>
      <td>fast</td>
    </tr>
    <tr>
      <th>11</th>
      <td>12</td>
      <td>Butterfree</td>
      <td>NaN</td>
      <td>Bug</td>
      <td>Flying</td>
      <td>395</td>
      <td>60</td>
      <td>45</td>
      <td>50</td>
      <td>90</td>
      <td>80</td>
      <td>70</td>
      <td>1</td>
      <td>170</td>
      <td>95</td>
      <td>slow</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>1210</th>
      <td>1023</td>
      <td>Iron Crown</td>
      <td>NaN</td>
      <td>Steel</td>
      <td>Psychic</td>
      <td>590</td>
      <td>90</td>
      <td>72</td>
      <td>100</td>
      <td>122</td>
      <td>108</td>
      <td>98</td>
      <td>9</td>
      <td>230</td>
      <td>172</td>
      <td>fast</td>
    </tr>
    <tr>
      <th>1211</th>
      <td>1024</td>
      <td>Terapagos</td>
      <td>Normal Form</td>
      <td>Normal</td>
      <td>NaN</td>
      <td>450</td>
      <td>90</td>
      <td>65</td>
      <td>85</td>
      <td>65</td>
      <td>85</td>
      <td>60</td>
      <td>9</td>
      <td>150</td>
      <td>150</td>
      <td>slow</td>
    </tr>
    <tr>
      <th>1212</th>
      <td>1024</td>
      <td>Terapagos</td>
      <td>Terastal Form</td>
      <td>Normal</td>
      <td>NaN</td>
      <td>600</td>
      <td>95</td>
      <td>95</td>
      <td>110</td>
      <td>105</td>
      <td>110</td>
      <td>85</td>
      <td>9</td>
      <td>215</td>
      <td>205</td>
      <td>fast</td>
    </tr>
    <tr>
      <th>1213</th>
      <td>1024</td>
      <td>Terapagos</td>
      <td>Stellar Form</td>
      <td>Normal</td>
      <td>NaN</td>
      <td>700</td>
      <td>160</td>
      <td>105</td>
      <td>110</td>
      <td>130</td>
      <td>110</td>
      <td>85</td>
      <td>9</td>
      <td>240</td>
      <td>215</td>
      <td>fast</td>
    </tr>
    <tr>
      <th>1214</th>
      <td>1025</td>
      <td>Pecharunt</td>
      <td>NaN</td>
      <td>Poison</td>
      <td>Ghost</td>
      <td>600</td>
      <td>88</td>
      <td>88</td>
      <td>160</td>
      <td>88</td>
      <td>88</td>
      <td>88</td>
      <td>9</td>
      <td>176</td>
      <td>248</td>
      <td>fast</td>
    </tr>
  </tbody>
</table>
<p>737 rows × 16 columns</p>
</div></div></div>
</div>
</section>
</section>
<section id="by-iqr">
<h3><span class="section-number">16.7.10. </span>外れ値の除去 by IQR<a class="headerlink" href="#by-iqr" title="Link to this heading">#</a></h3>
<p>外れ値の検出には様々な手法が提案されているが，<strong><a class="reference external" href="https://en.wikipedia.org/wiki/Interquartile_range">四分位範囲（IQR; interquartile range)</a></strong> を用いた方法は堅牢な手法として知られている．
pandasでIQRを用いて外れ値を検出・除外するには，</p>
<ol class="arabic simple">
<li><p>Q1（第1四分位数），Q3（第3四分位数），IQRの計算</p></li>
<li><p>IQRを考慮した外れ値の判定</p></li>
<li><p>外れ値の除去</p></li>
</ol>
<p>の流れで処理を行う．</p>
<p>以下は，データフレーム<code class="docutils literal notranslate"><span class="pre">pokemon_df</span></code>のレコードについて，<code class="docutils literal notranslate"><span class="pre">Total</span></code>列の値に着目してIQRを用いた外れ値の除去をするコード例である．</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># quantileメソッドを使って，Q1とQ3を計算</span>
<span class="n">Q1</span> <span class="o">=</span> <span class="n">pokemon_df</span><span class="p">[</span><span class="s1">&#39;Total&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="mf">0.25</span><span class="p">)</span>
<span class="n">Q3</span> <span class="o">=</span> <span class="n">pokemon_df</span><span class="p">[</span><span class="s1">&#39;Total&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="mf">0.75</span><span class="p">)</span>
<span class="n">IQR</span> <span class="o">=</span> <span class="n">Q3</span> <span class="o">-</span> <span class="n">Q1</span>

<span class="c1"># 外れ値の判定．Q1 − 1.5 IQRよりも小さい，あるいは Q3 + 1.5 IQRよりも大きい値が外れ値</span>
<span class="n">is_outlier</span> <span class="o">=</span> <span class="p">(</span><span class="n">pokemon_df</span><span class="o">.</span><span class="n">Total</span> <span class="o">&gt;=</span> <span class="n">Q1</span> <span class="o">-</span> <span class="mf">1.5</span> <span class="o">*</span> <span class="n">IQR</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">pokemon_df</span><span class="o">.</span><span class="n">Total</span> <span class="o">&lt;=</span> <span class="n">Q3</span> <span class="o">+</span> <span class="mf">1.5</span> <span class="o">*</span> <span class="n">IQR</span><span class="p">)</span>

<span class="c1"># 外れ値を除外せず，外れ値か否かをデータフレームに記録しておきたい場合は</span>
<span class="c1"># pokemon_df[&#39;is_outlier&#39;] = is_outlier</span>

<span class="c1"># 外れ値を除いたデータフレーム</span>
<span class="n">pokemon_df</span><span class="p">[</span><span class="n">is_outlier</span><span class="p">]</span>

<span class="c1"># queryメソッドを使うと，外れ値の除去するためのコードは以下のように書ける</span>
<span class="c1">#pokemon_df.query(&#39;@Q1 - 1.5 * @IQR &lt;= Total &lt;= @Q3 + 1.5 * @IQR&#39;)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ID</th>
      <th>Name</th>
      <th>Form</th>
      <th>Type1</th>
      <th>Type2</th>
      <th>Total</th>
      <th>HP</th>
      <th>Attack</th>
      <th>Defense</th>
      <th>Sp. Atk</th>
      <th>Sp. Def</th>
      <th>Speed</th>
      <th>Generation</th>
      <th>Special_Total</th>
      <th>Base_Total</th>
      <th>speed_class</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>Bulbasaur</td>
      <td>NaN</td>
      <td>Grass</td>
      <td>Poison</td>
      <td>318</td>
      <td>45</td>
      <td>49</td>
      <td>49</td>
      <td>65</td>
      <td>65</td>
      <td>45</td>
      <td>1</td>
      <td>130</td>
      <td>98</td>
      <td>slow</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>Ivysaur</td>
      <td>NaN</td>
      <td>Grass</td>
      <td>Poison</td>
      <td>405</td>
      <td>60</td>
      <td>62</td>
      <td>63</td>
      <td>80</td>
      <td>80</td>
      <td>60</td>
      <td>1</td>
      <td>160</td>
      <td>125</td>
      <td>slow</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>Venusaur</td>
      <td>NaN</td>
      <td>Grass</td>
      <td>Poison</td>
      <td>525</td>
      <td>80</td>
      <td>82</td>
      <td>83</td>
      <td>100</td>
      <td>100</td>
      <td>80</td>
      <td>1</td>
      <td>200</td>
      <td>165</td>
      <td>fast</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>Charmander</td>
      <td>NaN</td>
      <td>Fire</td>
      <td>NaN</td>
      <td>309</td>
      <td>39</td>
      <td>52</td>
      <td>43</td>
      <td>60</td>
      <td>50</td>
      <td>65</td>
      <td>1</td>
      <td>110</td>
      <td>95</td>
      <td>slow</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>Charmeleon</td>
      <td>NaN</td>
      <td>Fire</td>
      <td>NaN</td>
      <td>405</td>
      <td>58</td>
      <td>64</td>
      <td>58</td>
      <td>80</td>
      <td>65</td>
      <td>80</td>
      <td>1</td>
      <td>145</td>
      <td>122</td>
      <td>fast</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>1210</th>
      <td>1023</td>
      <td>Iron Crown</td>
      <td>NaN</td>
      <td>Steel</td>
      <td>Psychic</td>
      <td>590</td>
      <td>90</td>
      <td>72</td>
      <td>100</td>
      <td>122</td>
      <td>108</td>
      <td>98</td>
      <td>9</td>
      <td>230</td>
      <td>172</td>
      <td>fast</td>
    </tr>
    <tr>
      <th>1211</th>
      <td>1024</td>
      <td>Terapagos</td>
      <td>Normal Form</td>
      <td>Normal</td>
      <td>NaN</td>
      <td>450</td>
      <td>90</td>
      <td>65</td>
      <td>85</td>
      <td>65</td>
      <td>85</td>
      <td>60</td>
      <td>9</td>
      <td>150</td>
      <td>150</td>
      <td>slow</td>
    </tr>
    <tr>
      <th>1212</th>
      <td>1024</td>
      <td>Terapagos</td>
      <td>Terastal Form</td>
      <td>Normal</td>
      <td>NaN</td>
      <td>600</td>
      <td>95</td>
      <td>95</td>
      <td>110</td>
      <td>105</td>
      <td>110</td>
      <td>85</td>
      <td>9</td>
      <td>215</td>
      <td>205</td>
      <td>fast</td>
    </tr>
    <tr>
      <th>1213</th>
      <td>1024</td>
      <td>Terapagos</td>
      <td>Stellar Form</td>
      <td>Normal</td>
      <td>NaN</td>
      <td>700</td>
      <td>160</td>
      <td>105</td>
      <td>110</td>
      <td>130</td>
      <td>110</td>
      <td>85</td>
      <td>9</td>
      <td>240</td>
      <td>215</td>
      <td>fast</td>
    </tr>
    <tr>
      <th>1214</th>
      <td>1025</td>
      <td>Pecharunt</td>
      <td>NaN</td>
      <td>Poison</td>
      <td>Ghost</td>
      <td>600</td>
      <td>88</td>
      <td>88</td>
      <td>160</td>
      <td>88</td>
      <td>88</td>
      <td>88</td>
      <td>9</td>
      <td>176</td>
      <td>248</td>
      <td>fast</td>
    </tr>
  </tbody>
</table>
<p>1214 rows × 16 columns</p>
</div></div></div>
</div>
</section>
<section id="id38">
<h3><span class="section-number">16.7.11. </span>ソート<a class="headerlink" href="#id38" title="Link to this heading">#</a></h3>
<p>ある列項目の値の大きさでデータフレーム中のレコードを並び替えるには，DataFrameオブジェクトの<code class="docutils literal notranslate"><span class="pre">sort_values</span></code>メソッドを用いる．
<code class="docutils literal notranslate"><span class="pre">sort_values</span></code>メソッドの第1引数にソート基準となる列項目名を指定する．
また，<code class="docutils literal notranslate"><span class="pre">ascending</span></code>引数に<code class="docutils literal notranslate"><span class="pre">True</span></code>を指定すると昇順に，<code class="docutils literal notranslate"><span class="pre">False</span></code>を指定する降順にソートされる（デフォルト値は<code class="docutils literal notranslate"><span class="pre">True</span></code>）．</p>
<p>以下は，データフレーム<code class="docutils literal notranslate"><span class="pre">pokemon_df</span></code>中のレコードを<code class="docutils literal notranslate"><span class="pre">Total</span></code>の大きい順（降順）で並べるコード例である．</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pokemon_df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;Total&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ID</th>
      <th>Name</th>
      <th>Form</th>
      <th>Type1</th>
      <th>Type2</th>
      <th>Total</th>
      <th>HP</th>
      <th>Attack</th>
      <th>Defense</th>
      <th>Sp. Atk</th>
      <th>Sp. Def</th>
      <th>Speed</th>
      <th>Generation</th>
      <th>Special_Total</th>
      <th>Base_Total</th>
      <th>speed_class</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1054</th>
      <td>890</td>
      <td>Eternatus</td>
      <td>Eternamax</td>
      <td>Poison</td>
      <td>Dragon</td>
      <td>1125</td>
      <td>255</td>
      <td>115</td>
      <td>250</td>
      <td>125</td>
      <td>250</td>
      <td>130</td>
      <td>8</td>
      <td>375</td>
      <td>365</td>
      <td>fast</td>
    </tr>
    <tr>
      <th>688</th>
      <td>150</td>
      <td>Mewtwo</td>
      <td>Mega Mewtwo X</td>
      <td>Psychic</td>
      <td>Fighting</td>
      <td>780</td>
      <td>106</td>
      <td>190</td>
      <td>100</td>
      <td>154</td>
      <td>100</td>
      <td>130</td>
      <td>6</td>
      <td>254</td>
      <td>290</td>
      <td>fast</td>
    </tr>
    <tr>
      <th>689</th>
      <td>150</td>
      <td>Mewtwo</td>
      <td>Mega Mewtwo Y</td>
      <td>Psychic</td>
      <td>NaN</td>
      <td>780</td>
      <td>106</td>
      <td>150</td>
      <td>70</td>
      <td>194</td>
      <td>120</td>
      <td>140</td>
      <td>6</td>
      <td>314</td>
      <td>220</td>
      <td>fast</td>
    </tr>
    <tr>
      <th>717</th>
      <td>384</td>
      <td>Rayquaza</td>
      <td>Mega Rayquaza</td>
      <td>Dragon</td>
      <td>Flying</td>
      <td>780</td>
      <td>105</td>
      <td>180</td>
      <td>100</td>
      <td>180</td>
      <td>100</td>
      <td>115</td>
      <td>6</td>
      <td>280</td>
      <td>280</td>
      <td>fast</td>
    </tr>
    <tr>
      <th>716</th>
      <td>383</td>
      <td>Groudon</td>
      <td>Primal Groudon</td>
      <td>Ground</td>
      <td>Fire</td>
      <td>770</td>
      <td>100</td>
      <td>180</td>
      <td>160</td>
      <td>150</td>
      <td>90</td>
      <td>90</td>
      <td>6</td>
      <td>240</td>
      <td>340</td>
      <td>fast</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>297</th>
      <td>298</td>
      <td>Azurill</td>
      <td>NaN</td>
      <td>Normal</td>
      <td>Fairy</td>
      <td>190</td>
      <td>50</td>
      <td>20</td>
      <td>40</td>
      <td>20</td>
      <td>40</td>
      <td>20</td>
      <td>3</td>
      <td>60</td>
      <td>60</td>
      <td>slow</td>
    </tr>
    <tr>
      <th>1030</th>
      <td>872</td>
      <td>Snom</td>
      <td>NaN</td>
      <td>Ice</td>
      <td>Bug</td>
      <td>185</td>
      <td>30</td>
      <td>25</td>
      <td>35</td>
      <td>45</td>
      <td>30</td>
      <td>20</td>
      <td>8</td>
      <td>75</td>
      <td>60</td>
      <td>slow</td>
    </tr>
    <tr>
      <th>190</th>
      <td>191</td>
      <td>Sunkern</td>
      <td>NaN</td>
      <td>Grass</td>
      <td>NaN</td>
      <td>180</td>
      <td>30</td>
      <td>30</td>
      <td>30</td>
      <td>30</td>
      <td>30</td>
      <td>30</td>
      <td>2</td>
      <td>60</td>
      <td>60</td>
      <td>slow</td>
    </tr>
    <tr>
      <th>981</th>
      <td>824</td>
      <td>Blipbug</td>
      <td>NaN</td>
      <td>Bug</td>
      <td>NaN</td>
      <td>180</td>
      <td>25</td>
      <td>20</td>
      <td>20</td>
      <td>25</td>
      <td>45</td>
      <td>45</td>
      <td>8</td>
      <td>70</td>
      <td>40</td>
      <td>slow</td>
    </tr>
    <tr>
      <th>859</th>
      <td>746</td>
      <td>Wishiwashi</td>
      <td>Solo Form</td>
      <td>Water</td>
      <td>NaN</td>
      <td>175</td>
      <td>45</td>
      <td>20</td>
      <td>20</td>
      <td>25</td>
      <td>25</td>
      <td>40</td>
      <td>7</td>
      <td>50</td>
      <td>40</td>
      <td>slow</td>
    </tr>
  </tbody>
</table>
<p>1215 rows × 16 columns</p>
</div></div></div>
</div>
</section>
<section id="id39">
<h3><span class="section-number">16.7.12. </span>順位付け<a class="headerlink" href="#id39" title="Link to this heading">#</a></h3>
<p>ある列項目の値でレコードを順位付けをしたいケースには，<code class="docutils literal notranslate"><span class="pre">rank</span></code>メソッドを用いる．
<code class="docutils literal notranslate"><span class="pre">sort_values</span></code>メソッドと同様に，<code class="docutils literal notranslate"><span class="pre">rank</span></code>メソッドは<code class="docutils literal notranslate"><span class="pre">ascending</span></code>引数を持つ．
<code class="docutils literal notranslate"><span class="pre">ascending</span></code>引数に<code class="docutils literal notranslate"><span class="pre">True</span></code>を指定すると昇順に，<code class="docutils literal notranslate"><span class="pre">False</span></code>を指定する降順にソートし順位付けを行う（デフォルト値は<code class="docutils literal notranslate"><span class="pre">True</span></code>）．</p>
<p>以下は，データフレーム<code class="docutils literal notranslate"><span class="pre">pokemon_df</span></code>中の<code class="docutils literal notranslate"><span class="pre">Total</span></code>フィールドの値が大きい順にソートし，各レコードの順位を返すコード例である．</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pokemon_df</span><span class="p">[</span><span class="s1">&#39;Total&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">rank</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0       962.0
1       782.5
2       292.0
3       998.5
4       782.5
        ...  
1210    127.0
1211    661.0
1212     95.5
1213     15.5
1214     95.5
Name: Total, Length: 1215, dtype: float64
</pre></div>
</div>
</div>
</div>
<p>同順位のレコードが複数ある場合の順位付け方法は<code class="docutils literal notranslate"><span class="pre">rank</span></code>メソッドの<code class="docutils literal notranslate"><span class="pre">method</span></code>引数で指定する．
<code class="docutils literal notranslate"><span class="pre">method</span></code>引数で指定できる主なオプションは以下の通り（デフォルトは<code class="docutils literal notranslate"><span class="pre">average</span></code>）．</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">min</span></code>: 順位の最小値を返す（例: 1位，2位，2位，4位）</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">max</span></code>: 順位の最大値を返す（例: 1位，3位，3位，4位）</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">average</span></code>: 平均の順位を返す（例: 1位，2.5位，2.5位，4位）</p></li>
</ul>
<p>以下は，データフレーム<code class="docutils literal notranslate"><span class="pre">pokemon_df</span></code>中の<code class="docutils literal notranslate"><span class="pre">Total</span></code>フィールドの値の降順で順位付け（同順位は順位の最小値で順位付け）するコード例である．</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pokemon_df</span><span class="p">[</span><span class="s1">&#39;Total&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">rank</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;min&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0       961.0
1       770.0
2       282.0
3       997.0
4       770.0
        ...  
1210    122.0
1211    656.0
1212     71.0
1213     10.0
1214     71.0
Name: Total, Length: 1215, dtype: float64
</pre></div>
</div>
</div>
</div>
<p>順位の値をデータフレームに記憶したい場合は，以下のように新しい列を作って順位付けの結果を代入すればよい．</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pokemon_df</span><span class="p">[</span><span class="s1">&#39;total_rank&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pokemon_df</span><span class="p">[</span><span class="s1">&#39;Total&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">rank</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;min&#39;</span><span class="p">)</span>

<span class="c1"># assignメソッドを使って，以下のようにも書ける</span>
<span class="c1">#pokemon_df.assign(</span>
<span class="c1">#    attack_rank = lambda df: df[&#39;Total&#39;].rank(ascending=False, method=&#39;min&#39;)</span>
<span class="c1">#)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="id40">
<h3><span class="section-number">16.7.13. </span>ビン分割<a class="headerlink" href="#id40" title="Link to this heading">#</a></h3>
<p>ある項目の値に応じてデータフレーム中のレコードをいくつかのグループに分ける処理は<strong>ビン分割（binning）</strong> と呼ばれる．
pandasでビン分割を行うには<code class="docutils literal notranslate"><span class="pre">cut</span></code>関数を用いる．
<code class="docutils literal notranslate"><span class="pre">cut</span></code>関数の第1引数にはデータフレームの列データ（射影），<code class="docutils literal notranslate"><span class="pre">bins</span></code>引数には分割後のグループ数を指定する．
<code class="docutils literal notranslate"><span class="pre">cut</span></code>関数は指定列の最小値と最大値の区間を<code class="docutils literal notranslate"><span class="pre">bins</span></code>で指定されたグループ数で均等分割し，各列の値が分割されたどの区間の含まれるかを返す．</p>
<p>以下は，データフレーム<code class="docutils literal notranslate"><span class="pre">pokemon_df</span></code>の<code class="docutils literal notranslate"><span class="pre">Total</span></code>値を4つの区間に均等分割し，各レコードの<code class="docutils literal notranslate"><span class="pre">Total</span></code>値がどの区間に含まれるかを返すコード例である．</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">pokemon_df</span><span class="o">.</span><span class="n">Total</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0       (174.05, 412.5]
1       (174.05, 412.5]
2        (412.5, 650.0]
3       (174.05, 412.5]
4       (174.05, 412.5]
             ...       
1210     (412.5, 650.0]
1211     (412.5, 650.0]
1212     (412.5, 650.0]
1213     (650.0, 887.5]
1214     (412.5, 650.0]
Name: Total, Length: 1215, dtype: category
Categories (4, interval[float64, right]): [(174.05, 412.5] &lt; (412.5, 650.0] &lt; (650.0, 887.5] &lt; (887.5, 1125.0]]
</pre></div>
</div>
</div>
</div>
<p>分割区間に名前を付けるには<code class="docutils literal notranslate"><span class="pre">labels</span></code>引数を使う．
<code class="docutils literal notranslate"><span class="pre">labels</span></code>にリストを与えると，<code class="docutils literal notranslate"><span class="pre">cut</span></code>関数は<code class="docutils literal notranslate"><span class="pre">labels</span></code>で指定されたラベルを使って結果を返す．</p>
<p>以下は上で用いたデータフレーム<code class="docutils literal notranslate"><span class="pre">pokemon_df</span></code>のビン分割において，各ビンにA，B，C，Dの名前を付けるコード例である．</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(174.05 &lt; Total \leq 412.5\)</span>ならD</p></li>
<li><p><span class="math notranslate nohighlight">\(412.5 &lt; Total \leq 650\)</span>ならC</p></li>
<li><p><span class="math notranslate nohighlight">\(650.0 &lt; Total \leq 887.5\)</span>ならB</p></li>
<li><p><span class="math notranslate nohighlight">\(887.5 &lt; Total \leq 1125\)</span>ならA</p></li>
</ul>
<p>とラベルが振られる．</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">pokemon_df</span><span class="o">.</span><span class="n">Total</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;A&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0       D
1       D
2       C
3       D
4       D
       ..
1210    C
1211    C
1212    C
1213    B
1214    C
Name: Total, Length: 1215, dtype: category
Categories (4, object): [&#39;D&#39; &lt; &#39;C&#39; &lt; &#39;B&#39; &lt; &#39;A&#39;]
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">cut</span></code>関数の<code class="docutils literal notranslate"><span class="pre">bins</span></code>引数に数値のリストを与えると，分割区間の境界を明示的に与えることができる．
例えば，<code class="docutils literal notranslate"><span class="pre">bins</span></code>引数に数値リスト<code class="docutils literal notranslate"><span class="pre">[a,</span> <span class="pre">b,</span> <span class="pre">c]</span></code>を与えると，データを</p>
<ul class="simple">
<li><p>aより大きくb以下</p></li>
<li><p>bより大きくc以下
の区間で分割する．</p></li>
</ul>
<p>以下は，データフレーム<code class="docutils literal notranslate"><span class="pre">pokemon_df</span></code>の<code class="docutils literal notranslate"><span class="pre">Total</span></code>の値を</p>
<ul class="simple">
<li><p>第1四分位数（25%）以下</p></li>
<li><p>第1四分位数より大きく第2四分位数以下（50%）</p></li>
<li><p>第2四分位数より大きく第3四分位数以下（75%）</p></li>
<li><p>第3四分位数より大きく最大値以下</p></li>
</ul>
<p>で分割するコード例である．</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bins</span><span class="o">=</span><span class="p">[</span>
    <span class="c1"># パーセンタイルの計算にはquantileメソッドを用いる</span>
    <span class="n">pokemon_df</span><span class="o">.</span><span class="n">Total</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
    <span class="n">pokemon_df</span><span class="o">.</span><span class="n">Total</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="mf">0.25</span><span class="p">),</span>
    <span class="n">pokemon_df</span><span class="o">.</span><span class="n">Total</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="mf">0.50</span><span class="p">),</span>
    <span class="n">pokemon_df</span><span class="o">.</span><span class="n">Total</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="mf">0.75</span><span class="p">),</span>
    <span class="n">pokemon_df</span><span class="o">.</span><span class="n">Total</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
<span class="p">]</span>

<span class="c1"># ビン分割結果を`total_class`列に格納</span>
<span class="c1"># include_lowest引数をTrueにすると一番はじめの区間の左端の値を含むようにする（これがFalseだと最小値がどのビンにも含まれなくなる）</span>
<span class="n">pokemon_df</span><span class="p">[</span><span class="s1">&#39;total_class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">pokemon_df</span><span class="o">.</span><span class="n">Total</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;A&#39;</span><span class="p">],</span> <span class="n">include_lowest</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="numpy">
<h3><span class="section-number">16.7.14. </span>NumPy行列の取得<a class="headerlink" href="#numpy" title="Link to this heading">#</a></h3>
<p>DataFrameオブジェクトからNumPy形式の（数値）行列を取り出すには，DataFrameオブジェクトの<code class="docutils literal notranslate"><span class="pre">values</span></code>メソッドを用いる．
以下は，データフレーム<code class="docutils literal notranslate"><span class="pre">pokemon_df</span></code>からポケモンの戦闘力値情報（<code class="docutils literal notranslate"><span class="pre">HP</span></code>，<code class="docutils literal notranslate"><span class="pre">Attack</span></code>，<code class="docutils literal notranslate"><span class="pre">Defense</span></code>，<code class="docutils literal notranslate"><span class="pre">Sp.</span> <span class="pre">Atk</span></code>，<code class="docutils literal notranslate"><span class="pre">Sp.</span> <span class="pre">Def</span></code>，<code class="docutils literal notranslate"><span class="pre">Speed</span></code>）を抜き出して，NumPy行列（ndarray）に変換するコード例である．</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">target_columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;HP&#39;</span><span class="p">,</span> <span class="s1">&#39;Attack&#39;</span><span class="p">,</span> <span class="s1">&#39;Defense&#39;</span><span class="p">,</span> <span class="s1">&#39;Sp. Atk&#39;</span><span class="p">,</span> <span class="s1">&#39;Sp. Def&#39;</span><span class="p">,</span> <span class="s1">&#39;Speed&#39;</span><span class="p">]</span>
<span class="n">pokemon_df</span><span class="p">[</span><span class="n">target_columns</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[ 45,  49,  49,  65,  65,  45],
       [ 60,  62,  63,  80,  80,  60],
       [ 80,  82,  83, 100, 100,  80],
       ...,
       [ 95,  95, 110, 105, 110,  85],
       [160, 105, 110, 130, 110,  85],
       [ 88,  88, 160,  88,  88,  88]])
</pre></div>
</div>
</div>
</div>
</section>
<section id="id41">
<h3><span class="section-number">16.7.15. </span>正規化・標準化<a class="headerlink" href="#id41" title="Link to this heading">#</a></h3>
<p>データ集合中の各データを</p>
<ul class="simple">
<li><p>最大値が1，最小値が0になるように変換する<strong>正規化（normalization）</strong></p></li>
<li><p>平均値が0，分散が1になるように変換する<strong>標準化（standardization）</strong></p></li>
</ul>
<p>するためのPythonライブラリは色々ある．</p>
<p>pandasライブラリだけで完結させるには，愚直に正規化，標準化後の値を計算すればよい．
データ集合<span class="math notranslate nohighlight">\(X\)</span>の最大値を<span class="math notranslate nohighlight">\(X_{max}\)</span>，最小値を<span class="math notranslate nohighlight">\(X_{min}\)</span>，平均を<span class="math notranslate nohighlight">\(\mu_{X}\)</span>，標準偏差を<span class="math notranslate nohighlight">\(\sigma_{X}\)</span>とすると，データ<span class="math notranslate nohighlight">\(x \in X\)</span>の正規化後の値は</p>
<div class="math notranslate nohighlight">
\[
 \frac{x - X_{min}}{X_{max}-X_{min}}
\]</div>
<p>となる．また，データ<span class="math notranslate nohighlight">\(x \in X\)</span>の標準化後の値は
$<span class="math notranslate nohighlight">\(
 \frac{x - \mu_{X}}{\sigma_{X}}
\)</span>$
となる．
これを踏まえると，例えば，データフレーム<code class="docutils literal notranslate"><span class="pre">pokemon_df</span></code>の<code class="docutils literal notranslate"><span class="pre">Total</span></code>の値を正規化して，その値を<code class="docutils literal notranslate"><span class="pre">normalized_total</span></code>として格納するコードは以下のように書ける．</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pokemon_df</span><span class="p">[</span><span class="s1">&#39;normalized_total&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">pokemon_df</span><span class="o">.</span><span class="n">Total</span> <span class="o">-</span> <span class="n">pokemon_df</span><span class="o">.</span><span class="n">Total</span><span class="o">.</span><span class="n">min</span><span class="p">())</span> <span class="o">/</span> <span class="p">(</span><span class="n">pokemon_df</span><span class="o">.</span><span class="n">Total</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">pokemon_df</span><span class="o">.</span><span class="n">Total</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<p>また，データフレーム<code class="docutils literal notranslate"><span class="pre">pokemon_df</span></code>の<code class="docutils literal notranslate"><span class="pre">Total</span></code>の値を標準化して，その値を<code class="docutils literal notranslate"><span class="pre">standardized_total</span></code>として格納するコードは以下のように書ける．</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pokemon_df</span><span class="p">[</span><span class="s1">&#39;standardized_total&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">pokemon_df</span><span class="o">.</span><span class="n">Total</span> <span class="o">-</span> <span class="n">pokemon_df</span><span class="o">.</span><span class="n">Total</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span> <span class="o">/</span> <span class="n">pokemon_df</span><span class="o">.</span><span class="n">Total</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>代表的な方法は<a class="reference external" href="https://scikit-learn.org/stable/index.html">scikit-learn</a>ライブラリの<code class="docutils literal notranslate"><span class="pre">preprocessing</span></code>パッケージを用いれば，複数の列項目を一括で正規化・標準化することができる．
正規化には<code class="docutils literal notranslate"><span class="pre">MinMaxScaler</span></code>，標準化には<code class="docutils literal notranslate"><span class="pre">StandardScaler</span></code>クラスを用いる．
両クラスともに変換対象はNumPy行列（<code class="docutils literal notranslate"><span class="pre">numpy.ndarray</span></code>）を対象とするので，この方法を用いる場合はまず変換対象となるデータを下記のようにNumPy行列化しておく．</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># &#39;Total&#39;, &#39;HP&#39;, &#39;Attack&#39;, &#39;Defense&#39;の4項目を行列として取り出す</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">pokemon_df</span><span class="p">[[</span><span class="s1">&#39;Total&#39;</span><span class="p">,</span> <span class="s1">&#39;HP&#39;</span><span class="p">,</span> <span class="s1">&#39;Attack&#39;</span><span class="p">,</span> <span class="s1">&#39;Defense&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span>
</pre></div>
</div>
</div>
</div>
<p>scikit-learnライブラリで正規化する場合は，下記のように<code class="docutils literal notranslate"><span class="pre">MinMaxScaler</span></code>オブジェクトの<code class="docutils literal notranslate"><span class="pre">fit_transform</span></code>メソッドを用いる．</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.preprocessing</span><span class="w"> </span><span class="kn">import</span> <span class="n">MinMaxScaler</span>

<span class="n">minmax_scaler</span> <span class="o">=</span> <span class="n">MinMaxScaler</span><span class="p">()</span>
<span class="n">X_scaled</span> <span class="o">=</span> <span class="n">minmax_scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

<span class="n">X_scaled</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[0.15052632, 0.17322835, 0.23783784, 0.17959184],
       [0.24210526, 0.23228346, 0.30810811, 0.23673469],
       [0.36842105, 0.31102362, 0.41621622, 0.31836735],
       ...,
       [0.44736842, 0.37007874, 0.48648649, 0.42857143],
       [0.55263158, 0.62598425, 0.54054054, 0.42857143],
       [0.44736842, 0.34251969, 0.44864865, 0.63265306]])
</pre></div>
</div>
</div>
</div>
<p>scikit-learnライブラリで標準化する場合は，下記のように<code class="docutils literal notranslate"><span class="pre">StandardScaler</span></code>オブジェクトの<code class="docutils literal notranslate"><span class="pre">fit_transform</span></code>メソッドを用いる．</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.preprocessing</span><span class="w"> </span><span class="kn">import</span> <span class="n">StandardScaler</span>

<span class="n">standard_scaler</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span>
<span class="n">X_scaled</span> <span class="o">=</span> <span class="n">standard_scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>標準化された<code class="docutils literal notranslate"><span class="pre">X_scaled</span></code>の各列の平均，標準偏差を計算すると，どの列も平均値が0，標準偏差が1付近になっていることが分かる．</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 各列の平均値を計算</span>
<span class="n">X_scaled</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([ 1.40354121e-16,  1.52050297e-16, -9.35694138e-17, -1.87138828e-16])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 各列の標準偏差を計算</span>
<span class="n">X_scaled</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([1., 1., 1., 1.])
</pre></div>
</div>
</div>
</div>
</section>
<section id="id42">
<h3><span class="section-number">16.7.16. </span>データの分割<a class="headerlink" href="#id42" title="Link to this heading">#</a></h3>
<p>機械学習を行う際，手持ちのデータを訓練（学習）用データとテスト（評価）用データに分割することが一般的である．
pandasで読み込んだデータフレームを機械学習用にデータ分割するには，以下の手順を踏む．</p>
<ol class="arabic simple">
<li><p>データフレームから注目する説明変数（特徴量）と目的変数を取り出す</p></li>
<li><p>（必要なら）データの前処理</p></li>
<li><p>scikit-learnライブラリの<code class="docutils literal notranslate"><span class="pre">train_test_split</span></code>関数でデータを分割</p></li>
</ol>
<p>以下は，タイタニック号の乗船客情報を<code class="docutils literal notranslate"><span class="pre">titanic_df</span></code>変数に読み込み，</p>
<ul class="simple">
<li><p>沈没事故から生還したかを示す値を目的変数（<code class="docutils literal notranslate"><span class="pre">Survived</span></code>列）</p></li>
<li><p>それ以外の列情報を説明変数</p></li>
</ul>
<p>として抽出し，訓練データとテストデータの割合が70:30になるようデータを分割するコード例である．
<code class="docutils literal notranslate"><span class="pre">train_test_split</span></code>関数の<code class="docutils literal notranslate"><span class="pre">test_size</span></code>引数を0.3とすることでテストデータの割合を30%になるようにし，<code class="docutils literal notranslate"><span class="pre">shuffle</span></code>引数を<code class="docutils literal notranslate"><span class="pre">True</span></code>にすることでデータをシャッフルしている．
また，<code class="docutils literal notranslate"><span class="pre">statify</span></code>引数に目的変数である<code class="docutils literal notranslate"><span class="pre">y</span></code>を指定することで，元のデータの分布（つまり生存した乗客とそうでない乗客の割合）を維持するように訓練データとテストデータに分割するようにしている（※この処理は<a class="reference external" href="https://ja.wikipedia.org/wiki/%E5%B1%A4%E5%8C%96%E6%8A%BD%E5%87%BA%E6%B3%95">層化</a>と呼ばれる）．</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># scikit-learnライブラリのtrain_test_split関数を読み込む</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.model_selection</span><span class="w"> </span><span class="kn">import</span> <span class="n">train_test_split</span>

<span class="c1"># データの読み込み</span>
<span class="n">titanic_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="s1">&#39;https://raw.githubusercontent.com/hontolab-courses/dmml-2022/main/dataset/titanic_train.csv&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>

<span class="c1"># 説明変数と目的変数の抽出．</span>
<span class="c1"># dropメソッドは指定した列を除いたデータフレームを返す</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">titanic_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;Survived&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">titanic_df</span><span class="p">[</span><span class="s1">&#39;Survived&#39;</span><span class="p">]</span>

<span class="c1"># データ分割</span>
<span class="c1"># 訓練用に分割されたデータはX_train，y_train，テスト用に分割されたデータはX_test，y_test</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">stratify</span><span class="o">=</span><span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./content/pandas"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="../nosql/01.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title"><span class="section-number">15. </span>NoSQL</p>
      </div>
    </a>
    <a class="right-next"
       href="../misc/math.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">集合と写像</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">16.1. はじめに - 表データとデータフレーム</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">16.2. ライブラリの準備</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">16.3. データの読み込み</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#csv-tsv">16.3.1. CSV/TSVファイルを読み込む</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">16.3.2. 関係データベースへの問い合わせ結果を読み込む</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">16.4. データの確認</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id7">16.4.1. 表の行数，列数の確認</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id8">16.4.2. 表の行数</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id9">16.4.3. 表の項目情報</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id10">16.4.4. 基本統計量</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id11">16.5. データフレームへのアクセス</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id12">16.5.1. 先頭・末尾のレコード（行）の取得</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id13">16.5.2. 射影</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id14">16.5.3. データフレームに対する四則演算</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id15">16.5.4. 任意の行にあるレコードの取得</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id16">16.5.5. 絞り込み</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id17">16.5.6. 比較演算子を用いない絞り込み</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id18">16.5.6.1. いずれかの値にマッチするレコードの取得</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id19">16.5.6.2. 文字列の部分一致</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id20">16.6. データフレームの保存</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id21">16.7. 前処理</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id23">16.7.1. 列名の変更</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id24">16.7.2. データフレームの結合</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id25">16.7.2.1. 縦方向の結合</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id26">16.7.2.2. 横方向の結合</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id27">16.7.3. データの整然化：横持ちデータから縦持ちデータへ</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id28">16.7.4. 新しい列の追加</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id29">16.7.5. 関数の適用によるデータ加工</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id30">16.7.6. ダミー変数化</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id31">16.7.7. 集約演算</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id32">16.7.8. 欠損値の発見</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id33">16.7.8.1. 欠損値が存在する項目（列）を知りたい場合</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id34">16.7.8.2. 欠損値が存在するレコード（行）を知りたい場合</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id35">16.7.9. 欠損値を持つレコードの除去</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id36">16.7.9.1. いずれかの列項目に1つでも欠損値を含む場合</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id37">16.7.9.2. 指定した列項目に欠損値を含む場合</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#by-iqr">16.7.10. 外れ値の除去 by IQR</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id38">16.7.11. ソート</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id39">16.7.12. 順位付け</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id40">16.7.13. ビン分割</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#numpy">16.7.14. NumPy行列の取得</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id41">16.7.15. 正規化・標準化</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id42">16.7.16. データの分割</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2024- by Yusuke Yamamoto.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>