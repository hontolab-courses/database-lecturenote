
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>4. 単純質問 &#8212; データベースの講義ノート</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/sphinx-book-theme.css?v=384b581d" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css?v=0a3b3ea7" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css?v=6e523e59" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae" />
  <script src="../../_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=8d27b9dea8ad943066ae"></script>

    <script src="../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?v=efea14e4"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js?v=36754332"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-svg.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'content/sql/01';</script>
    <link rel="canonical" href="https://database-lecture.hontolab.org/content/sql/01.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="5. 結合質問（集合演算を含む）" href="02.html" />
    <link rel="prev" title="3. 関係データモデル" href="../relational-data-model/01.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <header class="bd-header navbar navbar-expand-lg bd-navbar">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
  
  
    <p class="title logo__title">データベースの講義ノート</p>
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">はじめに</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../introduction/01.html">1. “データベース”を使わない世界</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">データベースとは</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../concept-of-database/01.html">2. データベースの概念</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">データモデル</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../relational-data-model/01.html">3. 関係データモデル</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">SQL</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 current active"><a class="current reference internal" href="#">4. 単純質問</a></li>
<li class="toctree-l1"><a class="reference internal" href="02.html">5. 結合質問（集合演算を含む）</a></li>
<li class="toctree-l1"><a class="reference internal" href="03.html">6. 副問い合わせ &amp; テーブルの定義と更新</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">中間試験</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../midterm-exam.html">7. 中間試験</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">関係モデルの操作体系</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../relational-algebra/01.html">8. 関係代数</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">データベース設計</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../er-model/01.html">9. 実体関連モデルとは</a></li>
<li class="toctree-l1"><a class="reference internal" href="../er-model/02.html">10. 実体関連モデル上の一貫性制約</a></li>
<li class="toctree-l1"><a class="reference internal" href="../er-model/03.html">11. 拡張実体関連モデル &amp; n項関連</a></li>
<li class="toctree-l1"><a class="reference internal" href="../db-design/01.html">12. 正規形</a></li>
<li class="toctree-l1"><a class="reference internal" href="../db-design/02.html">13. 分解</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">索引づけ &amp; トランザクション</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../indexing-and-transaction/01.html">14. B木</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">ビッグデータ時代のデータベース</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../nosql/01.html">15. NoSQL</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">付録</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../misc/math.html">集合と写像</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/drawio.html">draw.io の使い方</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference.html">参考文献</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://colab.research.google.com/github/hontolab-courses/database-lecturenote/blob/main/content/sql/01.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onColab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../../_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/content/sql/01.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>単純質問</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">4.1. SQLと関係データモデルの比較</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">4.2. 基本形</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#select">4.3. 射影（SELECT）</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#where">4.4. 選択（WHERE）</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#order-by">4.5. 整列（ORDER BY）</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id10">4.6. 集約関数</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#group-by">4.7. グループ化による集約演算（GROUP BY）</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id13">4.8. クイズ</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="id1">
<h1><span class="section-number">4. </span>単純質問<a class="headerlink" href="#id1" title="Link to this heading">#</a></h1>
<div class="cell tag_remove-output tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_remove-output tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">load_ext</span> sql
<span class="o">%</span><span class="k">config</span> SqlMagic.feedback = 0
<span class="o">%</span><span class="k">sql</span> sqlite:///data/SSDSE.db
</pre></div>
</div>
</div>
</details>
</div>
<p>データベースからデータを引っ張ってくるなど，データベースを操作するには具体的なツールが必要となる．
<strong>SQL(Structured Query Language)</strong> は関係データベースの操作に特化した言語である．
SQLはISOによって国際的に標準化されている．
よく用いられる関係データベース管理システム（RDBMS）として<a class="reference external" href="https://ja.wikipedia.org/wiki/MySQL">MySQL</a>や<a class="reference external" href="https://ja.wikipedia.org/wiki/PostgreSQL">PostregreSQL</a>，<a class="reference external" href="https://ja.wikipedia.org/wiki/Oracle_Database">Oracle Database</a>，<a class="reference external" href="https://ja.wikipedia.org/wiki/Microsoft_SQL_Server">Microsoft SQL Server</a>などが挙げられるが，どのRDBMSにもSQLは実装されている．</p>
<p>SQLを使うことで，関係データベースのユーザは</p>
<ul class="simple">
<li><p>データの登録（Create）</p></li>
<li><p>データの読み出し（Read）</p></li>
<li><p>データの更新（Update）</p></li>
<li><p>データの削除（Delete）</p></li>
</ul>
<p>が可能となる<a class="footnote-reference brackets" href="#crud" id="id2" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a>．
なお，本教材のターゲットはデータ分析人材の卵であることから，本教材では関係データベースから<strong>データの読み出し</strong>に焦点を当ててSQLの説明を行う．</p>
<p>SQLはデータベースに対する問い合わせ言語であって，プログラミング言語ではない．
そのため，プログラミング言語に比べて覚えることは少なく，問い合わせ内容を英語に近い形で書き下すことができるよう設計されている．
データ分析人材はソフトウェアを開発することが目的ではないから高度なプログラミング能力を持つ必要は必ずしもないが，関係データベースに納められた大量のデータを自由自在に扱うためにも<strong>SQLの習得は必須</strong>である．</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<h4 class="rubric" id="sql">SQLの読み方</h4>
<p>SQLの読み方は「エス・キュー・エル」である．SQLは1970年代にIBM社が開発したデータベース管理システムSystem Rの操作言語SEQUELを起源としている．関係データベースに熱狂していた世代の人の中には，SEQUELの名残でSQLのことを「シークエル」と呼ぶ人もいる．</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<h4 class="rubric" id="id3">SQLにも方言がある</h4>
<p>RDBMSによって，SQLで使用できる関数が異なったりすることがある．特にSQLiteについては，簡易的なRDMBSということもあり，他のRDBMSでは実装されている機能や関数が実装されていない場合がある．自分が書いたSQL文がうまく動作しない場合は，マニュアルに当たってみよう．</p>
</div>
<section id="id4">
<h2><span class="section-number">4.1. </span>SQLと関係データモデルの比較<a class="headerlink" href="#id4" title="Link to this heading">#</a></h2>
<p>SQLは関係データベースを操作する言語であり，それが扱うデータモデルは関係データモデルを実用的に拡張したものである．
「実用」のSQLデータモデルと「理論」の関係データモデルでは，同様の概念が異なる用語で定義されている．
以下はSQLと関係データモデルの用語の比較である．</p>
<table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>関係データモデル</p></th>
<th class="head"><p>SQL</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>関係（リレーション; relation）</p></td>
<td><p>表（テーブル; table）</p></td>
</tr>
<tr class="row-odd"><td><p>タプル（tuple）</p></td>
<td><p>レコード or 行（row）</p></td>
</tr>
<tr class="row-even"><td><p>属性（attribute）</p></td>
<td><p>列（カラム; column）</p></td>
</tr>
<tr class="row-odd"><td><p>定義域（ドメイン; domain）</p></td>
<td><p>データ型</p></td>
</tr>
</tbody>
</table>
<p>また，関係データモデルでは各属性はドメインで定義された値をもつが，
現実的にはある属性の値が存在しない，あるいは未定義（不明）のケースがありえる．
そのような状況では，特殊な値である<strong>NULL</strong>値（ヌルと読む）を用いる．</p>
</section>
<section id="id5">
<h2><span class="section-number">4.2. </span>基本形<a class="headerlink" href="#id5" title="Link to this heading">#</a></h2>
<p>関係データベースに対する最も典型的な問い合わせ要求は，</p>
<ul class="simple">
<li><p>特定の<strong>表（table，テーブル）</strong> から</p></li>
<li><p><strong>列（column，カラム）</strong> が特定の条件を満たす<strong>行（row）<a class="footnote-reference brackets" href="#row" id="id6" role="doc-noteref"><span class="fn-bracket">[</span>2<span class="fn-bracket">]</span></a></strong> を見つけ出し</p></li>
<li><p>結果を表形式で出力する</p></li>
</ul>
<p>ことである．問い合わせのために記述するSQL文のことを<strong>クエリ（query）</strong> と呼ぶ．</p>
<p>SQLによる代表的なクエリは，以下の形式の<strong>SELECT文</strong>である．</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span>
<span class="w">    </span><span class="err">都道府県名</span>
<span class="k">FROM</span>
<span class="w">    </span><span class="err">都道府県</span>
<span class="k">WHERE</span>
<span class="w">    </span><span class="err">人口</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">5000000</span><span class="p">;</span>
</pre></div>
</div>
<p>上記クエリは，</p>
<blockquote>
<div><p>「都道府県」テーブルから「人口」という列の値が500万以上である行を見つけ，その行の列「都道府県名」を出力してください</p>
</div></blockquote>
<p>という問い合わせ要求を表現したものである．</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">SELECT</span></code>句を用いて「問い合わせ結果に表示したい情報」，</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">FROM</span></code>句を用いて「参照したい表」，</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">WHERE</span></code>句を用いて「表示する際の条件」</p></li>
</ul>
<p>を指定している．
上記要求を英語に直してみると，SQL文は問い合わせ要求をできるだけ直感的に表現しようとしていることがお分かりいただけると思う．</p>
<p>上記クエリは単純な例ではあるが，関係データベースからデータを引っ張ってくる問い合わせについては，すべからく下記のような<code class="docutils literal notranslate"><span class="pre">SELECT</span></code>句から始まるクエリが用いられる．</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span>
<span class="w">    </span><span class="err">列名</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="err">列名</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="p">...</span>
<span class="k">FROM</span>
<span class="w">    </span><span class="err">参照する表</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="err">表</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="p">...</span>
<span class="p">[</span><span class="k">WHERE</span><span class="w"> </span><span class="err">条件</span><span class="p">]</span>
<span class="p">[</span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="err">列名</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="err">列名</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="p">...]</span>
<span class="p">[</span><span class="k">HAVING</span><span class="w"> </span><span class="err">条件</span><span class="p">]</span>
<span class="p">[</span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="err">列名</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="err">列名</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="p">...]</span>
<span class="p">[</span><span class="k">LIMIT</span><span class="w"> </span><span class="err">数字</span><span class="p">];</span><span class="w"> </span>
</pre></div>
</div>
<p>このうち，問い合わせ結果に表示したい情報を指定する<code class="docutils literal notranslate"><span class="pre">SELECT</span></code>句，および問い合わせの際に参照するテーブルを指定している<code class="docutils literal notranslate"><span class="pre">FROM</span></code>句は必須である．
<code class="docutils literal notranslate"><span class="pre">[</span> <span class="pre">]</span></code>で囲まれた箇所については，書かなくてもSQLとして動作する．
なお，<code class="docutils literal notranslate"><span class="pre">SELECT</span></code>や<code class="docutils literal notranslate"><span class="pre">FROM</span></code>，<code class="docutils literal notranslate"><span class="pre">WHERE</span></code>，<code class="docutils literal notranslate"><span class="pre">GROUP</span> <span class="pre">BY</span></code>，<code class="docutils literal notranslate"><span class="pre">HAVING</span></code>，<code class="docutils literal notranslate"><span class="pre">ORDER</span> <span class="pre">BY</span></code>，<code class="docutils literal notranslate"><span class="pre">LIMIT</span></code>といった<strong>句</strong>の意味のついては後ほど説明するが，各句は<strong>この順序で使う</strong>必要がある．
例えば，<code class="docutils literal notranslate"><span class="pre">HAVING</span></code>句は<code class="docutils literal notranslate"><span class="pre">WHERE</span></code>句の後ろに書かない．
また，クエリの末尾にはピリオド（;）をつけ忘れてはいけない．</p>
<p>以後，SQLの基礎について説明する．
説明には，独立行政法人統計センターが公開している教育用標準データセット（SSDSE）の<a class="reference external" href="https://www.nstac.go.jp/use/literacy/ssdse/#SSDSE-E">基本素材SSDSE-E</a>（データの解説は<a class="reference external" href="https://www.nstac.go.jp/sys/files/kaisetsu-E-2023.pdf">こちら</a>）から抜粋・加工したデータ（<code class="docutils literal notranslate"><span class="pre">population</span></code>テーブル）を用いる．
<code class="docutils literal notranslate"><span class="pre">population</span></code>テーブルには，47ある各都道府県に関する総人口，小学校児童数，中学校生徒数，高等学校生徒数，大学学生数のデータが2021年度，2020年度分入っている．
このテーブルが格納された関係データベースが手元にあると想定して，SQLの使い方を説明する．</p>
<div class="cell tag_remove-input tag_scroll-output docutils container">
</div>
</section>
<section id="select">
<h2><span class="section-number">4.3. </span>射影（SELECT）<a class="headerlink" href="#select" title="Link to this heading">#</a></h2>
<p>最も単純なSQLは<code class="docutils literal notranslate"><span class="pre">SELECT</span></code>句と<code class="docutils literal notranslate"><span class="pre">FROM</span></code>句のみからなるものである．
<strong>射影</strong>とは<code class="docutils literal notranslate"><span class="pre">FROM</span></code>句で指定されたテーブルから，<code class="docutils literal notranslate"><span class="pre">SELECT</span></code>句で指定した特定の列のデータのみを抽出する操作である．</p>
<p>例題として用いる<code class="docutils literal notranslate"><span class="pre">population</span></code>テーブルは列として「地域コード」「都道府県」「調査年度」「総人口」「小学校児童数」「中学校生徒数」「高等学校生徒数」「大学学生数」があるが，ケースによって特定の列のデータのみ欲しい場合がある．
そのようなケースで用いるのが射影である．
例えば，<code class="docutils literal notranslate"><span class="pre">population</span></code>テーブルから「都道府県」「調査年度」「総人口」の列のデータのみを抽出する場合，SQL文は以下となる．</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span>
<span class="w">    </span><span class="err">都道府県</span><span class="p">,</span><span class="w"> </span><span class="err">調査年度</span><span class="p">,</span><span class="w"> </span><span class="err">総人口</span>
<span class="k">FROM</span>
<span class="w">    </span><span class="n">population</span><span class="p">;</span><span class="w"> </span>
</pre></div>
</div>
<div class="cell tag_remove-input tag_scroll-output docutils container">
</div>
<p><code class="docutils literal notranslate"><span class="pre">SELECT</span></code>句内で指定した「都道府県」「調査年度」「総人口」列のデータのみが表示された．</p>
<p><code class="docutils literal notranslate"><span class="pre">population</span></code>テーブルは合計で94行のレコードが格納されているため，表が縦に長くなってしまう．
SQL文の問い合わせで得られた結果のうち，先頭の<span class="math notranslate nohighlight">\(N\)</span>行だけを表示させるためには，以下のように<code class="docutils literal notranslate"><span class="pre">LIMIT</span></code>句を使うとよい．</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span>
<span class="w">    </span><span class="err">都道府県</span><span class="p">,</span><span class="w"> </span><span class="err">調査年度</span><span class="p">,</span><span class="w"> </span><span class="err">総人口</span>
<span class="k">FROM</span>
<span class="w">    </span><span class="n">population</span>
<span class="k">LIMIT</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span><span class="w">  </span><span class="c1">-- コメント:先頭の10件のみ表示</span>
</pre></div>
</div>
<p>SELECT
都道府県, 調査年度, 総人口
FROM
population
LIMIT 10;</p>
<p>上記SQL文では表示する列を「都道府県」「調査年度」「総人口」に限定したが，テーブルがもつすべての列情報を表示させたい場合もあるだろう．
そのようなケースでは，以下のように<code class="docutils literal notranslate"><span class="pre">SELECT</span></code>句に<strong>アスタリスク（*）</strong> を使えばよい（アスタリスクを用いると，すべての列名を列挙するのと同等の結果が得られる）</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span>
<span class="w">    </span><span class="o">*</span>
<span class="k">FROM</span>
<span class="w">    </span><span class="n">population</span>
<span class="k">LIMIT</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span><span class="w"> </span>
</pre></div>
</div>
<div class="cell tag_remove-input docutils container">
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<h4 class="rubric" id="id7">読みやすいSQL</h4>
<p>SQL文では改行や余分な空白は無視される．そのため，上記SQL文は<code class="docutils literal notranslate"><span class="pre">SELECT</span> <span class="pre">*</span> <span class="pre">FROM</span> <span class="pre">population</span> <span class="pre">LIMIT</span> <span class="pre">10;</span></code>と解釈される．</p>
<p>それでもわざわざ改行や余分な空白を入れたりしているのは，SQL文を読みやすくするためである．
複雑な問い合わせを行う場合，SQL文も複雑かつ長くなる．
そういったSQL文を読むのは苦痛であるしミスも見落としやすくなるので，できる限りSQL文を読みやすくしておくほうがよい．</p>
</div>
</section>
<section id="where">
<h2><span class="section-number">4.4. </span>選択（WHERE）<a class="headerlink" href="#where" title="Link to this heading">#</a></h2>
<p><strong>選択</strong>とは関係データベースから特定の条件を満たすレコードを抽出する操作である．
選択を行うには<code class="docutils literal notranslate"><span class="pre">WHERE</span></code>句はを用いる．
<code class="docutils literal notranslate"><span class="pre">WHERE</span></code>句を使うことで，列の値と定数，あるいは列同士の値を比較して，<code class="docutils literal notranslate"><span class="pre">FROM</span></code>句で参照したテーブル中のデータを絞り込むことができる．</p>
<p><code class="docutils literal notranslate"><span class="pre">WHERE</span></code>句内で使える代表的な比較演算子は，以下の通りである：</p>
<ul class="simple">
<li><p>=（等しい）</p></li>
<li><p>!=（等しくない）</p></li>
<li><p>&lt;（より小さい）</p></li>
<li><p>&gt;（より大きい）</p></li>
<li><p>&lt;=（以下）</p></li>
<li><p>&gt;=（以上）</p></li>
</ul>
<p>例えば，<code class="docutils literal notranslate"><span class="pre">population</span></code>テーブルから総人口数が750万以上のレコードを抽出するSQL文は以下となる．</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span>
<span class="w">    </span><span class="o">*</span>
<span class="k">FROM</span>
<span class="w">    </span><span class="n">population</span>
<span class="k">WHERE</span>
<span class="w">    </span><span class="err">総人口</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">7500000</span><span class="p">;</span><span class="w"> </span>
</pre></div>
</div>
<div class="cell tag_remove-input docutils container">
</div>
<p>比較したい列のデータ型が文字列の場合は比較したい文字列を<strong>ダブルクォーテーション（”）</strong> もしくは<strong>シングルクォーテーション（’）</strong> で囲う必要がある．</p>
<p>以下は，<code class="docutils literal notranslate"><span class="pre">population</span></code>テーブルから都道府県名が「京都府」のレコードを抽出するSQL文の例である．</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span>
<span class="w">    </span><span class="o">*</span>
<span class="k">FROM</span>
<span class="w">    </span><span class="n">population</span>
<span class="k">WHERE</span>
<span class="w">    </span><span class="err">都道府県</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;京都府&quot;</span><span class="p">;</span><span class="w"> </span>
</pre></div>
</div>
<div class="cell tag_remove-input docutils container">
</div>
<p>文字列の条件指定においては，列データに特定の文字列を含むレコードを抽出したいケースもある．
そのようなケースでは<code class="docutils literal notranslate"><span class="pre">LIKE</span></code>句を用いる．
以下の例のように，<code class="docutils literal notranslate"><span class="pre">WHERE</span></code>句内に<code class="docutils literal notranslate"><span class="pre">LIKE</span> <span class="pre">%部分文字列%</span></code>といった文を書くと，指定した部分文字列を列データに含むレコードに絞り込むことができる．
なお<code class="docutils literal notranslate"><span class="pre">%</span></code>（パーセント）は0文字以上の任意の文字列を意味する．</p>
<p>以下は，<code class="docutils literal notranslate"><span class="pre">population</span></code>テーブルから都道府県名に「京都」の文字を含むレコードのみを抽出するSQL文の例である．</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span>
<span class="w">    </span><span class="o">*</span>
<span class="k">FROM</span>
<span class="w">    </span><span class="n">population</span>
<span class="k">WHERE</span>
<span class="w">    </span><span class="err">都道府県</span><span class="w"> </span><span class="k">LIKE</span><span class="w"> </span><span class="ss">&quot;%京都%&quot;</span><span class="p">;</span><span class="w"> </span>
</pre></div>
</div>
<div class="cell tag_remove-input docutils container">
</div>
<p>「京都」の前後にパーセント記号をつけることによって，都道府県名が「〜京都」もしくは「京都〜」のパターンにマッチするレコードのみに絞り込んでいる．
もし<code class="docutils literal notranslate"><span class="pre">LIKE</span></code>句の条件を<code class="docutils literal notranslate"><span class="pre">%京都%</span></code>ではなく<code class="docutils literal notranslate"><span class="pre">%京都</span></code>にした場合，京都府のレコードはマッチしなくなる．</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<h4 class="rubric" id="id8">SQLの処理順序</h4>
<p>SELECT文による問い合わせが行われたとき，関係データベース管理システムは以下のステップで処理を行う．</p>
<ol class="arabic simple">
<li><p>FROM句で指定した表を参照</p></li>
<li><p>表中の各レコードがWHERE句で指定された条件を満たしているかを確認</p></li>
<li><p>ステップ2で条件を満たしていると判定された行のみ，その行にあるSELECT句で指定した列のデータを表示</p></li>
</ol>
</div>
<p><code class="docutils literal notranslate"><span class="pre">WHERE</span></code>句では条件を複数指定することもできる．
条件は論理演算子である<code class="docutils literal notranslate"><span class="pre">AND</span></code>もしくは<code class="docutils literal notranslate"><span class="pre">OR</span></code>で結合することができる．</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">条件1</span> <span class="pre">AND</span> <span class="pre">条件2</span></code>と指定すれば，条件1と条件2をともに満たすレコード</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">条件1</span> <span class="pre">OR</span> <span class="pre">条件2</span></code>と指定すれば，条件1もしくは条件2のいずれかを満たすレコード</p></li>
</ul>
<p>を抽出することができる．</p>
<p>以下は，<code class="docutils literal notranslate"><span class="pre">population</span></code>テーブルから総人口が100万人以上でかつ大学生数が高校生数よりも多い都道府県を抽出するSQL文の例である．</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span>
<span class="w">    </span><span class="err">都道府県</span>
<span class="k">FROM</span>
<span class="w">    </span><span class="n">population</span>
<span class="k">WHERE</span>
<span class="w">    </span><span class="p">(</span><span class="err">総人口</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">1000000</span><span class="p">)</span>
<span class="w">    </span><span class="k">AND</span><span class="w"> </span><span class="p">(</span><span class="err">大学学生数</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="err">高等学校生徒数</span><span class="p">);</span><span class="w"> </span>
</pre></div>
</div>
<div class="cell tag_remove-input docutils container">
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<h4 class="rubric" id="id9">条件の明確化</h4>
<p>条件の前後に丸括弧をつけることで，条件の記述範囲を明確にすることができる．
条件の範囲やAND/ORのかかる順序をわかりやすくするためにも，3つ以上の条件を組み合わせるような場合には条件の前後に丸括弧をつけることをオススメする．</p>
</div>
<p>上記結果には重複する結果が含まれているが，通常SQLは重複した結果があってもそのまま出力される．
行の重複を除いた結果を出力したい場合，<code class="docutils literal notranslate"><span class="pre">SELECT</span></code>の直後に<code class="docutils literal notranslate"><span class="pre">DISTINCT</span></code>を指定する．</p>
<p>上記の例においては，以下のようなSQL文を発行すると重複のない結果が得られる．</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="k">DISTINCT</span>
<span class="w">    </span><span class="err">都道府県</span>
<span class="k">FROM</span>
<span class="w">    </span><span class="n">population</span>
<span class="k">WHERE</span>
<span class="w">    </span><span class="p">(</span><span class="err">総人口</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">1000000</span><span class="p">)</span>
<span class="w">    </span><span class="k">AND</span><span class="w"> </span><span class="p">(</span><span class="err">大学学生数</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="err">高等学校生徒数</span><span class="p">);</span><span class="w"> </span>
</pre></div>
</div>
<div class="cell tag_remove-input docutils container">
</div>
</section>
<section id="order-by">
<h2><span class="section-number">4.5. </span>整列（ORDER BY）<a class="headerlink" href="#order-by" title="Link to this heading">#</a></h2>
<p>データ分析では，大きいもの（小さいもの）順にデータを<strong>整列（ソート）</strong> させたいケースが多々ある．
そのようなケースで使用するのが<code class="docutils literal notranslate"><span class="pre">ORDER</span> <span class="pre">BY</span></code>句である．</p>
<p>以下のように<code class="docutils literal notranslate"><span class="pre">ORDER</span> <span class="pre">BY</span></code>の後に列名を指定することで，SQL文で抽出したレコードを指定した列の値の<strong>小さいもの順（昇順）</strong> に並び替えることができる．</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span>
<span class="w">    </span><span class="o">*</span>
<span class="k">FROM</span>
<span class="w">    </span><span class="n">population</span>
<span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span>
<span class="w">    </span><span class="err">総人口</span>
<span class="k">LIMIT</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span><span class="w"> </span><span class="c1">--- 先頭の10件のみ表示</span>
</pre></div>
</div>
<div class="cell tag_remove-input docutils container">
</div>
<p><code class="docutils literal notranslate"><span class="pre">ORDER</span> <span class="pre">BY</span></code>はデフォルトは小さいもの順（昇順, in ascending order）でレコードをソートする．
大きいもの順（降順, in descending order）でソートしたい場合は，<code class="docutils literal notranslate"><span class="pre">ORDER</span> <span class="pre">BY</span></code>で列名を指定する際，列名の後に<code class="docutils literal notranslate"><span class="pre">DESC</span></code>キーワードを付ける．</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span>
<span class="w">    </span><span class="o">*</span>
<span class="k">FROM</span>
<span class="w">    </span><span class="n">population</span>
<span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span>
<span class="w">    </span><span class="err">総人口</span><span class="w"> </span><span class="k">DESC</span><span class="w"> </span><span class="c1">--- DESCを付けることで総人口の降順で結果を並び替える</span>
<span class="k">LIMIT</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span><span class="w"> </span>
</pre></div>
</div>
<div class="cell tag_remove-input docutils container">
</div>
</section>
<section id="id10">
<h2><span class="section-number">4.6. </span>集約関数<a class="headerlink" href="#id10" title="Link to this heading">#</a></h2>
<p>合計値や平均値の計算など，データの集計はデータ集合の特徴を知る上での基礎となる．
関係データベースから抽出したレコード集合に対して集計処理を行いたい場合は<strong>集約関数（aggregate functions）</strong> を用いる．
SQLに実装されている代表的な集約関数は以下の通りである．</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">SUM</span></code>: 合計値の計算</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">MAX</span></code>: 最大値の計算</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">MIN</span></code>: 最小値の計算</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">AVG</span></code>: 平均値の計算</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">COUNT</span></code>: 行数のカウント</p></li>
</ul>
<p>関数の引数には計算に用いたい列名などを指定する．
（<a class="reference internal" href="#%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E5%8C%96%E3%81%AB%E3%82%88%E3%82%8B%E9%9B%86%E7%B4%84%E6%BC%94%E7%AE%97%EF%BC%88GROUP-BY%EF%BC%89"><span class="xref myst">次節</span></a>で解説する<code class="docutils literal notranslate"><span class="pre">GROUP</span> <span class="pre">BY</span></code>句を用いない場合）集計関数は，<strong><code class="docutils literal notranslate"><span class="pre">WHERE</span></code>句までで絞り込まれたレコード全体を1つのグループと見なして</strong> 集計処理を行う．</p>
<p>例えば，<code class="docutils literal notranslate"><span class="pre">population</span></code>テーブルから調査年度が2021年度のレコードだけに限定して，各都道府県の総人口の合計値を計算するSQL文は以下となる．</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span>
<span class="w">    </span><span class="k">SUM</span><span class="p">(</span><span class="err">総人口</span><span class="p">)</span>
<span class="k">FROM</span>
<span class="w">    </span><span class="n">population</span>
<span class="k">WHERE</span>
<span class="w">    </span><span class="err">調査年度</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2021</span><span class="p">;</span><span class="w"> </span>
</pre></div>
</div>
<div class="cell tag_remove-input docutils container">
</div>
<p><code class="docutils literal notranslate"><span class="pre">SELECT</span></code>句に複数集約関数を指定することで，複数の集計処理を同時に行うこともできる．
以下は，<code class="docutils literal notranslate"><span class="pre">population</span></code>テーブルを調査年度が2021年度のレコードを用いて，各都道府県の総人口の「合計値」「平均値」「最大値と最小値の差」を計算するSQL文である．</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span>
<span class="w">    </span><span class="k">SUM</span><span class="p">(</span><span class="err">総人口</span><span class="p">),</span>
<span class="w">    </span><span class="k">AVG</span><span class="p">(</span><span class="err">総人口</span><span class="p">),</span>
<span class="w">    </span><span class="k">MAX</span><span class="p">(</span><span class="err">総人口</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">MIN</span><span class="p">(</span><span class="err">総人口</span><span class="p">)</span><span class="w"> </span><span class="c1">--- SELECT句内では四則演算もできる</span>
<span class="k">FROM</span>
<span class="w">    </span><span class="n">population</span>
<span class="k">WHERE</span>
<span class="w">    </span><span class="err">調査年度</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2021</span><span class="p">;</span>
</pre></div>
</div>
<div class="cell tag_remove-input docutils container">
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<h4 class="rubric" id="id11">様々な演算子</h4>
<p><code class="docutils literal notranslate"><span class="pre">SELECT</span></code>句や<code class="docutils literal notranslate"><span class="pre">WHERE</span></code>句の中では，四則演算も行うことができる．加算（<code class="docutils literal notranslate"><span class="pre">+</span></code>），減算（<code class="docutils literal notranslate"><span class="pre">-</span></code>），乗算（<code class="docutils literal notranslate"><span class="pre">*</span></code>），除算（<code class="docutils literal notranslate"><span class="pre">/</span></code>）といった四則演算のための演算子以外にも，余りを求めるための剰余演算子（<code class="docutils literal notranslate"><span class="pre">%</span></code>），絶対値を求める<code class="docutils literal notranslate"><span class="pre">ABS</span></code>関数といった様々な算術演算ツールが用意されている．気になった演算があればマニュアルを調べてみよう．</p>
</div>
<p>行数（レコード数）をカウントする<code class="docutils literal notranslate"><span class="pre">COUNT</span></code>関数は，しばしば引数にすべての列を意味するアスタリスク（*）が用いられる．
以下は，<code class="docutils literal notranslate"><span class="pre">population</span></code>テーブルに格納されたレコード数を調べるSQL文である．</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span>
<span class="w">    </span><span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span>
<span class="k">FROM</span>
<span class="w">    </span><span class="n">population</span><span class="p">;</span>
</pre></div>
</div>
<div class="cell tag_remove-input docutils container">
</div>
<p>上記のSQL文は<code class="docutils literal notranslate"><span class="pre">SELECT</span> <span class="pre">*</span> <span class="pre">FROM</span> <span class="pre">population;</span></code>の実行結果の行数を数えていると考えればよい．
以下のSQL文は結果だけ見ると上記のSQL文と同じになるが，処理の流れとしては<code class="docutils literal notranslate"><span class="pre">SELECT</span> <span class="pre">都道府県</span> <span class="pre">FROM</span> <span class="pre">population;</span></code>の実行結果の行数を数えていることになる．</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span>
<span class="w">    </span><span class="k">COUNT</span><span class="p">(</span><span class="err">都道府県</span><span class="p">)</span>
<span class="k">FROM</span>
<span class="w">    </span><span class="n">population</span><span class="p">;</span>
</pre></div>
</div>
<div class="cell tag_remove-input docutils container">
</div>
<p>なお，上記の結果には2021年度と2020年度の結果が含まれているため，同じ都道府県名が2回数えられてしまっている．
都道府県名の重複を除いて行数をカウントしたい場合は，以下のSQL文のように<code class="docutils literal notranslate"><span class="pre">DISTINCT</span></code>を使う．</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span>
<span class="w">    </span><span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span><span class="w"> </span><span class="err">都道府県</span><span class="p">)</span>
<span class="k">FROM</span>
<span class="w">    </span><span class="n">population</span><span class="p">;</span>
</pre></div>
</div>
<div class="cell tag_remove-input docutils container">
</div>
</section>
<section id="group-by">
<h2><span class="section-number">4.7. </span>グループ化による集約演算（GROUP BY）<a class="headerlink" href="#group-by" title="Link to this heading">#</a></h2>
<p><a class="reference internal" href="#%E9%9B%86%E7%B4%84%E9%96%A2%E6%95%B0"><span class="xref myst">前節</span></a>で解説した集約のためのSQL文は，<code class="docutils literal notranslate"><span class="pre">WHERE</span></code>句で絞り込まれたレコード全体に対して集計操作を行うものであった．
しかし実際にデータ分析を行う場合，レコード全体での集計にとどまらず，ある基準でまとめられたグループごとに集計を行うことも少なくない．
<code class="docutils literal notranslate"><span class="pre">GROUP</span> <span class="pre">BY</span></code>句はグループごとに集約演算を行うための機能である．</p>
<p>「<code class="docutils literal notranslate"><span class="pre">GROUP</span> <span class="pre">BY</span></code>句 + 列名」の形式で指定をすると，指定された列名について同じ値をもつレコードが1つのグループにまとめられた<strong>グループ表</strong>が（ユーザには見えない形で）一時的に作成される．
例えば，<code class="docutils literal notranslate"><span class="pre">population</span></code>テーブルに対して問い合わせを行うSQL文内で「<code class="docutils literal notranslate"><span class="pre">GROUP</span> <span class="pre">BY</span> <span class="pre">地域コード</span></code>」と書くと，以下のようなイメージのグループ表が一時的に作成される（点線がグループを表す）．
<img alt="グループ表" src="../../_images/group-table.png" />
<code class="docutils literal notranslate"><span class="pre">GROUP</span> <span class="pre">BY</span></code>句を用いたクエリを用いると，まとめられたグループのそれぞれに対して<code class="docutils literal notranslate"><span class="pre">SELECT</span></code>区で指定された集約関数が適用される．</p>
<p>以下は，<code class="docutils literal notranslate"><span class="pre">population</span></code>テーブルを用いて，都道府県ごとに2021年と2020年の総人口の平均値を計算するSQL文である．</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span>
<span class="w">    </span><span class="err">地域コード</span><span class="p">,</span>
<span class="w">    </span><span class="err">都道府県</span><span class="p">,</span>
<span class="w">    </span><span class="k">AVG</span><span class="p">(</span><span class="err">総人口</span><span class="p">)</span>
<span class="k">FROM</span>
<span class="w">    </span><span class="n">population</span>
<span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span>
<span class="w">    </span><span class="err">地域コード</span>
<span class="k">LIMIT</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span><span class="w"> </span><span class="c1">--- 先頭の10件のみ表示</span>
</pre></div>
</div>
<div class="cell tag_remove-input docutils container">
</div>
<p><code class="docutils literal notranslate"><span class="pre">GROUP</span> <span class="pre">BY</span></code>句は<code class="docutils literal notranslate"><span class="pre">WHERE</span></code>句と組み合わせて使うこともできる．
<code class="docutils literal notranslate"><span class="pre">WHERE</span></code>句を使うことで，ある条件で絞り込んだレコード集合に対して<code class="docutils literal notranslate"><span class="pre">GROUP</span> <span class="pre">BY</span></code>を適用することができる．</p>
<p>以下は，<code class="docutils literal notranslate"><span class="pre">population</span></code>テーブルの中で総人口が500万を超えるレコードに限定して，都道府県ごとに2021年と2020年の総人口の平均値を計算するSQL文である．</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span>
<span class="w">    </span><span class="err">地域コード</span><span class="p">,</span>
<span class="w">    </span><span class="err">都道府県</span><span class="p">,</span>
<span class="w">    </span><span class="k">AVG</span><span class="p">(</span><span class="err">総人口</span><span class="p">)</span>
<span class="k">FROM</span>
<span class="w">    </span><span class="n">population</span>
<span class="k">WHERE</span>
<span class="w">    </span><span class="err">総人口</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">5000000</span>
<span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span>
<span class="w">    </span><span class="err">地域コード</span><span class="p">;</span>
</pre></div>
</div>
<div class="cell tag_remove-input docutils container">
</div>
<p>グループごとに集計した結果にチェックを行い，指定した条件を満たした結果を抽出したいケースもある．
そのようなケースでは<code class="docutils literal notranslate"><span class="pre">HAVING</span></code>句を用いる．
<code class="docutils literal notranslate"><span class="pre">HAVING</span></code>句は<code class="docutils literal notranslate"><span class="pre">WHERE</span></code>句と同じ形式で条件を指定するが，<code class="docutils literal notranslate"><span class="pre">GROUP</span> <span class="pre">BY</span></code>句の<strong>後に書く</strong>ことに注意しよう（<code class="docutils literal notranslate"><span class="pre">WHERE</span></code>句は<code class="docutils literal notranslate"><span class="pre">GROUP</span> <span class="pre">BY</span></code>句の前）．</p>
<p>以下は，<code class="docutils literal notranslate"><span class="pre">population</span></code>テーブルのレコードについて，都道府県ごとに2021年と2020年の「大学学生数」の平均値を計算し，平均大学学生数が10万を超えたものについて，都道府県名，平均総人口，平均大学学生数を表示するSQL文である．<code class="docutils literal notranslate"><span class="pre">WHERE</span></code>句を用いた場合と<code class="docutils literal notranslate"><span class="pre">HAVING</span></code>句を用いた場合で挙動が異なることを意識しよう．</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span>
<span class="w">    </span><span class="err">地域コード</span><span class="p">,</span>
<span class="w">    </span><span class="err">都道府県</span><span class="p">,</span>
<span class="w">    </span><span class="k">AVG</span><span class="p">(</span><span class="err">総人口</span><span class="p">),</span>
<span class="w">    </span><span class="k">AVG</span><span class="p">(</span><span class="err">大学学生数</span><span class="p">)</span>
<span class="k">FROM</span>
<span class="w">    </span><span class="n">population</span>
<span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span>
<span class="w">    </span><span class="err">地域コード</span>
<span class="k">HAVING</span>
<span class="w">    </span><span class="k">AVG</span><span class="p">(</span><span class="err">大学学生数</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">100000</span><span class="p">;</span>
</pre></div>
</div>
<div class="cell tag_remove-input docutils container">
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<h4 class="rubric" id="id12">SQLの処理順序（再び）</h4>
<p>本章では<code class="docutils literal notranslate"><span class="pre">SELECT</span></code>句，<code class="docutils literal notranslate"><span class="pre">FROM</span></code>句，<code class="docutils literal notranslate"><span class="pre">WHERE</span></code>句，<code class="docutils literal notranslate"><span class="pre">ORDER</span> <span class="pre">BY</span></code>句，<code class="docutils literal notranslate"><span class="pre">GROUP</span> <span class="pre">BY</span></code>句，<code class="docutils literal notranslate"><span class="pre">HAVING</span></code>句が登場したが，これらが用いられたSELECT文による問い合わせが行われたとき，どのような順序で処理が行われているかを意識しよう．関係データベース管理システムは以下のステップで処理を行う．</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">FROM</span></code>句で指定した表を参照</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">WHERE</span></code>句があれば<code class="docutils literal notranslate"><span class="pre">WHERE</span></code>句で指定された条件を満たすレコードを選択．なければ<code class="docutils literal notranslate"><span class="pre">FROM</span></code>句で指定した表中の全レコードを選択．</p></li>
<li><p>（<code class="docutils literal notranslate"><span class="pre">GROUP</span> <span class="pre">BY</span></code>句があれば）ステップ2で選択されたレコードをグループ化する</p></li>
<li><p>（<code class="docutils literal notranslate"><span class="pre">HAVING</span></code>句があれば）ステップ3でまとめられたグループに対する条件付けを行う</p></li>
<li><p>（<code class="docutils literal notranslate"><span class="pre">ORDER</span> <span class="pre">BY</span></code>句があれば）指定された基準に基づきレコードをソートする</p></li>
<li><p>条件を満たしたものについて，<code class="docutils literal notranslate"><span class="pre">SELECT</span></code>句で指定された値を表示．</p></li>
</ol>
</div>
</section>
<hr class="docutils" />
<section id="id13">
<h2><span class="section-number">4.8. </span>クイズ<a class="headerlink" href="#id13" title="Link to this heading">#</a></h2>
<div class="cell tag_remove-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">sql</span> sqlite:///data/virtual_store.db
</pre></div>
</div>
</div>
</div>
<hr class="footnotes docutils" />
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="crud" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id2">1</a><span class="fn-bracket">]</span></span>
<p>データの作成，読み出し，更新，削除はデータベースに求められる主要な操作で，それぞれの頭文字を取ってCRUD（クラッド）と呼ばれる．</p>
</aside>
<aside class="footnote brackets" id="row" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id6">2</a><span class="fn-bracket">]</span></span>
<p>レコード（record）と呼ぶこともある．</p>
</aside>
</aside>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./content/sql"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="../relational-data-model/01.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title"><span class="section-number">3. </span>関係データモデル</p>
      </div>
    </a>
    <a class="right-next"
       href="02.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">5. </span>結合質問（集合演算を含む）</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">4.1. SQLと関係データモデルの比較</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">4.2. 基本形</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#select">4.3. 射影（SELECT）</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#where">4.4. 選択（WHERE）</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#order-by">4.5. 整列（ORDER BY）</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id10">4.6. 集約関数</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#group-by">4.7. グループ化による集約演算（GROUP BY）</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id13">4.8. クイズ</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>